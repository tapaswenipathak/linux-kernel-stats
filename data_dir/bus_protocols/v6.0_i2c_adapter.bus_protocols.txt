commit eabb41396a41c79de52e680f5b2f7de29ba19a0a
Author: Lucas Tanure <tanureal@opensource.cirrus.com>
Date:   Wed Apr 13 10:14:10 2022 +0100

    i2c: cadence: Increase timeout per message if necessary
    
    [ Upstream commit 96789dce043f5bff8b7d62aa28d52a7c59403a84 ]
    
    Timeout as 1 second sets an upper limit on the length
    of the transfer executed, but there is no maximum length
    of a write or read message set in i2c_adapter_quirks for
    this controller.
    
    This upper limit affects devices that require sending
    large firmware blobs over I2C.
    
    To remove that limitation, calculate the minimal time
    necessary, plus some wiggle room, for every message and
    use it instead of the default one second, if more than
    one second.
    
    Signed-off-by: Lucas Tanure <tanureal@opensource.cirrus.com>
    Acked-by: Michal Simek <michal.simek@xilinx.com>
    Signed-off-by: Wolfram Sang <wsa@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit d8741f70fe7d1bf67aced76e2376742d1e6eb043
Author: Lucas Tanure <tanureal@opensource.cirrus.com>
Date:   Wed Apr 13 10:14:10 2022 +0100

    i2c: cadence: Increase timeout per message if necessary
    
    [ Upstream commit 96789dce043f5bff8b7d62aa28d52a7c59403a84 ]
    
    Timeout as 1 second sets an upper limit on the length
    of the transfer executed, but there is no maximum length
    of a write or read message set in i2c_adapter_quirks for
    this controller.
    
    This upper limit affects devices that require sending
    large firmware blobs over I2C.
    
    To remove that limitation, calculate the minimal time
    necessary, plus some wiggle room, for every message and
    use it instead of the default one second, if more than
    one second.
    
    Signed-off-by: Lucas Tanure <tanureal@opensource.cirrus.com>
    Acked-by: Michal Simek <michal.simek@xilinx.com>
    Signed-off-by: Wolfram Sang <wsa@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 015e9831547e0c4ed167d194eb5da6cdccdc6792
Author: Lucas Tanure <tanureal@opensource.cirrus.com>
Date:   Wed Apr 13 10:14:10 2022 +0100

    i2c: cadence: Increase timeout per message if necessary
    
    [ Upstream commit 96789dce043f5bff8b7d62aa28d52a7c59403a84 ]
    
    Timeout as 1 second sets an upper limit on the length
    of the transfer executed, but there is no maximum length
    of a write or read message set in i2c_adapter_quirks for
    this controller.
    
    This upper limit affects devices that require sending
    large firmware blobs over I2C.
    
    To remove that limitation, calculate the minimal time
    necessary, plus some wiggle room, for every message and
    use it instead of the default one second, if more than
    one second.
    
    Signed-off-by: Lucas Tanure <tanureal@opensource.cirrus.com>
    Acked-by: Michal Simek <michal.simek@xilinx.com>
    Signed-off-by: Wolfram Sang <wsa@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 344a55ccf5ec14aea4bd7e3f0c1d1134bc71b0c3
Author: Lucas Tanure <tanureal@opensource.cirrus.com>
Date:   Wed Apr 13 10:14:10 2022 +0100

    i2c: cadence: Increase timeout per message if necessary
    
    [ Upstream commit 96789dce043f5bff8b7d62aa28d52a7c59403a84 ]
    
    Timeout as 1 second sets an upper limit on the length
    of the transfer executed, but there is no maximum length
    of a write or read message set in i2c_adapter_quirks for
    this controller.
    
    This upper limit affects devices that require sending
    large firmware blobs over I2C.
    
    To remove that limitation, calculate the minimal time
    necessary, plus some wiggle room, for every message and
    use it instead of the default one second, if more than
    one second.
    
    Signed-off-by: Lucas Tanure <tanureal@opensource.cirrus.com>
    Acked-by: Michal Simek <michal.simek@xilinx.com>
    Signed-off-by: Wolfram Sang <wsa@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 27fdb4572344abcfa3af409cb526c1f8e099b63f
Author: Lucas Tanure <tanureal@opensource.cirrus.com>
Date:   Wed Apr 13 10:14:10 2022 +0100

    i2c: cadence: Increase timeout per message if necessary
    
    [ Upstream commit 96789dce043f5bff8b7d62aa28d52a7c59403a84 ]
    
    Timeout as 1 second sets an upper limit on the length
    of the transfer executed, but there is no maximum length
    of a write or read message set in i2c_adapter_quirks for
    this controller.
    
    This upper limit affects devices that require sending
    large firmware blobs over I2C.
    
    To remove that limitation, calculate the minimal time
    necessary, plus some wiggle room, for every message and
    use it instead of the default one second, if more than
    one second.
    
    Signed-off-by: Lucas Tanure <tanureal@opensource.cirrus.com>
    Acked-by: Michal Simek <michal.simek@xilinx.com>
    Signed-off-by: Wolfram Sang <wsa@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 460dc21d2b91b3a54fb3bfc77840458d1708041f
Author: Lucas Tanure <tanureal@opensource.cirrus.com>
Date:   Wed Apr 13 10:14:10 2022 +0100

    i2c: cadence: Increase timeout per message if necessary
    
    [ Upstream commit 96789dce043f5bff8b7d62aa28d52a7c59403a84 ]
    
    Timeout as 1 second sets an upper limit on the length
    of the transfer executed, but there is no maximum length
    of a write or read message set in i2c_adapter_quirks for
    this controller.
    
    This upper limit affects devices that require sending
    large firmware blobs over I2C.
    
    To remove that limitation, calculate the minimal time
    necessary, plus some wiggle room, for every message and
    use it instead of the default one second, if more than
    one second.
    
    Signed-off-by: Lucas Tanure <tanureal@opensource.cirrus.com>
    Acked-by: Michal Simek <michal.simek@xilinx.com>
    Signed-off-by: Wolfram Sang <wsa@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit d449c8277bda690b2afbbe008ccf7d4544f39f83
Author: Lucas Tanure <tanureal@opensource.cirrus.com>
Date:   Wed Apr 13 10:14:10 2022 +0100

    i2c: cadence: Increase timeout per message if necessary
    
    [ Upstream commit 96789dce043f5bff8b7d62aa28d52a7c59403a84 ]
    
    Timeout as 1 second sets an upper limit on the length
    of the transfer executed, but there is no maximum length
    of a write or read message set in i2c_adapter_quirks for
    this controller.
    
    This upper limit affects devices that require sending
    large firmware blobs over I2C.
    
    To remove that limitation, calculate the minimal time
    necessary, plus some wiggle room, for every message and
    use it instead of the default one second, if more than
    one second.
    
    Signed-off-by: Lucas Tanure <tanureal@opensource.cirrus.com>
    Acked-by: Michal Simek <michal.simek@xilinx.com>
    Signed-off-by: Wolfram Sang <wsa@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 631d7614792cb8c8cdc47ba27b93cf587d404b28
Author: Lucas Tanure <tanureal@opensource.cirrus.com>
Date:   Wed Apr 13 10:14:10 2022 +0100

    i2c: cadence: Increase timeout per message if necessary
    
    [ Upstream commit 96789dce043f5bff8b7d62aa28d52a7c59403a84 ]
    
    Timeout as 1 second sets an upper limit on the length
    of the transfer executed, but there is no maximum length
    of a write or read message set in i2c_adapter_quirks for
    this controller.
    
    This upper limit affects devices that require sending
    large firmware blobs over I2C.
    
    To remove that limitation, calculate the minimal time
    necessary, plus some wiggle room, for every message and
    use it instead of the default one second, if more than
    one second.
    
    Signed-off-by: Lucas Tanure <tanureal@opensource.cirrus.com>
    Acked-by: Michal Simek <michal.simek@xilinx.com>
    Signed-off-by: Wolfram Sang <wsa@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit ba1677f76b9a510d88efdc7a1416b2e778f125bc
Author: Patrik Jakobsson <patrik.r.jakobsson@gmail.com>
Date:   Wed Jun 1 11:23:05 2022 +0200

    drm/gma500: Make gma_i2c_chan a subclass of i2c_adapter
    
    This makes it easier to get at the full gma_i2c_chan when having an
    i2c_adapter from eg. drm_connector->ddc.
    
    Signed-off-by: Patrik Jakobsson <patrik.r.jakobsson@gmail.com>
    Acked-by: Thomas Zimmermann <tzimmermann@suse.de>
    Link: https://patchwork.freedesktop.org/patch/msgid/20220601092311.22648-3-patrik.r.jakobsson@gmail.com

commit 96789dce043f5bff8b7d62aa28d52a7c59403a84
Author: Lucas Tanure <tanureal@opensource.cirrus.com>
Date:   Wed Apr 13 10:14:10 2022 +0100

    i2c: cadence: Increase timeout per message if necessary
    
    Timeout as 1 second sets an upper limit on the length
    of the transfer executed, but there is no maximum length
    of a write or read message set in i2c_adapter_quirks for
    this controller.
    
    This upper limit affects devices that require sending
    large firmware blobs over I2C.
    
    To remove that limitation, calculate the minimal time
    necessary, plus some wiggle room, for every message and
    use it instead of the default one second, if more than
    one second.
    
    Signed-off-by: Lucas Tanure <tanureal@opensource.cirrus.com>
    Acked-by: Michal Simek <michal.simek@xilinx.com>
    Signed-off-by: Wolfram Sang <wsa@kernel.org>

commit 97452456c1e47d0e65c47a3e2c65cace178f3cb3
Author: Peter Rosin <peda@axentia.se>
Date:   Wed Mar 2 12:22:35 2022 +0100

    i2c: mux: demux-pinctrl: do not deactivate a master that is not active
    
    [ Upstream commit 1a22aabf20adf89cb216f566913196128766f25b ]
    
    Attempting to rollback the activation of the current master when
    the current master has not been activated is bad. priv->cur_chan
    and priv->cur_adap are both still zeroed out and the rollback
    may result in attempts to revert an of changeset that has not been
    applied and do result in calls to both del and put the zeroed out
    i2c_adapter. Maybe it crashes, or whatever, but it's bad in any
    case.
    
    Fixes: e9d1a0a41d44 ("i2c: mux: demux-pinctrl: Fix an error handling path in 'i2c_demux_pinctrl_probe()'")
    Signed-off-by: Peter Rosin <peda@axentia.se>
    Signed-off-by: Wolfram Sang <wsa@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 9e398155d182601f893fa45c5d19acd0b3cbb733
Author: Peter Rosin <peda@axentia.se>
Date:   Wed Mar 2 12:22:35 2022 +0100

    i2c: mux: demux-pinctrl: do not deactivate a master that is not active
    
    [ Upstream commit 1a22aabf20adf89cb216f566913196128766f25b ]
    
    Attempting to rollback the activation of the current master when
    the current master has not been activated is bad. priv->cur_chan
    and priv->cur_adap are both still zeroed out and the rollback
    may result in attempts to revert an of changeset that has not been
    applied and do result in calls to both del and put the zeroed out
    i2c_adapter. Maybe it crashes, or whatever, but it's bad in any
    case.
    
    Fixes: e9d1a0a41d44 ("i2c: mux: demux-pinctrl: Fix an error handling path in 'i2c_demux_pinctrl_probe()'")
    Signed-off-by: Peter Rosin <peda@axentia.se>
    Signed-off-by: Wolfram Sang <wsa@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 1c7b252a60539f6533fa9394f7f234783254725e
Author: Peter Rosin <peda@axentia.se>
Date:   Wed Mar 2 12:22:35 2022 +0100

    i2c: mux: demux-pinctrl: do not deactivate a master that is not active
    
    [ Upstream commit 1a22aabf20adf89cb216f566913196128766f25b ]
    
    Attempting to rollback the activation of the current master when
    the current master has not been activated is bad. priv->cur_chan
    and priv->cur_adap are both still zeroed out and the rollback
    may result in attempts to revert an of changeset that has not been
    applied and do result in calls to both del and put the zeroed out
    i2c_adapter. Maybe it crashes, or whatever, but it's bad in any
    case.
    
    Fixes: e9d1a0a41d44 ("i2c: mux: demux-pinctrl: Fix an error handling path in 'i2c_demux_pinctrl_probe()'")
    Signed-off-by: Peter Rosin <peda@axentia.se>
    Signed-off-by: Wolfram Sang <wsa@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 50da79f8891435b9c396787f35383174874d593b
Author: Peter Rosin <peda@axentia.se>
Date:   Wed Mar 2 12:22:35 2022 +0100

    i2c: mux: demux-pinctrl: do not deactivate a master that is not active
    
    [ Upstream commit 1a22aabf20adf89cb216f566913196128766f25b ]
    
    Attempting to rollback the activation of the current master when
    the current master has not been activated is bad. priv->cur_chan
    and priv->cur_adap are both still zeroed out and the rollback
    may result in attempts to revert an of changeset that has not been
    applied and do result in calls to both del and put the zeroed out
    i2c_adapter. Maybe it crashes, or whatever, but it's bad in any
    case.
    
    Fixes: e9d1a0a41d44 ("i2c: mux: demux-pinctrl: Fix an error handling path in 'i2c_demux_pinctrl_probe()'")
    Signed-off-by: Peter Rosin <peda@axentia.se>
    Signed-off-by: Wolfram Sang <wsa@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 0d3ad6142a05a3e0de5ff71438dd087ea0775266
Author: Peter Rosin <peda@axentia.se>
Date:   Wed Mar 2 12:22:35 2022 +0100

    i2c: mux: demux-pinctrl: do not deactivate a master that is not active
    
    [ Upstream commit 1a22aabf20adf89cb216f566913196128766f25b ]
    
    Attempting to rollback the activation of the current master when
    the current master has not been activated is bad. priv->cur_chan
    and priv->cur_adap are both still zeroed out and the rollback
    may result in attempts to revert an of changeset that has not been
    applied and do result in calls to both del and put the zeroed out
    i2c_adapter. Maybe it crashes, or whatever, but it's bad in any
    case.
    
    Fixes: e9d1a0a41d44 ("i2c: mux: demux-pinctrl: Fix an error handling path in 'i2c_demux_pinctrl_probe()'")
    Signed-off-by: Peter Rosin <peda@axentia.se>
    Signed-off-by: Wolfram Sang <wsa@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 226ec1997de7c4836f542dcbc7d84dc1a7fc14aa
Author: Peter Rosin <peda@axentia.se>
Date:   Wed Mar 2 12:22:35 2022 +0100

    i2c: mux: demux-pinctrl: do not deactivate a master that is not active
    
    [ Upstream commit 1a22aabf20adf89cb216f566913196128766f25b ]
    
    Attempting to rollback the activation of the current master when
    the current master has not been activated is bad. priv->cur_chan
    and priv->cur_adap are both still zeroed out and the rollback
    may result in attempts to revert an of changeset that has not been
    applied and do result in calls to both del and put the zeroed out
    i2c_adapter. Maybe it crashes, or whatever, but it's bad in any
    case.
    
    Fixes: e9d1a0a41d44 ("i2c: mux: demux-pinctrl: Fix an error handling path in 'i2c_demux_pinctrl_probe()'")
    Signed-off-by: Peter Rosin <peda@axentia.se>
    Signed-off-by: Wolfram Sang <wsa@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit a1537a708a981918302af68f1689bcdc65c85cdf
Author: Peter Rosin <peda@axentia.se>
Date:   Wed Mar 2 12:22:35 2022 +0100

    i2c: mux: demux-pinctrl: do not deactivate a master that is not active
    
    [ Upstream commit 1a22aabf20adf89cb216f566913196128766f25b ]
    
    Attempting to rollback the activation of the current master when
    the current master has not been activated is bad. priv->cur_chan
    and priv->cur_adap are both still zeroed out and the rollback
    may result in attempts to revert an of changeset that has not been
    applied and do result in calls to both del and put the zeroed out
    i2c_adapter. Maybe it crashes, or whatever, but it's bad in any
    case.
    
    Fixes: e9d1a0a41d44 ("i2c: mux: demux-pinctrl: Fix an error handling path in 'i2c_demux_pinctrl_probe()'")
    Signed-off-by: Peter Rosin <peda@axentia.se>
    Signed-off-by: Wolfram Sang <wsa@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 744c365385b605744df8487d78a25af3f2354851
Author: Peter Rosin <peda@axentia.se>
Date:   Wed Mar 2 12:22:35 2022 +0100

    i2c: mux: demux-pinctrl: do not deactivate a master that is not active
    
    [ Upstream commit 1a22aabf20adf89cb216f566913196128766f25b ]
    
    Attempting to rollback the activation of the current master when
    the current master has not been activated is bad. priv->cur_chan
    and priv->cur_adap are both still zeroed out and the rollback
    may result in attempts to revert an of changeset that has not been
    applied and do result in calls to both del and put the zeroed out
    i2c_adapter. Maybe it crashes, or whatever, but it's bad in any
    case.
    
    Fixes: e9d1a0a41d44 ("i2c: mux: demux-pinctrl: Fix an error handling path in 'i2c_demux_pinctrl_probe()'")
    Signed-off-by: Peter Rosin <peda@axentia.se>
    Signed-off-by: Wolfram Sang <wsa@kernel.org>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 1a22aabf20adf89cb216f566913196128766f25b
Author: Peter Rosin <peda@axentia.se>
Date:   Wed Mar 2 12:22:35 2022 +0100

    i2c: mux: demux-pinctrl: do not deactivate a master that is not active
    
    Attempting to rollback the activation of the current master when
    the current master has not been activated is bad. priv->cur_chan
    and priv->cur_adap are both still zeroed out and the rollback
    may result in attempts to revert an of changeset that has not been
    applied and do result in calls to both del and put the zeroed out
    i2c_adapter. Maybe it crashes, or whatever, but it's bad in any
    case.
    
    Fixes: e9d1a0a41d44 ("i2c: mux: demux-pinctrl: Fix an error handling path in 'i2c_demux_pinctrl_probe()'")
    Signed-off-by: Peter Rosin <peda@axentia.se>
    Signed-off-by: Wolfram Sang <wsa@kernel.org>

commit 17e571fe720dae18eb5e743b0e6217f235d5338c
Author: Jani Nikula <jani.nikula@intel.com>
Date:   Fri Mar 4 12:14:26 2022 +0200

    drm/i915/gmbus: use to_intel_gmbus() instead of open coding
    
    We have a helper for getting at the enclosing gmbus struct from the
    embedded i2c_adapter, use it.
    
    Signed-off-by: Jani Nikula <jani.nikula@intel.com>
    Reviewed-by: Ville Syrjälä <ville.syrjala@linux.intel.com>
    Link: https://patchwork.freedesktop.org/patch/msgid/20220304101426.1891347-2-jani.nikula@intel.com

commit 2f61b3a746995ccf595781e34786bb69c63ab7fe
Author: Primoz Fiser <primoz.fiser@norik.com>
Date:   Thu Jul 8 10:21:28 2021 +0200

    watchdog: da9062: da9063: prevent pings ahead of machine reset
    
    Proper machine resets via da9062/da9063 PMICs are very tricky as they
    require special i2c atomic transfers when interrupts are not available
    anymore. This is also a reason why both PMIC's restart handlers do not
    use regmap but instead opt for i2c_smbus_write_byte_data() which does
    i2c transfer in atomic manner. Under the hood, this function tries to
    obtain i2c bus lock with call to i2c_adapter_trylock_bus() which will
    return -EAGAIN (-11) if lock is not available.
    
    Since commit 982bb70517aef ("watchdog: reset last_hw_keepalive time at
    start") occasional restart handler failures with "Failed to shutdown
    (err = -11)" error messages were observed, indicating that some
    process is holding the i2c bus lock. Investigation into the matter
    uncovered that sometimes during reboot sequence watchdog ping is issued
    late into poweroff/reboot phase which did not happen before mentioned
    commit (usually the watchdog ping happened immediately as commit message
    suggests). As of now, when watchdog ping usually happens late into
    poweroff/reboot stage when interrupts are not available anymore, i2c bus
    lock cannot be released anymore and pending restart handler in turn
    fails.
    
    Thus, to prevent such late watchdog pings from happening ahead of
    pending machine restart and consequently locking up the i2c bus, check
    for system_state in watchdog ping handler and consequently do not send
    pings anymore in case system_state > SYSTEM_RUNNING.
    
    Signed-off-by: Primoz Fiser <primoz.fiser@norik.com>
    Reviewed-by: Guenter Roeck <linux@roeck-us.net>
    Reviewed-by: Adam Thomson <Adam.Thomson.Opensource@diasemi.com>
    Link: https://lore.kernel.org/r/20210708082128.2832904-1-primoz.fiser@norik.com
    Signed-off-by: Guenter Roeck <linux@roeck-us.net>
    Signed-off-by: Wim Van Sebroeck <wim@linux-watchdog.org>

commit 93ade343bbadd73999324dcc66c933e398e39818
Author: Luben Tuikov <luben.tuikov@amd.com>
Date:   Thu Jan 28 14:24:09 2021 -0500

    drm/amdgpu: EEPROM respects I2C quirks
    
    Consult the i2c_adapter.quirks table for
    the maximum read/write data length per bus
    transaction. Do not exceed this transaction
    limit.
    
    Cc: Jean Delvare <jdelvare@suse.de>
    Cc: Alexander Deucher <Alexander.Deucher@amd.com>
    Cc: Andrey Grodzovsky <Andrey.Grodzovsky@amd.com>
    Cc: Lijo Lazar <Lijo.Lazar@amd.com>
    Cc: Stanley Yang <Stanley.Yang@amd.com>
    Cc: Hawking Zhang <Hawking.Zhang@amd.com>
    Signed-off-by: Luben Tuikov <luben.tuikov@amd.com>
    Acked-by: Alexander Deucher <Alexander.Deucher@amd.com>
    Signed-off-by: Alex Deucher <alexander.deucher@amd.com>

commit b97ba92e2962b7ede713bc5b70dcf747083e45f9
Author: Heiner Kallweit <hkallweit1@gmail.com>
Date:   Mon May 24 22:11:31 2021 +0200

    eeprom: ee1004: Remove usage of i2c_adapter_id in adapter comparison
    
    We can compare the adapter pointers directly instead of using
    i2c_adapter_id().
    
    Signed-off-by: Heiner Kallweit <hkallweit1@gmail.com>
    Link: https://lore.kernel.org/r/99a3f94d-e7ca-e01d-6a78-81e109fde086@gmail.com
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 4a7695429eade517b07ea72f9ec366130e81a076
Author: Bence Csókás <bence98@sch.bme.hu>
Date:   Wed Mar 31 19:19:21 2021 +0000

    i2c: cp2615: add i2c driver for Silicon Labs' CP2615 Digital Audio Bridge
    
    Create an i2c_adapter for CP2615's I2C master interface
    
    Signed-off-by: Bence Csókás <bence98@sch.bme.hu>
    [wsa: switched to '__packed', added some 'static' and an include]
    Signed-off-by: Wolfram Sang <wsa@kernel.org>

commit f6a96afb3c99ab0e0d46f5652a53f66eeaff7bfb
Author: Lee Jones <lee.jones@linaro.org>
Date:   Mon Nov 16 17:36:32 2020 +0000

    drm/radeon/atom: Move 'radeon_atom_hw_i2c_*()'s prototypes into shared header
    
    Fixes the following W=1 kernel build warning(s):
    
     drivers/gpu/drm/radeon/atombios_i2c.c:100:5: warning: no previous prototype for ‘radeon_atom_hw_i2c_xfer’ [-Wmissing-prototypes]
     100 | int radeon_atom_hw_i2c_xfer(struct i2c_adapter *i2c_adap,
     | ^~~~~~~~~~~~~~~~~~~~~~~
     drivers/gpu/drm/radeon/atombios_i2c.c:150:5: warning: no previous prototype for ‘radeon_atom_hw_i2c_func’ [-Wmissing-prototypes]
     150 | u32 radeon_atom_hw_i2c_func(struct i2c_adapter *adap)
     | ^~~~~~~~~~~~~~~~~~~~~~~
    
    Cc: Alex Deucher <alexander.deucher@amd.com>
    Cc: "Christian König" <christian.koenig@amd.com>
    Cc: David Airlie <airlied@linux.ie>
    Cc: Daniel Vetter <daniel@ffwll.ch>
    Cc: amd-gfx@lists.freedesktop.org
    Cc: dri-devel@lists.freedesktop.org
    Signed-off-by: Lee Jones <lee.jones@linaro.org>
    Signed-off-by: Alex Deucher <alexander.deucher@amd.com>

commit 2340dc15f05f595688ae10f6512cef5ad51476d3
Author: Thierry Reding <treding@nvidia.com>
Date:   Wed Apr 8 20:01:00 2020 +0200

    drm/tegra: Properly reference count the DDC I2C adapter
    
    Use the of_get_i2c_adapter_by_node(), which is similar to the existing
    call to of_find_i2c_adapter_by_node() except that it also takes a
    reference to the owner module of the I2C adapter. In order to properly
    balance this out, call i2c_put_adapter() to release the reference to the
    I2C adapter and its owner module.
    
    For the special case where the DDC comes from the DPAUX, care must be
    taken to perform the same steps (i.e. get_device() and module_get()) so
    that the reference counts are all balanced.
    
    Signed-off-by: Thierry Reding <treding@nvidia.com>

commit 0479fd1de51fe2d3e948f02e6145be6c213ea79b
Author: Sowjanya Komatineni <skomatineni@nvidia.com>
Date:   Tue Jan 8 13:59:10 2019 -0800

    i2c: tegra: Fix Maximum transfer size
    
    [ Upstream commit b67d4530cdade7ebfafa2c6b46f2a0dad3e41bcb ]
    
    Tegra194 supports maximum 64K Bytes transfer per packet.
    Tegra186 and prior supports maximum 4K Bytes transfer per packet.
    
    This patch fixes this payload difference between Tegra194 and prior
    Tegra chipsets using separate i2c_adapter_quirks.
    
    Signed-off-by: Sowjanya Komatineni <skomatineni@nvidia.com>
    Acked-by: Thierry Reding <treding@nvidia.com>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 22a5fd6c1a0a0a3c3f619780ec43461a331e18f2
Author: Hans de Goede <hdegoede@redhat.com>
Date:   Tue Aug 13 12:03:01 2019 +0200

    i2c-cht-wc: Fix lockdep warning
    
    [ Upstream commit 232219b9a464c2479c98aa589acb1bd3383ae9d6 ]
    
    When the kernel is build with lockdep support and the i2c-cht-wc driver is
    used, the following warning is shown:
    
    [   66.674334] ======================================================
    [   66.674337] WARNING: possible circular locking dependency detected
    [   66.674340] 5.3.0-rc4+ #83 Not tainted
    [   66.674342] ------------------------------------------------------
    [   66.674345] systemd-udevd/1232 is trying to acquire lock:
    [   66.674349] 00000000a74dab07 (intel_soc_pmic_chtwc:167:(&cht_wc_regmap_cfg)->lock){+.+.}, at: regmap_write+0x31/0x70
    [   66.674360]
                   but task is already holding lock:
    [   66.674362] 00000000d44a85b7 (i2c_register_adapter){+.+.}, at: i2c_smbus_xfer+0x49/0xf0
    [   66.674370]
                   which lock already depends on the new lock.
    
    [   66.674371]
                   the existing dependency chain (in reverse order) is:
    [   66.674374]
                   -> #1 (i2c_register_adapter){+.+.}:
    [   66.674381]        rt_mutex_lock_nested+0x46/0x60
    [   66.674384]        i2c_smbus_xfer+0x49/0xf0
    [   66.674387]        i2c_smbus_read_byte_data+0x45/0x70
    [   66.674391]        cht_wc_byte_reg_read+0x35/0x50
    [   66.674394]        _regmap_read+0x63/0x1a0
    [   66.674396]        _regmap_update_bits+0xa8/0xe0
    [   66.674399]        regmap_update_bits_base+0x63/0xa0
    [   66.674403]        regmap_irq_update_bits.isra.0+0x3b/0x50
    [   66.674406]        regmap_add_irq_chip+0x592/0x7a0
    [   66.674409]        devm_regmap_add_irq_chip+0x89/0xed
    [   66.674412]        cht_wc_probe+0x102/0x158
    [   66.674415]        i2c_device_probe+0x95/0x250
    [   66.674419]        really_probe+0xf3/0x380
    [   66.674422]        driver_probe_device+0x59/0xd0
    [   66.674425]        device_driver_attach+0x53/0x60
    [   66.674428]        __driver_attach+0x92/0x150
    [   66.674431]        bus_for_each_dev+0x7d/0xc0
    [   66.674434]        bus_add_driver+0x14d/0x1f0
    [   66.674437]        driver_register+0x6d/0xb0
    [   66.674440]        i2c_register_driver+0x45/0x80
    [   66.674445]        do_one_initcall+0x60/0x2f4
    [   66.674450]        kernel_init_freeable+0x20d/0x2b4
    [   66.674453]        kernel_init+0xa/0x10c
    [   66.674457]        ret_from_fork+0x3a/0x50
    [   66.674459]
                   -> #0 (intel_soc_pmic_chtwc:167:(&cht_wc_regmap_cfg)->lock){+.+.}:
    [   66.674465]        __lock_acquire+0xe07/0x1930
    [   66.674468]        lock_acquire+0x9d/0x1a0
    [   66.674472]        __mutex_lock+0xa8/0x9a0
    [   66.674474]        regmap_write+0x31/0x70
    [   66.674480]        cht_wc_i2c_adap_smbus_xfer+0x72/0x240 [i2c_cht_wc]
    [   66.674483]        __i2c_smbus_xfer+0x1a3/0x640
    [   66.674486]        i2c_smbus_xfer+0x67/0xf0
    [   66.674489]        i2c_smbus_read_byte_data+0x45/0x70
    [   66.674494]        bq24190_probe+0x26b/0x410 [bq24190_charger]
    [   66.674497]        i2c_device_probe+0x189/0x250
    [   66.674500]        really_probe+0xf3/0x380
    [   66.674503]        driver_probe_device+0x59/0xd0
    [   66.674506]        device_driver_attach+0x53/0x60
    [   66.674509]        __driver_attach+0x92/0x150
    [   66.674512]        bus_for_each_dev+0x7d/0xc0
    [   66.674515]        bus_add_driver+0x14d/0x1f0
    [   66.674518]        driver_register+0x6d/0xb0
    [   66.674521]        i2c_register_driver+0x45/0x80
    [   66.674524]        do_one_initcall+0x60/0x2f4
    [   66.674528]        do_init_module+0x5c/0x230
    [   66.674531]        load_module+0x2707/0x2a20
    [   66.674534]        __do_sys_init_module+0x188/0x1b0
    [   66.674537]        do_syscall_64+0x5c/0xb0
    [   66.674541]        entry_SYSCALL_64_after_hwframe+0x49/0xbe
    [   66.674543]
                   other info that might help us debug this:
    
    [   66.674545]  Possible unsafe locking scenario:
    
    [   66.674547]        CPU0                    CPU1
    [   66.674548]        ----                    ----
    [   66.674550]   lock(i2c_register_adapter);
    [   66.674553]                                lock(intel_soc_pmic_chtwc:167:(&cht_wc_regmap_cfg)->lock);
    [   66.674556]                                lock(i2c_register_adapter);
    [   66.674559]   lock(intel_soc_pmic_chtwc:167:(&cht_wc_regmap_cfg)->lock);
    [   66.674561]
                    *** DEADLOCK ***
    
    The problem is that the CHT Whiskey Cove PMIC's builtin i2c-adapter is
    itself a part of an i2c-client (the PMIC). This means that transfers done
    through it take adapter->bus_lock twice, once for the parent i2c-adapter
    and once for its own bus_lock. Lockdep does not like this nested locking.
    
    To make lockdep happy in the case of busses with muxes, the i2c-core's
    i2c_adapter_lock_bus function calls:
    
     rt_mutex_lock_nested(&adapter->bus_lock, i2c_adapter_depth(adapter));
    
    But i2c_adapter_depth only works when the direct parent of the adapter is
    another adapter, as it is only meant for muxes. In this case there is an
    i2c-client and MFD instantiated platform_device in the parent->child chain
    between the 2 devices.
    
    This commit overrides the default i2c_lock_operations, passing a hardcoded
    depth of 1 to rt_mutex_lock_nested, making lockdep happy.
    
    Note that if there were to be a mux attached to the i2c-wc-cht adapter,
    this would break things again since the i2c-mux code expects the
    root-adapter to have a locking depth of 0. But the i2c-wc-cht adapter
    always has only 1 client directly attached in the form of the charger IC
    paired with the CHT Whiskey Cove PMIC.
    
    Signed-off-by: Hans de Goede <hdegoede@redhat.com>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit b6cb1efe18cc4d6cd75d0af2474b5176fadbbdf3
Author: Hans de Goede <hdegoede@redhat.com>
Date:   Tue Aug 13 12:03:01 2019 +0200

    i2c-cht-wc: Fix lockdep warning
    
    [ Upstream commit 232219b9a464c2479c98aa589acb1bd3383ae9d6 ]
    
    When the kernel is build with lockdep support and the i2c-cht-wc driver is
    used, the following warning is shown:
    
    [   66.674334] ======================================================
    [   66.674337] WARNING: possible circular locking dependency detected
    [   66.674340] 5.3.0-rc4+ #83 Not tainted
    [   66.674342] ------------------------------------------------------
    [   66.674345] systemd-udevd/1232 is trying to acquire lock:
    [   66.674349] 00000000a74dab07 (intel_soc_pmic_chtwc:167:(&cht_wc_regmap_cfg)->lock){+.+.}, at: regmap_write+0x31/0x70
    [   66.674360]
                   but task is already holding lock:
    [   66.674362] 00000000d44a85b7 (i2c_register_adapter){+.+.}, at: i2c_smbus_xfer+0x49/0xf0
    [   66.674370]
                   which lock already depends on the new lock.
    
    [   66.674371]
                   the existing dependency chain (in reverse order) is:
    [   66.674374]
                   -> #1 (i2c_register_adapter){+.+.}:
    [   66.674381]        rt_mutex_lock_nested+0x46/0x60
    [   66.674384]        i2c_smbus_xfer+0x49/0xf0
    [   66.674387]        i2c_smbus_read_byte_data+0x45/0x70
    [   66.674391]        cht_wc_byte_reg_read+0x35/0x50
    [   66.674394]        _regmap_read+0x63/0x1a0
    [   66.674396]        _regmap_update_bits+0xa8/0xe0
    [   66.674399]        regmap_update_bits_base+0x63/0xa0
    [   66.674403]        regmap_irq_update_bits.isra.0+0x3b/0x50
    [   66.674406]        regmap_add_irq_chip+0x592/0x7a0
    [   66.674409]        devm_regmap_add_irq_chip+0x89/0xed
    [   66.674412]        cht_wc_probe+0x102/0x158
    [   66.674415]        i2c_device_probe+0x95/0x250
    [   66.674419]        really_probe+0xf3/0x380
    [   66.674422]        driver_probe_device+0x59/0xd0
    [   66.674425]        device_driver_attach+0x53/0x60
    [   66.674428]        __driver_attach+0x92/0x150
    [   66.674431]        bus_for_each_dev+0x7d/0xc0
    [   66.674434]        bus_add_driver+0x14d/0x1f0
    [   66.674437]        driver_register+0x6d/0xb0
    [   66.674440]        i2c_register_driver+0x45/0x80
    [   66.674445]        do_one_initcall+0x60/0x2f4
    [   66.674450]        kernel_init_freeable+0x20d/0x2b4
    [   66.674453]        kernel_init+0xa/0x10c
    [   66.674457]        ret_from_fork+0x3a/0x50
    [   66.674459]
                   -> #0 (intel_soc_pmic_chtwc:167:(&cht_wc_regmap_cfg)->lock){+.+.}:
    [   66.674465]        __lock_acquire+0xe07/0x1930
    [   66.674468]        lock_acquire+0x9d/0x1a0
    [   66.674472]        __mutex_lock+0xa8/0x9a0
    [   66.674474]        regmap_write+0x31/0x70
    [   66.674480]        cht_wc_i2c_adap_smbus_xfer+0x72/0x240 [i2c_cht_wc]
    [   66.674483]        __i2c_smbus_xfer+0x1a3/0x640
    [   66.674486]        i2c_smbus_xfer+0x67/0xf0
    [   66.674489]        i2c_smbus_read_byte_data+0x45/0x70
    [   66.674494]        bq24190_probe+0x26b/0x410 [bq24190_charger]
    [   66.674497]        i2c_device_probe+0x189/0x250
    [   66.674500]        really_probe+0xf3/0x380
    [   66.674503]        driver_probe_device+0x59/0xd0
    [   66.674506]        device_driver_attach+0x53/0x60
    [   66.674509]        __driver_attach+0x92/0x150
    [   66.674512]        bus_for_each_dev+0x7d/0xc0
    [   66.674515]        bus_add_driver+0x14d/0x1f0
    [   66.674518]        driver_register+0x6d/0xb0
    [   66.674521]        i2c_register_driver+0x45/0x80
    [   66.674524]        do_one_initcall+0x60/0x2f4
    [   66.674528]        do_init_module+0x5c/0x230
    [   66.674531]        load_module+0x2707/0x2a20
    [   66.674534]        __do_sys_init_module+0x188/0x1b0
    [   66.674537]        do_syscall_64+0x5c/0xb0
    [   66.674541]        entry_SYSCALL_64_after_hwframe+0x49/0xbe
    [   66.674543]
                   other info that might help us debug this:
    
    [   66.674545]  Possible unsafe locking scenario:
    
    [   66.674547]        CPU0                    CPU1
    [   66.674548]        ----                    ----
    [   66.674550]   lock(i2c_register_adapter);
    [   66.674553]                                lock(intel_soc_pmic_chtwc:167:(&cht_wc_regmap_cfg)->lock);
    [   66.674556]                                lock(i2c_register_adapter);
    [   66.674559]   lock(intel_soc_pmic_chtwc:167:(&cht_wc_regmap_cfg)->lock);
    [   66.674561]
                    *** DEADLOCK ***
    
    The problem is that the CHT Whiskey Cove PMIC's builtin i2c-adapter is
    itself a part of an i2c-client (the PMIC). This means that transfers done
    through it take adapter->bus_lock twice, once for the parent i2c-adapter
    and once for its own bus_lock. Lockdep does not like this nested locking.
    
    To make lockdep happy in the case of busses with muxes, the i2c-core's
    i2c_adapter_lock_bus function calls:
    
     rt_mutex_lock_nested(&adapter->bus_lock, i2c_adapter_depth(adapter));
    
    But i2c_adapter_depth only works when the direct parent of the adapter is
    another adapter, as it is only meant for muxes. In this case there is an
    i2c-client and MFD instantiated platform_device in the parent->child chain
    between the 2 devices.
    
    This commit overrides the default i2c_lock_operations, passing a hardcoded
    depth of 1 to rt_mutex_lock_nested, making lockdep happy.
    
    Note that if there were to be a mux attached to the i2c-wc-cht adapter,
    this would break things again since the i2c-mux code expects the
    root-adapter to have a locking depth of 0. But the i2c-wc-cht adapter
    always has only 1 client directly attached in the form of the charger IC
    paired with the CHT Whiskey Cove PMIC.
    
    Signed-off-by: Hans de Goede <hdegoede@redhat.com>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 70bb4bf9fdfbe4441c8f3704dd72e833b9110959
Author: Hans de Goede <hdegoede@redhat.com>
Date:   Tue Aug 13 12:03:01 2019 +0200

    i2c-cht-wc: Fix lockdep warning
    
    [ Upstream commit 232219b9a464c2479c98aa589acb1bd3383ae9d6 ]
    
    When the kernel is build with lockdep support and the i2c-cht-wc driver is
    used, the following warning is shown:
    
    [   66.674334] ======================================================
    [   66.674337] WARNING: possible circular locking dependency detected
    [   66.674340] 5.3.0-rc4+ #83 Not tainted
    [   66.674342] ------------------------------------------------------
    [   66.674345] systemd-udevd/1232 is trying to acquire lock:
    [   66.674349] 00000000a74dab07 (intel_soc_pmic_chtwc:167:(&cht_wc_regmap_cfg)->lock){+.+.}, at: regmap_write+0x31/0x70
    [   66.674360]
                   but task is already holding lock:
    [   66.674362] 00000000d44a85b7 (i2c_register_adapter){+.+.}, at: i2c_smbus_xfer+0x49/0xf0
    [   66.674370]
                   which lock already depends on the new lock.
    
    [   66.674371]
                   the existing dependency chain (in reverse order) is:
    [   66.674374]
                   -> #1 (i2c_register_adapter){+.+.}:
    [   66.674381]        rt_mutex_lock_nested+0x46/0x60
    [   66.674384]        i2c_smbus_xfer+0x49/0xf0
    [   66.674387]        i2c_smbus_read_byte_data+0x45/0x70
    [   66.674391]        cht_wc_byte_reg_read+0x35/0x50
    [   66.674394]        _regmap_read+0x63/0x1a0
    [   66.674396]        _regmap_update_bits+0xa8/0xe0
    [   66.674399]        regmap_update_bits_base+0x63/0xa0
    [   66.674403]        regmap_irq_update_bits.isra.0+0x3b/0x50
    [   66.674406]        regmap_add_irq_chip+0x592/0x7a0
    [   66.674409]        devm_regmap_add_irq_chip+0x89/0xed
    [   66.674412]        cht_wc_probe+0x102/0x158
    [   66.674415]        i2c_device_probe+0x95/0x250
    [   66.674419]        really_probe+0xf3/0x380
    [   66.674422]        driver_probe_device+0x59/0xd0
    [   66.674425]        device_driver_attach+0x53/0x60
    [   66.674428]        __driver_attach+0x92/0x150
    [   66.674431]        bus_for_each_dev+0x7d/0xc0
    [   66.674434]        bus_add_driver+0x14d/0x1f0
    [   66.674437]        driver_register+0x6d/0xb0
    [   66.674440]        i2c_register_driver+0x45/0x80
    [   66.674445]        do_one_initcall+0x60/0x2f4
    [   66.674450]        kernel_init_freeable+0x20d/0x2b4
    [   66.674453]        kernel_init+0xa/0x10c
    [   66.674457]        ret_from_fork+0x3a/0x50
    [   66.674459]
                   -> #0 (intel_soc_pmic_chtwc:167:(&cht_wc_regmap_cfg)->lock){+.+.}:
    [   66.674465]        __lock_acquire+0xe07/0x1930
    [   66.674468]        lock_acquire+0x9d/0x1a0
    [   66.674472]        __mutex_lock+0xa8/0x9a0
    [   66.674474]        regmap_write+0x31/0x70
    [   66.674480]        cht_wc_i2c_adap_smbus_xfer+0x72/0x240 [i2c_cht_wc]
    [   66.674483]        __i2c_smbus_xfer+0x1a3/0x640
    [   66.674486]        i2c_smbus_xfer+0x67/0xf0
    [   66.674489]        i2c_smbus_read_byte_data+0x45/0x70
    [   66.674494]        bq24190_probe+0x26b/0x410 [bq24190_charger]
    [   66.674497]        i2c_device_probe+0x189/0x250
    [   66.674500]        really_probe+0xf3/0x380
    [   66.674503]        driver_probe_device+0x59/0xd0
    [   66.674506]        device_driver_attach+0x53/0x60
    [   66.674509]        __driver_attach+0x92/0x150
    [   66.674512]        bus_for_each_dev+0x7d/0xc0
    [   66.674515]        bus_add_driver+0x14d/0x1f0
    [   66.674518]        driver_register+0x6d/0xb0
    [   66.674521]        i2c_register_driver+0x45/0x80
    [   66.674524]        do_one_initcall+0x60/0x2f4
    [   66.674528]        do_init_module+0x5c/0x230
    [   66.674531]        load_module+0x2707/0x2a20
    [   66.674534]        __do_sys_init_module+0x188/0x1b0
    [   66.674537]        do_syscall_64+0x5c/0xb0
    [   66.674541]        entry_SYSCALL_64_after_hwframe+0x49/0xbe
    [   66.674543]
                   other info that might help us debug this:
    
    [   66.674545]  Possible unsafe locking scenario:
    
    [   66.674547]        CPU0                    CPU1
    [   66.674548]        ----                    ----
    [   66.674550]   lock(i2c_register_adapter);
    [   66.674553]                                lock(intel_soc_pmic_chtwc:167:(&cht_wc_regmap_cfg)->lock);
    [   66.674556]                                lock(i2c_register_adapter);
    [   66.674559]   lock(intel_soc_pmic_chtwc:167:(&cht_wc_regmap_cfg)->lock);
    [   66.674561]
                    *** DEADLOCK ***
    
    The problem is that the CHT Whiskey Cove PMIC's builtin i2c-adapter is
    itself a part of an i2c-client (the PMIC). This means that transfers done
    through it take adapter->bus_lock twice, once for the parent i2c-adapter
    and once for its own bus_lock. Lockdep does not like this nested locking.
    
    To make lockdep happy in the case of busses with muxes, the i2c-core's
    i2c_adapter_lock_bus function calls:
    
     rt_mutex_lock_nested(&adapter->bus_lock, i2c_adapter_depth(adapter));
    
    But i2c_adapter_depth only works when the direct parent of the adapter is
    another adapter, as it is only meant for muxes. In this case there is an
    i2c-client and MFD instantiated platform_device in the parent->child chain
    between the 2 devices.
    
    This commit overrides the default i2c_lock_operations, passing a hardcoded
    depth of 1 to rt_mutex_lock_nested, making lockdep happy.
    
    Note that if there were to be a mux attached to the i2c-wc-cht adapter,
    this would break things again since the i2c-mux code expects the
    root-adapter to have a locking depth of 0. But the i2c-wc-cht adapter
    always has only 1 client directly attached in the form of the charger IC
    paired with the CHT Whiskey Cove PMIC.
    
    Signed-off-by: Hans de Goede <hdegoede@redhat.com>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 95072b17406574d56018fb3e81b1014c4093df28
Author: Hans de Goede <hdegoede@redhat.com>
Date:   Tue Aug 13 12:03:01 2019 +0200

    i2c-cht-wc: Fix lockdep warning
    
    [ Upstream commit 232219b9a464c2479c98aa589acb1bd3383ae9d6 ]
    
    When the kernel is build with lockdep support and the i2c-cht-wc driver is
    used, the following warning is shown:
    
    [   66.674334] ======================================================
    [   66.674337] WARNING: possible circular locking dependency detected
    [   66.674340] 5.3.0-rc4+ #83 Not tainted
    [   66.674342] ------------------------------------------------------
    [   66.674345] systemd-udevd/1232 is trying to acquire lock:
    [   66.674349] 00000000a74dab07 (intel_soc_pmic_chtwc:167:(&cht_wc_regmap_cfg)->lock){+.+.}, at: regmap_write+0x31/0x70
    [   66.674360]
                   but task is already holding lock:
    [   66.674362] 00000000d44a85b7 (i2c_register_adapter){+.+.}, at: i2c_smbus_xfer+0x49/0xf0
    [   66.674370]
                   which lock already depends on the new lock.
    
    [   66.674371]
                   the existing dependency chain (in reverse order) is:
    [   66.674374]
                   -> #1 (i2c_register_adapter){+.+.}:
    [   66.674381]        rt_mutex_lock_nested+0x46/0x60
    [   66.674384]        i2c_smbus_xfer+0x49/0xf0
    [   66.674387]        i2c_smbus_read_byte_data+0x45/0x70
    [   66.674391]        cht_wc_byte_reg_read+0x35/0x50
    [   66.674394]        _regmap_read+0x63/0x1a0
    [   66.674396]        _regmap_update_bits+0xa8/0xe0
    [   66.674399]        regmap_update_bits_base+0x63/0xa0
    [   66.674403]        regmap_irq_update_bits.isra.0+0x3b/0x50
    [   66.674406]        regmap_add_irq_chip+0x592/0x7a0
    [   66.674409]        devm_regmap_add_irq_chip+0x89/0xed
    [   66.674412]        cht_wc_probe+0x102/0x158
    [   66.674415]        i2c_device_probe+0x95/0x250
    [   66.674419]        really_probe+0xf3/0x380
    [   66.674422]        driver_probe_device+0x59/0xd0
    [   66.674425]        device_driver_attach+0x53/0x60
    [   66.674428]        __driver_attach+0x92/0x150
    [   66.674431]        bus_for_each_dev+0x7d/0xc0
    [   66.674434]        bus_add_driver+0x14d/0x1f0
    [   66.674437]        driver_register+0x6d/0xb0
    [   66.674440]        i2c_register_driver+0x45/0x80
    [   66.674445]        do_one_initcall+0x60/0x2f4
    [   66.674450]        kernel_init_freeable+0x20d/0x2b4
    [   66.674453]        kernel_init+0xa/0x10c
    [   66.674457]        ret_from_fork+0x3a/0x50
    [   66.674459]
                   -> #0 (intel_soc_pmic_chtwc:167:(&cht_wc_regmap_cfg)->lock){+.+.}:
    [   66.674465]        __lock_acquire+0xe07/0x1930
    [   66.674468]        lock_acquire+0x9d/0x1a0
    [   66.674472]        __mutex_lock+0xa8/0x9a0
    [   66.674474]        regmap_write+0x31/0x70
    [   66.674480]        cht_wc_i2c_adap_smbus_xfer+0x72/0x240 [i2c_cht_wc]
    [   66.674483]        __i2c_smbus_xfer+0x1a3/0x640
    [   66.674486]        i2c_smbus_xfer+0x67/0xf0
    [   66.674489]        i2c_smbus_read_byte_data+0x45/0x70
    [   66.674494]        bq24190_probe+0x26b/0x410 [bq24190_charger]
    [   66.674497]        i2c_device_probe+0x189/0x250
    [   66.674500]        really_probe+0xf3/0x380
    [   66.674503]        driver_probe_device+0x59/0xd0
    [   66.674506]        device_driver_attach+0x53/0x60
    [   66.674509]        __driver_attach+0x92/0x150
    [   66.674512]        bus_for_each_dev+0x7d/0xc0
    [   66.674515]        bus_add_driver+0x14d/0x1f0
    [   66.674518]        driver_register+0x6d/0xb0
    [   66.674521]        i2c_register_driver+0x45/0x80
    [   66.674524]        do_one_initcall+0x60/0x2f4
    [   66.674528]        do_init_module+0x5c/0x230
    [   66.674531]        load_module+0x2707/0x2a20
    [   66.674534]        __do_sys_init_module+0x188/0x1b0
    [   66.674537]        do_syscall_64+0x5c/0xb0
    [   66.674541]        entry_SYSCALL_64_after_hwframe+0x49/0xbe
    [   66.674543]
                   other info that might help us debug this:
    
    [   66.674545]  Possible unsafe locking scenario:
    
    [   66.674547]        CPU0                    CPU1
    [   66.674548]        ----                    ----
    [   66.674550]   lock(i2c_register_adapter);
    [   66.674553]                                lock(intel_soc_pmic_chtwc:167:(&cht_wc_regmap_cfg)->lock);
    [   66.674556]                                lock(i2c_register_adapter);
    [   66.674559]   lock(intel_soc_pmic_chtwc:167:(&cht_wc_regmap_cfg)->lock);
    [   66.674561]
                    *** DEADLOCK ***
    
    The problem is that the CHT Whiskey Cove PMIC's builtin i2c-adapter is
    itself a part of an i2c-client (the PMIC). This means that transfers done
    through it take adapter->bus_lock twice, once for the parent i2c-adapter
    and once for its own bus_lock. Lockdep does not like this nested locking.
    
    To make lockdep happy in the case of busses with muxes, the i2c-core's
    i2c_adapter_lock_bus function calls:
    
     rt_mutex_lock_nested(&adapter->bus_lock, i2c_adapter_depth(adapter));
    
    But i2c_adapter_depth only works when the direct parent of the adapter is
    another adapter, as it is only meant for muxes. In this case there is an
    i2c-client and MFD instantiated platform_device in the parent->child chain
    between the 2 devices.
    
    This commit overrides the default i2c_lock_operations, passing a hardcoded
    depth of 1 to rt_mutex_lock_nested, making lockdep happy.
    
    Note that if there were to be a mux attached to the i2c-wc-cht adapter,
    this would break things again since the i2c-mux code expects the
    root-adapter to have a locking depth of 0. But the i2c-wc-cht adapter
    always has only 1 client directly attached in the form of the charger IC
    paired with the CHT Whiskey Cove PMIC.
    
    Signed-off-by: Hans de Goede <hdegoede@redhat.com>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>
    Signed-off-by: Sasha Levin <sashal@kernel.org>

commit 2252c3172cc5ecfab5aef1057f7c57b39e485f21
Author: Nishka Dasgupta <nishkadg.linux@gmail.com>
Date:   Thu Aug 15 11:28:57 2019 +0530

    i2c: stm32f7: Make structure stm32f7_i2c_algo constant
    
    Static structure stm32f7_i2c_algo, of type i2c_algorithm, is used only
    when it is assigned to constant field algo of a variable having type
    i2c_adapter. As stm32f7_i2c_algo is therefore never modified, make it
    const as well to protect it from unintended modification.
    Issue found with Coccinelle.
    
    Signed-off-by: Nishka Dasgupta <nishkadg.linux@gmail.com>
    Acked-by: Pierre-Yves MORDRET <pierre-yves.mordret@st.com>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>

commit 7077ad2ee316551b4ba9602838d09b67683e20b6
Author: Nishka Dasgupta <nishkadg.linux@gmail.com>
Date:   Mon Aug 19 13:28:54 2019 +0530

    i2c: synquacer: Make synquacer_i2c_ops constant
    
    Static structure synquacer_i2c_ops, of type i2c_adapter, is only used
    when it is copied into a field of another structure. It is not itself
    modified. Hence make it const to protect it from unintended
    modification.
    Issue found with Coccinelle.
    
    Signed-off-by: Nishka Dasgupta <nishkadg.linux@gmail.com>
    Acked-by: Ard Biesheuvel <ard.biesheuvel@linaro.org>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>

commit 67a53081e655d41a77f510377364600e5e9bf89c
Author: Nishka Dasgupta <nishkadg.linux@gmail.com>
Date:   Thu Aug 15 11:25:50 2019 +0530

    i2c: iproc: Make bcm_iproc_i2c_quirks constant
    
    Static structure bcm_iproc_i2c_quirks, of type i2c_adapter_quirks, is
    only used when being assigned to constant field quirks of a variable
    having type i2c_adapter. Hence make bcm_iproc_i2c_quirks constant as
    well to prevent it from unintended modification.
    Issue found with Coccinelle.
    
    Signed-off-by: Nishka Dasgupta <nishkadg.linux@gmail.com>
    Reviewed-by: Ray Jui <ray.jui@broadcom.com>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>

commit 232219b9a464c2479c98aa589acb1bd3383ae9d6
Author: Hans de Goede <hdegoede@redhat.com>
Date:   Tue Aug 13 12:03:01 2019 +0200

    i2c-cht-wc: Fix lockdep warning
    
    When the kernel is build with lockdep support and the i2c-cht-wc driver is
    used, the following warning is shown:
    
    [   66.674334] ======================================================
    [   66.674337] WARNING: possible circular locking dependency detected
    [   66.674340] 5.3.0-rc4+ #83 Not tainted
    [   66.674342] ------------------------------------------------------
    [   66.674345] systemd-udevd/1232 is trying to acquire lock:
    [   66.674349] 00000000a74dab07 (intel_soc_pmic_chtwc:167:(&cht_wc_regmap_cfg)->lock){+.+.}, at: regmap_write+0x31/0x70
    [   66.674360]
                   but task is already holding lock:
    [   66.674362] 00000000d44a85b7 (i2c_register_adapter){+.+.}, at: i2c_smbus_xfer+0x49/0xf0
    [   66.674370]
                   which lock already depends on the new lock.
    
    [   66.674371]
                   the existing dependency chain (in reverse order) is:
    [   66.674374]
                   -> #1 (i2c_register_adapter){+.+.}:
    [   66.674381]        rt_mutex_lock_nested+0x46/0x60
    [   66.674384]        i2c_smbus_xfer+0x49/0xf0
    [   66.674387]        i2c_smbus_read_byte_data+0x45/0x70
    [   66.674391]        cht_wc_byte_reg_read+0x35/0x50
    [   66.674394]        _regmap_read+0x63/0x1a0
    [   66.674396]        _regmap_update_bits+0xa8/0xe0
    [   66.674399]        regmap_update_bits_base+0x63/0xa0
    [   66.674403]        regmap_irq_update_bits.isra.0+0x3b/0x50
    [   66.674406]        regmap_add_irq_chip+0x592/0x7a0
    [   66.674409]        devm_regmap_add_irq_chip+0x89/0xed
    [   66.674412]        cht_wc_probe+0x102/0x158
    [   66.674415]        i2c_device_probe+0x95/0x250
    [   66.674419]        really_probe+0xf3/0x380
    [   66.674422]        driver_probe_device+0x59/0xd0
    [   66.674425]        device_driver_attach+0x53/0x60
    [   66.674428]        __driver_attach+0x92/0x150
    [   66.674431]        bus_for_each_dev+0x7d/0xc0
    [   66.674434]        bus_add_driver+0x14d/0x1f0
    [   66.674437]        driver_register+0x6d/0xb0
    [   66.674440]        i2c_register_driver+0x45/0x80
    [   66.674445]        do_one_initcall+0x60/0x2f4
    [   66.674450]        kernel_init_freeable+0x20d/0x2b4
    [   66.674453]        kernel_init+0xa/0x10c
    [   66.674457]        ret_from_fork+0x3a/0x50
    [   66.674459]
                   -> #0 (intel_soc_pmic_chtwc:167:(&cht_wc_regmap_cfg)->lock){+.+.}:
    [   66.674465]        __lock_acquire+0xe07/0x1930
    [   66.674468]        lock_acquire+0x9d/0x1a0
    [   66.674472]        __mutex_lock+0xa8/0x9a0
    [   66.674474]        regmap_write+0x31/0x70
    [   66.674480]        cht_wc_i2c_adap_smbus_xfer+0x72/0x240 [i2c_cht_wc]
    [   66.674483]        __i2c_smbus_xfer+0x1a3/0x640
    [   66.674486]        i2c_smbus_xfer+0x67/0xf0
    [   66.674489]        i2c_smbus_read_byte_data+0x45/0x70
    [   66.674494]        bq24190_probe+0x26b/0x410 [bq24190_charger]
    [   66.674497]        i2c_device_probe+0x189/0x250
    [   66.674500]        really_probe+0xf3/0x380
    [   66.674503]        driver_probe_device+0x59/0xd0
    [   66.674506]        device_driver_attach+0x53/0x60
    [   66.674509]        __driver_attach+0x92/0x150
    [   66.674512]        bus_for_each_dev+0x7d/0xc0
    [   66.674515]        bus_add_driver+0x14d/0x1f0
    [   66.674518]        driver_register+0x6d/0xb0
    [   66.674521]        i2c_register_driver+0x45/0x80
    [   66.674524]        do_one_initcall+0x60/0x2f4
    [   66.674528]        do_init_module+0x5c/0x230
    [   66.674531]        load_module+0x2707/0x2a20
    [   66.674534]        __do_sys_init_module+0x188/0x1b0
    [   66.674537]        do_syscall_64+0x5c/0xb0
    [   66.674541]        entry_SYSCALL_64_after_hwframe+0x49/0xbe
    [   66.674543]
                   other info that might help us debug this:
    
    [   66.674545]  Possible unsafe locking scenario:
    
    [   66.674547]        CPU0                    CPU1
    [   66.674548]        ----                    ----
    [   66.674550]   lock(i2c_register_adapter);
    [   66.674553]                                lock(intel_soc_pmic_chtwc:167:(&cht_wc_regmap_cfg)->lock);
    [   66.674556]                                lock(i2c_register_adapter);
    [   66.674559]   lock(intel_soc_pmic_chtwc:167:(&cht_wc_regmap_cfg)->lock);
    [   66.674561]
                    *** DEADLOCK ***
    
    The problem is that the CHT Whiskey Cove PMIC's builtin i2c-adapter is
    itself a part of an i2c-client (the PMIC). This means that transfers done
    through it take adapter->bus_lock twice, once for the parent i2c-adapter
    and once for its own bus_lock. Lockdep does not like this nested locking.
    
    To make lockdep happy in the case of busses with muxes, the i2c-core's
    i2c_adapter_lock_bus function calls:
    
     rt_mutex_lock_nested(&adapter->bus_lock, i2c_adapter_depth(adapter));
    
    But i2c_adapter_depth only works when the direct parent of the adapter is
    another adapter, as it is only meant for muxes. In this case there is an
    i2c-client and MFD instantiated platform_device in the parent->child chain
    between the 2 devices.
    
    This commit overrides the default i2c_lock_operations, passing a hardcoded
    depth of 1 to rt_mutex_lock_nested, making lockdep happy.
    
    Note that if there were to be a mux attached to the i2c-wc-cht adapter,
    this would break things again since the i2c-mux code expects the
    root-adapter to have a locking depth of 0. But the i2c-wc-cht adapter
    always has only 1 client directly attached in the form of the charger IC
    paired with the CHT Whiskey Cove PMIC.
    
    Signed-off-by: Hans de Goede <hdegoede@redhat.com>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>

commit e1a29c6c59553d80a8e17d63494c65a13fb8e241
Author: Andrzej Pietrasiewicz <andrzej.p@collabora.com>
Date:   Fri Jul 26 19:22:55 2019 +0200

    drm: Add ddc link in sysfs created by drm_connector
    
    Add generic code which creates symbolic links in sysfs, pointing to ddc
    interface used by a particular video output. For example:
    
    ls -l /sys/class/drm/card0-HDMI-A-1/ddc
    lrwxrwxrwx 1 root root 0 Jun 24 10:42 /sys/class/drm/card0-HDMI-A-1/ddc \
            -> ../../../../soc/13880000.i2c/i2c-2
    
    This makes it easy for user to associate a display with its ddc adapter
    and use e.g. ddcutil to control the chosen monitor.
    
    This patch adds an i2c_adapter pointer to struct drm_connector. Particular
    drivers can then use it instead of using their own private instance. If a
    connector contains a ddc, then create a symbolic link in sysfs.
    
    Signed-off-by: Andrzej Pietrasiewicz <andrzej.p@collabora.com>
    Acked-by: Daniel Vetter <daniel.vetter@ffwll.ch>
    Reviewed-by: Andrzej Hajda <a.hajda@samsung.com>
    Reviewed-by: Emil Velikov <emil.velikov@collabora.com>
    Reviewed-by: Sam Ravnborg <sam@ravnborg.org>
    Signed-off-by: Neil Armstrong <narmstrong@baylibre.com>
    Link: https://patchwork.freedesktop.org/patch/msgid/d470def6cd661b777faeee67b5838a4623c4010e.1564161140.git.andrzej.p@collabora.com

commit d68222d4d6647611be5a32c80a53a145e7c80ce9
Author: Wolfram Sang <wsa@the-dreams.de>
Date:   Mon Jun 3 10:25:32 2019 +0200

    i2c: headers: always have a named variable in arguments
    
    Much better to read and understand. Naming for i2c_adapter is not
    consistent (yet), so use the name which is also used in core code.
    
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>

commit 5213d7efc8ec26ed8938dce75427eff9275a62d9
Author: Ruslan Babayev <ruslan@babayev.com>
Date:   Tue May 28 16:02:32 2019 -0700

    i2c: acpi: export i2c_acpi_find_adapter_by_handle
    
    This allows drivers to lookup i2c adapters on ACPI based systems similar to
    of_get_i2c_adapter_by_node() with DT based systems.
    
    Signed-off-by: Ruslan Babayev <ruslan@babayev.com>
    Reviewed-by: Andrew Lunn <andrew@lunn.ch>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>

commit 3b87cc6feccbf472402e4733120e86fb2233ed5c
Merge: 517f4c49aafc 7ce236fafd0b
Author: David S. Miller <davem@davemloft.net>
Date:   Thu May 30 11:27:47 2019 -0700

    Merge branch 'Enable-SFP-on-ACPI-based-systems'
    
    Ruslan Babayev says:
    
    ====================
    Enable SFP on ACPI based systems
    
    Changes:
    v2:
            - more descriptive commit body
    v3:
            - made 'i2c_acpi_find_adapter_by_handle' static inline
    v4:
            - don't initialize i2c_adapter to NULL. Instead see below...
            - handle the case of neither DT nor ACPI present as invalid.
            - alphabetical includes.
            - use has_acpi_companion().
            - use the same argument name in i2c_acpi_find_adapter_by_handle()
              in both stubbed and non-stubbed cases.
    ====================
    
    Signed-off-by: David S. Miller <davem@davemloft.net>

commit 1e91a2e5d827e643cbabad66d133f155a7fcb0de
Author: Ruslan Babayev <ruslan@babayev.com>
Date:   Tue May 28 16:02:32 2019 -0700

    i2c: acpi: export i2c_acpi_find_adapter_by_handle
    
    This allows drivers to lookup i2c adapters on ACPI based systems similar to
    of_get_i2c_adapter_by_node() with DT based systems.
    
    Signed-off-by: Ruslan Babayev <ruslan@babayev.com>
    Cc: xe-linux-external@cisco.com
    Reviewed-by: Andrew Lunn <andrew@lunn.ch>
    Signed-off-by: David S. Miller <davem@davemloft.net>

commit 8f5a04152e26d1803f1bde5b2f722e7a4db96935
Author: Ard Biesheuvel <ard.biesheuvel@linaro.org>
Date:   Tue Apr 30 11:47:34 2019 +0200

    i2c: synquacer: fix enumeration of slave devices
    
    commit 95e0cf3caeb11e1b0398c747b5cfa12828263824 upstream.
    
    The I2C host driver for SynQuacer fails to populate the of_node and
    ACPI companion fields of the struct i2c_adapter it instantiates,
    resulting in enumeration of the subordinate I2C bus to fail.
    
    Fixes: 0d676a6c4390 ("i2c: add support for Socionext SynQuacer I2C controller")
    Cc: <stable@vger.kernel.org> # v4.19+
    Signed-off-by: Ard Biesheuvel <ard.biesheuvel@linaro.org>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit d1493c5cbbada3da308352ce9520bc976fa9ced6
Author: Ard Biesheuvel <ard.biesheuvel@linaro.org>
Date:   Tue Apr 30 11:47:34 2019 +0200

    i2c: synquacer: fix enumeration of slave devices
    
    commit 95e0cf3caeb11e1b0398c747b5cfa12828263824 upstream.
    
    The I2C host driver for SynQuacer fails to populate the of_node and
    ACPI companion fields of the struct i2c_adapter it instantiates,
    resulting in enumeration of the subordinate I2C bus to fail.
    
    Fixes: 0d676a6c4390 ("i2c: add support for Socionext SynQuacer I2C controller")
    Cc: <stable@vger.kernel.org> # v4.19+
    Signed-off-by: Ard Biesheuvel <ard.biesheuvel@linaro.org>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 95e0cf3caeb11e1b0398c747b5cfa12828263824
Author: Ard Biesheuvel <ard.biesheuvel@linaro.org>
Date:   Tue Apr 30 11:47:34 2019 +0200

    i2c: synquacer: fix enumeration of slave devices
    
    The I2C host driver for SynQuacer fails to populate the of_node and
    ACPI companion fields of the struct i2c_adapter it instantiates,
    resulting in enumeration of the subordinate I2C bus to fail.
    
    Fixes: 0d676a6c4390 ("i2c: add support for Socionext SynQuacer I2C controller")
    Cc: <stable@vger.kernel.org> # v4.19+
    Signed-off-by: Ard Biesheuvel <ard.biesheuvel@linaro.org>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>

commit f6ac28d61675e05cb1227cbba44ff538f8671e54
Author: Wolfram Sang <wsa+renesas@sang-engineering.com>
Date:   Sat Mar 2 14:47:29 2019 +0100

    i2c: apply coding style for struct i2c_adapter
    
    Signed-off-by: Wolfram Sang <wsa+renesas@sang-engineering.com>
    Reviewed-by: Simon Horman <horms+renesas@verge.net.au>
    Reviewed-by: Andy Shevchenko <andy.shevchenko@gmail.com>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>

commit b67d4530cdade7ebfafa2c6b46f2a0dad3e41bcb
Author: Sowjanya Komatineni <skomatineni@nvidia.com>
Date:   Tue Jan 8 13:59:10 2019 -0800

    i2c: tegra: Fix Maximum transfer size
    
    Tegra194 supports maximum 64K Bytes transfer per packet.
    Tegra186 and prior supports maximum 4K Bytes transfer per packet.
    
    This patch fixes this payload difference between Tegra194 and prior
    Tegra chipsets using separate i2c_adapter_quirks.
    
    Signed-off-by: Sowjanya Komatineni <skomatineni@nvidia.com>
    Acked-by: Thierry Reding <treding@nvidia.com>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>

commit a095f15c00e2788bd83f4e9aa64ef303cae8e649
Author: Sandeep Panda <spanda@codeaurora.org>
Date:   Fri Jul 20 12:24:02 2018 +0530

    drm/bridge: add support for sn65dsi86 bridge driver
    
    Add support for TI's sn65dsi86 dsi2edp bridge chip.
    The chip converts DSI transmitted signal to eDP signal,
    which is fed to the connected eDP panel.
    
    This chip can be controlled via either i2c interface or
    dsi interface. Currently in driver all the control registers
    are being accessed through i2c interface only.
    Also as of now HPD support has not been added to bridge
    chip driver.
    
    Changes in v1:
     - Split the dt-bindings and the driver support into separate patches
       (Andrzej Hajda).
     - Use of gpiod APIs to parse and configure gpios instead of obsolete ones
       (Andrzej Hajda).
     - Use macros to define the register offsets (Andrzej Hajda).
    
    Changes in v2:
     - Separate out edp panel specific HW resource handling from bridge
       driver and create a separate edp panel drivers to handle panel
       specific mode information and HW resources (Sean Paul).
     - Replace pr_* APIs to DRM_* APIs to log error or debug information
       (Sean Paul).
     - Remove some of the unnecessary structure/variable from driver (Sean
       Paul).
     - Rename the function and structure prefix "sn65dsi86" to "ti_sn_bridge"
       (Sean Paul / Rob Herring).
     - Remove most of the hard-coding and modified the bridge init sequence
       based on current mode (Sean Paul).
     - Remove the existing function to retrieve the EDID data and
       implemented this as an i2c_adapter and use drm_get_edid() (Sean Paul).
     - Remove the dummy irq handler implementation, will add back the
       proper irq handling later (Sean Paul).
     - Capture the required enable gpios in a single array based on dt entry
       instead of having individual descriptor for each gpio (Sean Paul).
    
    Changes in v3:
     - Remove usage of irq_gpio and replace it as "interrupts" property (Rob
       Herring).
     - Remove the unnecessary header file inclusions (Sean Paul).
     - Rearrange the header files in alphabetical order (Sean Paul).
     - Use regmap interface to perform i2c transactions.
     - Update Copyright/License field and address other review comments
       (Jordan Crouse).
    
    Changes in v4:
     - Update License/Copyright (Sean Paul).
     - Add Kconfig and Makefile changes (Sean Paul).
     - Drop i2c gpio handling from this bridge driver, since i2c sda/scl gpios
       will be handled by i2c master.
     - Update required supplies names.
     - Remove unnecessary goto statements (Sean Paul).
     - Add mutex lock to power_ctrl API to avoid race conditions (Sean
       Paul).
     - Add support to parse reference clk frequency from dt(optional).
     - Update the bridge chip enable/disable sequence.
    
    Changes in v5:
     - Fixed Kbuild test service reported warnings.
    
    Changes in v6:
     - Use PM runtime based ref-counting instead of local ref_count mechanism
       (Stephen Boyd).
     - Clean up some debug logs and indentations (Sean Paul).
     - Simplify dp rate calculation (Sean Paul).
     - Add support to configure refclk based on input REFCLK pin or DACP/N
       pin (Stephen Boyd).
    
    Changes in v7:
     - Use static supply entries instead of dynamic allocation (Andrzej
       Hajda).
     - Defer bridge driver probe if panel is not probed (Andrzej Hajda).
     - Update of_graph APIs for correct node reference management. (Andrzej
       Hajda).
     - Remove local display_mode object (Andrzej Hajda).
     - Remove version id check function from driver.
    
    Changes in v8:
     - Move dsi register/attach function to bridge driver probe (Andrzej
       Hajda).
     - Introduce a new helper function to write 16bit words into consecutive
       registers (Andrzej Hajda).
     - Remove unnecessary macros (Andrzej Hajda).
    
    Changes in v9:
     - Remove dsi register/attach from bridge probe, since dsi dev register
       completion also waits for any panel or bridge to get added. This creates
       deadlock situation when bridge driver calls dsi dev register and
       attach before bridge add, in its probe function.
     - Fix issues faced during testing of bridge driver on actual HW.
     - Remove unnecessary initializations (Stephen Boyd).
     - Use local refclk lut size instead of global macro (Sean Paul).
    
    Changes in v10:
     - Use refclk to determine if continuous dsi clock is needed or not.
    
    Changes in v11:
     - Read DPPLL_SRC register to determine continuous clock instead of
       using refclk handle (Stephen Boyd).
    
    Changes in v12:
     - Explain in comment as in why dsi dev registration is done in
       bridge_attach (Andrzej Hajda).
     - Move HPD disable to bridge_pre_enable (Andrzej Hajda).
     - Make panel/DDC exclusive until HPD support is added (Andrzej Hajda).
    
    Changes in v13:
     - eDP panels report EDID via DP-AUX channel, so remove support for
       dedicated DDC line (Andrzej Hajda).
    
    Changes in v14:
     - Remove unnecessary drm_panel checks (Andrzej Hajda).
    
    Signed-off-by: Sandeep Panda <spanda@codeaurora.org>
    Reviewed-by: Andrzej Hajda <a.hajda@samsung.com>
    Signed-off-by: Andrzej Hajda <a.hajda@samsung.com>
    Link: https://patchwork.freedesktop.org/patch/msgid/1532069642-21392-1-git-send-email-spanda@codeaurora.org

commit eb6b0d6987fc58c5dc79abba8a82e1fe999ef602
Author: Sekhar Nori <nsekhar@ti.com>
Date:   Fri May 11 20:51:35 2018 +0530

    ARM: davinci: board-dm646x-evm: pass correct I2C adapter id for VPIF
    
    [ Upstream commit 7d46899d57f8b61eb28701d9a4043b71e3392c26 ]
    
    commit a16cb91ad9c4 ("[media] media: vpif: use a configurable
    i2c_adapter_id for vpif display") removed hardcoded I2C adaptor
    setting in VPIF driver, but missed updating platform data passed
    from DM646x board.
    
    Fix it.
    
    Fixes: a16cb91ad9c4 ("[media] media: vpif: use a configurable i2c_adapter_id for vpif display")
    Signed-off-by: Sekhar Nori <nsekhar@ti.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit ae7151af409820e28b699d7eeb282f5cbb51d985
Author: Sekhar Nori <nsekhar@ti.com>
Date:   Fri May 11 20:51:35 2018 +0530

    ARM: davinci: board-dm646x-evm: pass correct I2C adapter id for VPIF
    
    [ Upstream commit 7d46899d57f8b61eb28701d9a4043b71e3392c26 ]
    
    commit a16cb91ad9c4 ("[media] media: vpif: use a configurable
    i2c_adapter_id for vpif display") removed hardcoded I2C adaptor
    setting in VPIF driver, but missed updating platform data passed
    from DM646x board.
    
    Fix it.
    
    Fixes: a16cb91ad9c4 ("[media] media: vpif: use a configurable i2c_adapter_id for vpif display")
    Signed-off-by: Sekhar Nori <nsekhar@ti.com>
    Signed-off-by: Sasha Levin <alexander.levin@microsoft.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 7d46899d57f8b61eb28701d9a4043b71e3392c26
Author: Sekhar Nori <nsekhar@ti.com>
Date:   Fri May 11 20:51:35 2018 +0530

    ARM: davinci: board-dm646x-evm: pass correct I2C adapter id for VPIF
    
    commit a16cb91ad9c4 ("[media] media: vpif: use a configurable
    i2c_adapter_id for vpif display") removed hardcoded I2C adaptor
    setting in VPIF driver, but missed updating platform data passed
    from DM646x board.
    
    Fix it.
    
    Fixes: a16cb91ad9c4 ("[media] media: vpif: use a configurable i2c_adapter_id for vpif display")
    Signed-off-by: Sekhar Nori <nsekhar@ti.com>

commit 62208c5703b166681aa590b122263a026d4f9471
Author: Daniel Scheller <d.scheller@gmx.net>
Date:   Sun Apr 22 12:06:51 2018 -0400

    media: ngene: cleanup superfluous I2C adapter evaluation
    
    Commit ee93340e98bc ("media: ngene: deduplicate I2C adapter evaluation")
    added a helper to evaluate the I2C adapter to be used for demod/tuner
    attachment based on the given ngene_channel, and that helper is used in
    many attach functions to initialise the i2c_adapter variable. However,
    for some reason in tuner_attach_stv6110() and demod_attach_stv0900(), the
    adapter evaluation wasn't removed as in all other functions. Fix (or
    finalize, even) the helper use by cleaning up the superfluous I2C adapter
    evaluation leftover in these two functions.
    
    Signed-off-by: Daniel Scheller <d.scheller@gmx.net>
    Signed-off-by: Mauro Carvalho Chehab <mchehab+samsung@kernel.org>

commit 028a9e5c06d82aefbe4c508e045a1ee3be414cc0
Author: Jeffy Chen <jeffy.chen@rock-chips.com>
Date:   Fri Mar 2 18:57:55 2018 +0100

    drm/rockchip: inno_hdmi: reorder clk_disable_unprepare call in unbind
    
    In bind the clk_prepare_enable of the HDMI pclk is called before adding the
    i2c_adapter. So it should be the other way around in unbind, first remove
    the i2c_adapter and then call the clk_disable_unprepare.
    
    Fixes: 412d4ae6b7a5 ("drm/rockchip: hdmi: add Innosilicon HDMI support")
    Signed-off-by: Jeffy Chen <jeffy.chen@rock-chips.com>
    Signed-off-by: Thierry Escande <thierry.escande@collabora.com>
    Signed-off-by: Enric Balletbo i Serra <enric.balletbo@collabora.com>
    Signed-off-by: Heiko Stuebner <heiko@sntech.de>
    Link: https://patchwork.freedesktop.org/patch/msgid/20180302175757.28192-4-enric.balletbo@collabora.com

commit b312598dd48ddf22a0d144ca08b898da605a9f1f
Author: Xiongfeng Wang <xiongfeng.wang@linaro.org>
Date:   Mon Jan 8 07:52:34 2018 -0500

    media: dibx000_common: use strlcpy() instead of strncpy()
    
    gcc-8 reports
    
    drivers/media/dvb-frontends/dibx000_common.c: In function
    'i2c_adapter_init':
    ./include/linux/string.h:245:9: warning: '__builtin_strncpy' specified
    bound 48 equals destination size [-Wstringop-truncation]
    
    We need to use strlcpy() to make sure the dest string is
    nul-terminated.
    
    Signed-off-by: Xiongfeng Wang <xiongfeng.wang@linaro.org>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@s-opensource.com>

commit 7623bd95a6dccf74e30a21e437f2f789fbbe27f7
Author: Troy Kisky <troy.kisky@boundarydevices.com>
Date:   Thu Nov 2 18:58:15 2017 -0700

    rtc: m41t80: avoid i2c read in m41t80_sqw_is_prepared
    
    commit 13bb1d78f2e372ec0d9b30489ac63768240140fc upstream.
    
    This is a little more efficient and avoids the warning
    
     WARNING: possible circular locking dependency detected
     4.14.0-rc7-00010 #16 Not tainted
     ------------------------------------------------------
     kworker/2:1/70 is trying to acquire lock:
      (prepare_lock){+.+.}, at: [<c049300c>] clk_prepare_lock+0x80/0xf4
    
     but task is already holding lock:
      (i2c_register_adapter){+.+.}, at: [<c0690b04>]
                    i2c_adapter_lock_bus+0x14/0x18
    
     which lock already depends on the new lock.
    
     the existing dependency chain (in reverse order) is:
    
     -> #1 (i2c_register_adapter){+.+.}:
            rt_mutex_lock+0x44/0x5c
            i2c_adapter_lock_bus+0x14/0x18
            i2c_transfer+0xa8/0xbc
            i2c_smbus_xfer+0x20c/0x5d8
            i2c_smbus_read_byte_data+0x38/0x48
            m41t80_sqw_is_prepared+0x18/0x28
    
    Signed-off-by: Troy Kisky <troy.kisky@boundarydevices.com>
    Signed-off-by: Alexandre Belloni <alexandre.belloni@free-electrons.com>
    Cc: Christoph Fritz <chf.fritz@googlemail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 11118640ae1705c57699a394d0754d4c699772c6
Author: Troy Kisky <troy.kisky@boundarydevices.com>
Date:   Thu Nov 2 18:58:14 2017 -0700

    rtc: m41t80: avoid i2c read in m41t80_sqw_recalc_rate
    
    commit 2cb90ed3de1e279dbaf23df141f54eb9fb1861e6 upstream.
    
    This is a little more efficient, and avoids the warning
    
     WARNING: possible circular locking dependency detected
     4.14.0-rc7-00007 #14 Not tainted
     ------------------------------------------------------
     alsactl/330 is trying to acquire lock:
     (prepare_lock){+.+.}, at: [<c049300c>] clk_prepare_lock+0x80/0xf4
    
     but task is already holding lock:
     (i2c_register_adapter){+.+.}, at: [<c0690ae0>]
                    i2c_adapter_lock_bus+0x14/0x18
    
     which lock already depends on the new lock.
    
     the existing dependency chain (in reverse order) is:
    
     -> #1 (i2c_register_adapter){+.+.}:
            rt_mutex_lock+0x44/0x5c
            i2c_adapter_lock_bus+0x14/0x18
            i2c_transfer+0xa8/0xbc
            i2c_smbus_xfer+0x20c/0x5d8
            i2c_smbus_read_byte_data+0x38/0x48
            m41t80_sqw_recalc_rate+0x24/0x58
    
    Signed-off-by: Troy Kisky <troy.kisky@boundarydevices.com>
    Signed-off-by: Alexandre Belloni <alexandre.belloni@free-electrons.com>
    Cc: Christoph Fritz <chf.fritz@googlemail.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit 021c01d3dc8291105338b455b994a48b807f26c3
Author: Mauro Carvalho Chehab <mchehab@s-opensource.com>
Date:   Wed Nov 1 17:05:55 2017 -0400

    media: dvbsky: shut up a bogus warning
    
    Smatch gives two bogus warnings on this driver:
            drivers/media/usb/dvb-usb-v2/dvbsky.c:336 dvbsky_s960_attach() error: uninitialized symbol 'i2c_adapter'.
            drivers/media/usb/dvb-usb-v2/dvbsky.c:459 dvbsky_s960c_attach() error: uninitialized symbol 'i2c_adapter'.
    
    Shut them up.
    
    Signed-off-by: Mauro Carvalho Chehab <mchehab@s-opensource.com>

commit 13bb1d78f2e372ec0d9b30489ac63768240140fc
Author: Troy Kisky <troy.kisky@boundarydevices.com>
Date:   Thu Nov 2 18:58:15 2017 -0700

    rtc: m41t80: avoid i2c read in m41t80_sqw_is_prepared
    
    This is a little more efficient and avoids the warning
    
     WARNING: possible circular locking dependency detected
     4.14.0-rc7-00010 #16 Not tainted
     ------------------------------------------------------
     kworker/2:1/70 is trying to acquire lock:
      (prepare_lock){+.+.}, at: [<c049300c>] clk_prepare_lock+0x80/0xf4
    
     but task is already holding lock:
      (i2c_register_adapter){+.+.}, at: [<c0690b04>]
                    i2c_adapter_lock_bus+0x14/0x18
    
     which lock already depends on the new lock.
    
     the existing dependency chain (in reverse order) is:
    
     -> #1 (i2c_register_adapter){+.+.}:
            rt_mutex_lock+0x44/0x5c
            i2c_adapter_lock_bus+0x14/0x18
            i2c_transfer+0xa8/0xbc
            i2c_smbus_xfer+0x20c/0x5d8
            i2c_smbus_read_byte_data+0x38/0x48
            m41t80_sqw_is_prepared+0x18/0x28
    
    Signed-off-by: Troy Kisky <troy.kisky@boundarydevices.com>
    Signed-off-by: Alexandre Belloni <alexandre.belloni@free-electrons.com>

commit 2cb90ed3de1e279dbaf23df141f54eb9fb1861e6
Author: Troy Kisky <troy.kisky@boundarydevices.com>
Date:   Thu Nov 2 18:58:14 2017 -0700

    rtc: m41t80: avoid i2c read in m41t80_sqw_recalc_rate
    
    This is a little more efficient, and avoids the warning
    
     WARNING: possible circular locking dependency detected
     4.14.0-rc7-00007 #14 Not tainted
     ------------------------------------------------------
     alsactl/330 is trying to acquire lock:
     (prepare_lock){+.+.}, at: [<c049300c>] clk_prepare_lock+0x80/0xf4
    
     but task is already holding lock:
     (i2c_register_adapter){+.+.}, at: [<c0690ae0>]
                    i2c_adapter_lock_bus+0x14/0x18
    
     which lock already depends on the new lock.
    
     the existing dependency chain (in reverse order) is:
    
     -> #1 (i2c_register_adapter){+.+.}:
            rt_mutex_lock+0x44/0x5c
            i2c_adapter_lock_bus+0x14/0x18
            i2c_transfer+0xa8/0xbc
            i2c_smbus_xfer+0x20c/0x5d8
            i2c_smbus_read_byte_data+0x38/0x48
            m41t80_sqw_recalc_rate+0x24/0x58
    
    Signed-off-by: Troy Kisky <troy.kisky@boundarydevices.com>
    Signed-off-by: Alexandre Belloni <alexandre.belloni@free-electrons.com>

commit d2d8f51e28fec278e9632cdd029facf813f579a3
Merge: ad9a19d00370 8ce906c13c32
Author: Linus Torvalds <torvalds@linux-foundation.org>
Date:   Sat Sep 9 14:18:40 2017 -0700

    Merge branch 'i2c/for-4.14' of git://git.kernel.org/pub/scm/linux/kernel/git/wsa/linux
    
    Pull i2c updates from Wolfram Sang:
    
     - new drivers for Spreadtrum I2C, Intel Cherry Trail Whiskey Cove SMBUS
    
     - quite some driver updates
    
     - cleanups for the i2c-mux subsystem
    
     - some subsystem-wide constification
    
     - further cleanup of include/linux/i2c
    
    * 'i2c/for-4.14' of git://git.kernel.org/pub/scm/linux/kernel/git/wsa/linux: (50 commits)
      i2c: sprd: Fix undefined reference errors
      i2c: nomadik: constify amba_id
      i2c: versatile: Make i2c_algo_bit_data const
      i2c: busses: make i2c_adapter_quirks const
      i2c: busses: make i2c_adapter const
      i2c: busses: make i2c_algorithm const
      i2c: Add Spreadtrum I2C controller driver
      dt-bindings: i2c: Add Spreadtrum I2C controller documentation
      i2c-cht-wc: make cht_wc_i2c_adap_driver static
      MAINTAINERS: Add entry for drivers/i2c/busses/i2c-cht-wc.c
      i2c: aspeed: Retain delay/setup/hold values when configuring bus frequency
      dt-bindings: i2c: eeprom: Document vendor to be used and deprecated ones
      i2c: i801: Restore the presence state of P2SB PCI device after reading BAR
      MAINTAINERS: drop entry for Blackfin I2C and Sonic's email
      blackfin: merge the two TWI header files
      i2c: davinci: Preserve return value of devm_clk_get
      i2c: mediatek: Add i2c compatible for MediaTek MT7622
      dt-bindings: i2c: Add MediaTek MT7622 i2c binding
      dt-bindings: i2c: modify information formats
      i2c: mux: i2c-arb-gpio-challenge: allow compiling w/o OF support
      ...

commit ae3923a284cc696311294022e9b1a49058f07387
Author: Bhumika Goyal <bhumirks@gmail.com>
Date:   Mon Aug 21 17:42:04 2017 +0530

    i2c: busses: make i2c_adapter_quirks const
    
    Make these const as they are only stored as a reference in the quirks
    field of an i2c_adapter structure, which is const. Done using
    Coccinelle.
    
    Signed-off-by: Bhumika Goyal <bhumirks@gmail.com>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>

commit 329430ccfc9ff864315974cf2fe7a35b00be5e9f
Author: Bhumika Goyal <bhumirks@gmail.com>
Date:   Sat Aug 19 16:04:12 2017 +0530

    i2c: busses: make i2c_adapter const
    
    Make these const as they are only used in a copy operation.
    Done using Coccinelle.
    
    Signed-off-by: Bhumika Goyal <bhumirks@gmail.com>
    Acked-by: David Daney <david.daney@cavium.com>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>

commit ad3caf8abc385b974d863b7a7a2950f4b089fee8
Author: Bhumika Goyal <bhumirks@gmail.com>
Date:   Fri Aug 18 21:36:57 2017 +0530

    i2c: busses: make i2c_algorithm const
    
    Make these const as they are only stored in the algo field of
    i2c_adapter structure, which is const.
    
    Signed-off-by: Bhumika Goyal <bhumirks@gmail.com>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>

commit 6843868fd092406b544064e4db1ca902af13cf48
Author: Bhumika Goyal <bhumirks@gmail.com>
Date:   Sat Aug 19 06:34:15 2017 -0400

    media: usb: make i2c_adapter const
    
    Make these const as they are only used in a copy operation.
    Done using Coccinelle
    
    Signed-off-by: Bhumika Goyal <bhumirks@gmail.com>
    Acked-by: Mike Isely <isely@pobox.com>
    Signed-off-by: Hans Verkuil <hans.verkuil@cisco.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@s-opensource.com>

commit 9a5c43b3d22f17125044f17256a125d2bd13559d
Author: Bhumika Goyal <bhumirks@gmail.com>
Date:   Sat Aug 19 06:34:14 2017 -0400

    media: radio-usb-si4713: make i2c_adapter const
    
    Make this const as it is only used in a copy operation.
    Done using Coccinelle
    
    Signed-off-by: Bhumika Goyal <bhumirks@gmail.com>
    Signed-off-by: Hans Verkuil <hans.verkuil@cisco.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@s-opensource.com>

commit e5fffebe6d39cf8ad0a7628822d9c3a519523135
Author: Bhumika Goyal <bhumirks@gmail.com>
Date:   Sat Aug 19 06:34:13 2017 -0400

    media: pci: make i2c_adapter const
    
    Make these const as they are only used in a copy operation.
    Done using Coccinelle
    
    Signed-off-by: Bhumika Goyal <bhumirks@gmail.com>
    Signed-off-by: Hans Verkuil <hans.verkuil@cisco.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@s-opensource.com>

commit d746cf89b4b7e60f5b7239b3ef8e8af01d11f604
Author: Bhumika Goyal <bhumirks@gmail.com>
Date:   Fri Aug 18 12:06:58 2017 -0400

    media: usb: make i2c_algorithm const
    
    Make these const as they are only used in a copy operation or
    are stored in the algo field of i2c_adapter structure, which is const.
    
    Signed-off-by: Bhumika Goyal <bhumirks@gmail.com>
    Acked-by: Mike Isely <isely@pobox.com>
    Signed-off-by: Hans Verkuil <hans.verkuil@cisco.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@s-opensource.com>

commit 8dc0f8c73c54c9d1a7fe8188ef3e70123a960eaf
Author: Gustavo A. R. Silva <garsilva@embeddedor.com>
Date:   Sun Jul 9 15:57:44 2017 -0500

    i2c: constify internal structures
    
    Check for i2c_algorithm and i2c_adapter_quirks structures that are only
    stored in the algo and quirks fields of an i2c_adapter structure
    correspondingly. These fields are declared const, so i2c_algorithm and
    i2c_adapter_quirks structures that have this property can be declared
    as const also.
    
    Signed-off-by: Gustavo A. R. Silva <garsilva@embeddedor.com>
    Acked-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com> (for designware)
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>

commit 62055056da6a722ab770d45bad63ed41dfb4f283
Author: Gustavo A. R. Silva <garsilva@embeddedor.com>
Date:   Sun Jul 9 21:12:37 2017 -0400

    media: ngene: constify i2c_algorithm structure
    
    Check for i2c_algorithm structures that are only stored in
    the algo field of an i2c_adapter structure. This field is
    declared const, so i2c_algorithm structures that have this
    property can be declared as const also.
    
    This issue was identified using Coccinelle and the following
    semantic patch:
    
    @r disable optional_qualifier@
    identifier i;
    position p;
    @@
    static struct i2c_algorithm i@p = { ... };
    
    @ok@
    identifier r.i;
    struct i2c_adapter e;
    position p;
    @@
    e.algo = &i@p;
    
    @bad@
    position p != {r.p,ok.p};
    identifier r.i;
    @@
    i@p
    
    @depends on !bad disable optional_qualifier@
    identifier r.i;
    @@
    static
    +const
     struct i2c_algorithm i = { ... };
    
    Signed-off-by: Gustavo A. R. Silva <garsilva@embeddedor.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@s-opensource.com>

commit e46ab9dc4a2bffad9f49123136b22f6eec88a82c
Author: Gustavo A. R. Silva <garsilva@embeddedor.com>
Date:   Sun Jul 9 21:10:00 2017 -0400

    media: mantis: constify i2c_algorithm structure
    
    Check for i2c_algorithm structures that are only stored in
    the algo field of an i2c_adapter structure. This field is
    declared const, so i2c_algorithm structures that have this
    property can be declared as const also.
    
    This issue was identified using Coccinelle and the following
    semantic patch:
    
    @r disable optional_qualifier@
    identifier i;
    position p;
    @@
    static struct i2c_algorithm i@p = { ... };
    
    @ok@
    identifier r.i;
    struct i2c_adapter e;
    position p;
    @@
    e.algo = &i@p;
    
    @bad@
    position p != {r.p,ok.p};
    identifier r.i;
    @@
    i@p
    
    @depends on !bad disable optional_qualifier@
    identifier r.i;
    @@
    static
    +const
     struct i2c_algorithm i = { ... };
    
    Signed-off-by: Gustavo A. R. Silva <garsilva@embeddedor.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@s-opensource.com>

commit 3c13978ead17b7421b0d6dc76d2db9dc12fc1844
Author: Gustavo A. R. Silva <garsilva@embeddedor.com>
Date:   Sun Jul 9 21:19:36 2017 -0400

    media: dm1105: constify i2c_algorithm structure
    
    Check for i2c_algorithm structures that are only stored in
    the algo field of an i2c_adapter structure. This field is
    declared const, so i2c_algorithm structures that have this
    property can be declared as const also.
    
    This issue was identified using Coccinelle and the following
    semantic patch:
    
    @r disable optional_qualifier@
    identifier i;
    position p;
    @@
    static struct i2c_algorithm i@p = { ... };
    
    @ok@
    identifier r.i;
    struct i2c_adapter e;
    position p;
    @@
    e.algo = &i@p;
    
    @bad@
    position p != {r.p,ok.p};
    identifier r.i;
    @@
    i@p
    
    @depends on !bad disable optional_qualifier@
    identifier r.i;
    @@
    static
    +const
     struct i2c_algorithm i = { ... };
    
    Signed-off-by: Gustavo A. R. Silva <garsilva@embeddedor.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@s-opensource.com>

commit 618e8aac3d7ccbf49b170181a6f3a418ba6e5419
Author: Gustavo A. R. Silva <garsilva@embeddedor.com>
Date:   Sun Jul 9 21:15:36 2017 -0400

    media: ddbridge: constify i2c_algorithm structure
    
    Check for i2c_algorithm structures that are only stored in
    the algo field of an i2c_adapter structure. This field is
    declared const, so i2c_algorithm structures that have this
    property can be declared as const also.
    
    This issue was identified using Coccinelle and the following
    semantic patch:
    
    @r disable optional_qualifier@
    identifier i;
    position p;
    @@
    static struct i2c_algorithm i@p = { ... };
    
    @ok@
    identifier r.i;
    struct i2c_adapter e;
    position p;
    @@
    e.algo = &i@p;
    
    @bad@
    position p != {r.p,ok.p};
    identifier r.i;
    @@
    i@p
    
    @depends on !bad disable optional_qualifier@
    identifier r.i;
    @@
    static
    +const
     struct i2c_algorithm i = { ... };
    
    Signed-off-by: Gustavo A. R. Silva <garsilva@embeddedor.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@s-opensource.com>

commit 6ac8b81ec996228e41a8bb1f14450adf8b697913
Author: Gustavo A. R. Silva <garsilva@embeddedor.com>
Date:   Sun Jul 9 21:06:51 2017 -0400

    media: cx24123: constify i2c_algorithm structure
    
    Check for i2c_algorithm structures that are only stored in
    the algo field of an i2c_adapter structure. This field is
    declared const, so i2c_algorithm structures that have this
    property can be declared as const also.
    
    This issue was identified using Coccinelle and the following
    semantic patch:
    
    @r disable optional_qualifier@
    identifier i;
    position p;
    @@
    static struct i2c_algorithm i@p = { ... };
    
    @ok@
    identifier r.i;
    struct i2c_adapter e;
    position p;
    @@
    e.algo = &i@p;
    
    @bad@
    position p != {r.p,ok.p};
    identifier r.i;
    @@
    i@p
    
    @depends on !bad disable optional_qualifier@
    identifier r.i;
    @@
    static
    +const
     struct i2c_algorithm i = { ... };
    
    Signed-off-by: Gustavo A. R. Silva <garsilva@embeddedor.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@s-opensource.com>

commit c51df136e5d12dc50954ed454f90b5df718f299d
Author: Gustavo A. R. Silva <garsilva@embeddedor.com>
Date:   Sun Jul 9 21:03:52 2017 -0400

    media: zd1301_demod: constify i2c_algorithm structure
    
    Check for i2c_algorithm structures that are only stored in
    the algo field of an i2c_adapter structure. This field is
    declared const, so i2c_algorithm structures that have this
    property can be declared as const also.
    
    This issue was identified using Coccinelle and the following
    semantic patch:
    
    @r disable optional_qualifier@
    identifier i;
    position p;
    @@
    static struct i2c_algorithm i@p = { ... };
    
    @ok@
    identifier r.i;
    struct i2c_adapter e;
    position p;
    @@
    e.algo = &i@p;
    
    @bad@
    position p != {r.p,ok.p};
    identifier r.i;
    @@
    i@p
    
    @depends on !bad disable optional_qualifier@
    identifier r.i;
    @@
    static
    +const
     struct i2c_algorithm i = { ... };
    
    Signed-off-by: Gustavo A. R. Silva <garsilva@embeddedor.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@s-opensource.com>

commit 28e83542cd8cac67ebea9b29a3b18941739aa178
Author: Gustavo A. R. Silva <garsilva@embeddedor.com>
Date:   Sun Jul 9 21:00:33 2017 -0400

    media: dib8000: constify i2c_algorithm structure
    
    Check for i2c_algorithm structures that are only stored in
    the algo field of an i2c_adapter structure. This field is
    declared const, so i2c_algorithm structures that have this
    property can be declared as const also.
    
    This issue was identified using Coccinelle and the following
    semantic patch:
    
    @r disable optional_qualifier@
    identifier i;
    position p;
    @@
    static struct i2c_algorithm i@p = { ... };
    
    @ok@
    identifier r.i;
    struct i2c_adapter e;
    position p;
    @@
    e.algo = &i@p;
    
    @bad@
    position p != {r.p,ok.p};
    identifier r.i;
    @@
    i@p
    
    @depends on !bad disable optional_qualifier@
    identifier r.i;
    @@
    static
    +const
     struct i2c_algorithm i = { ... };
    
    Signed-off-by: Gustavo A. R. Silva <garsilva@embeddedor.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@s-opensource.com>

commit 053aa4a8339c4f271f9f667e637b8c7f015cb95b
Author: Gustavo A. R. Silva <garsilva@embeddedor.com>
Date:   Sun Jul 9 20:57:06 2017 -0400

    media: s5h1420: constify i2c_algorithm structure
    
    Check for i2c_algorithm structures that are only stored in
    the algo field of an i2c_adapter structure. This field is
    declared const, so i2c_algorithm structures that have this
    property can be declared as const also.
    
    This issue was identified using Coccinelle and the following
    semantic patch:
    
    @r disable optional_qualifier@
    identifier i;
    position p;
    @@
    static struct i2c_algorithm i@p = { ... };
    
    @ok@
    identifier r.i;
    struct i2c_adapter e;
    position p;
    @@
    e.algo = &i@p;
    
    @bad@
    position p != {r.p,ok.p};
    identifier r.i;
    @@
    i@p
    
    @depends on !bad disable optional_qualifier@
    identifier r.i;
    @@
    static
    +const
     struct i2c_algorithm i = { ... };
    
    Signed-off-by: Gustavo A. R. Silva <garsilva@embeddedor.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@s-opensource.com>

commit a76f094a47aca13ea1666297f138c2e66c605d5b
Author: Gustavo A. R. Silva <garsilva@embeddedor.com>
Date:   Sun Jul 9 18:18:15 2017 -0400

    media: dib7000p: constify i2c_algorithm structure
    
    Check for i2c_algorithm structures that are only stored in
    the algo field of an i2c_adapter structure. This field is
    declared const, so i2c_algorithm structures that have this
    property can be declared as const also.
    
    This issue was identified using Coccinelle and the following
    semantic patch:
    
    @r disable optional_qualifier@
    identifier i;
    position p;
    @@
    static struct i2c_algorithm i@p = { ... };
    
    @ok@
    identifier r.i;
    struct i2c_adapter e;
    position p;
    @@
    e.algo = &i@p;
    
    @bad@
    position p != {r.p,ok.p};
    identifier r.i;
    @@
    i@p
    
    @depends on !bad disable optional_qualifier@
    identifier r.i;
    @@
    static
    +const
     struct i2c_algorithm i = { ... };
    
    Signed-off-by: Gustavo A. R. Silva <garsilva@embeddedor.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@s-opensource.com>

commit 8e10fd851cb3e9723786703e3db45a2320b33a0e
Author: Gustavo A. R. Silva <garsilva@embeddedor.com>
Date:   Sun Jul 9 18:14:38 2017 -0400

    media: marvell-ccic: constify i2c_algorithm structure
    
    Check for i2c_algorithm structures that are only stored in
    the algo field of an i2c_adapter structure. This field is
    declared const, so i2c_algorithm structures that have this
    property can be declared as const also.
    
    This issue was identified using Coccinelle and the following
    semantic patch:
    
    @r disable optional_qualifier@
    identifier i;
    position p;
    @@
    static struct i2c_algorithm i@p = { ... };
    
    @ok@
    identifier r.i;
    struct i2c_adapter e;
    position p;
    @@
    e.algo = &i@p;
    
    @bad@
    position p != {r.p,ok.p};
    identifier r.i;
    @@
    i@p
    
    @depends on !bad disable optional_qualifier@
    identifier r.i;
    @@
    static
    +const
     struct i2c_algorithm i = { ... };
    
    Signed-off-by: Gustavo A. R. Silva <garsilva@embeddedor.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@s-opensource.com>

commit ea925e4db10467fd9dceaac66817c8582c1f2c66
Author: Gustavo A. R. Silva <garsilva@embeddedor.com>
Date:   Sun Jul 9 18:09:16 2017 -0400

    media: saa7146: constify i2c_algorithm structure
    
    Check for i2c_algorithm structures that are only stored in
    the algo field of an i2c_adapter structure. This field is
    declared const, so i2c_algorithm structures that have this
    property can be declared as const also.
    
    This issue was identified using Coccinelle and the following
    semantic patch:
    
    @r disable optional_qualifier@
    identifier i;
    position p;
    @@
    static struct i2c_algorithm i@p = { ... };
    
    @ok@
    identifier r.i;
    struct i2c_adapter e;
    position p;
    @@
    e.algo = &i@p;
    
    @bad@
    position p != {r.p,ok.p};
    identifier r.i;
    @@
    i@p
    
    @depends on !bad disable optional_qualifier@
    identifier r.i;
    @@
    static
    +const
     struct i2c_algorithm i = { ... };
    
    Signed-off-by: Gustavo A. R. Silva <garsilva@embeddedor.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@s-opensource.com>

commit 19779f40520104423ec34581623f032affa08579
Author: Gustavo A. R. Silva <garsilva@embeddedor.com>
Date:   Sun Jul 9 18:24:19 2017 -0400

    media: dib9000: constify i2c_algorithm structure
    
    Check for i2c_algorithm structures that are only stored in
    the algo field of an i2c_adapter structure. This field is
    declared const, so i2c_algorithm structures that have this
    property can be declared as const also.
    
    This issue was identified using Coccinelle and the following
    semantic patch:
    
    @r disable optional_qualifier@
    identifier i;
    position p;
    @@
    static struct i2c_algorithm i@p = { ... };
    
    @ok@
    identifier r.i;
    struct i2c_adapter e;
    position p;
    @@
    e.algo = &i@p;
    
    @bad@
    position p != {r.p,ok.p};
    identifier r.i;
    @@
    i@p
    
    @depends on !bad disable optional_qualifier@
    identifier r.i;
    @@
    static
    +const
     struct i2c_algorithm i = { ... };
    
    Signed-off-by: Gustavo A. R. Silva <garsilva@embeddedor.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@s-opensource.com>

commit 830a45a2f44852fb7e1b49f95c7c5703816d9d94
Author: Gustavo A. R. Silva <garsilva@embeddedor.com>
Date:   Sun Jul 9 18:04:24 2017 -0400

    media: usbvision: constify i2c_algorithm structure
    
    Check for i2c_algorithm structures that are only stored in
    the algo field of an i2c_adapter structure. This field is
    declared const, so i2c_algorithm structures that have this
    property can be declared as const also.
    
    This issue was identified using Coccinelle and the following
    semantic patch:
    
    @r disable optional_qualifier@
    identifier i;
    position p;
    @@
    static struct i2c_algorithm i@p = { ... };
    
    @ok@
    identifier r.i;
    struct i2c_adapter e;
    position p;
    @@
    e.algo = &i@p;
    
    @bad@
    position p != {r.p,ok.p};
    identifier r.i;
    @@
    i@p
    
    @depends on !bad disable optional_qualifier@
    identifier r.i;
    @@
    static
    +const
     struct i2c_algorithm i = { ... };
    
    Signed-off-by: Gustavo A. R. Silva <garsilva@embeddedor.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@s-opensource.com>

commit 8d08a4c1aae8857c46079d329023753611218518
Author: Gustavo A. R. Silva <garsilva@embeddedor.com>
Date:   Sun Jul 9 17:41:08 2017 -0400

    media: dvb-ttusb-budget: constify i2c_algorithm structure
    
    Check for i2c_algorithm structures that are only stored in
    the algo field of an i2c_adapter structure. This field is
    declared const, so i2c_algorithm structures that have this
    property can be declared as const also.
    
    This issue was identified using Coccinelle and the following
    semantic patch:
    
    @r disable optional_qualifier@
    identifier i;
    position p;
    @@
    static struct i2c_algorithm i@p = { ... };
    
    @ok@
    identifier r.i;
    struct i2c_adapter e;
    position p;
    @@
    e.algo = &i@p;
    
    @bad@
    position p != {r.p,ok.p};
    identifier r.i;
    @@
    i@p
    
    @depends on !bad disable optional_qualifier@
    identifier r.i;
    @@
    static
    +const
     struct i2c_algorithm i = { ... };
    
    Signed-off-by: Gustavo A. R. Silva <garsilva@embeddedor.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@s-opensource.com>

commit 9eb788800510ae1a6bc419636a66071ee4deafd5
Merge: 642338ba33c5 4495ec6d770e
Author: Linus Torvalds <torvalds@linux-foundation.org>
Date:   Mon Jul 10 10:59:29 2017 -0700

    Merge tag 'for-linus-4.13-v2' of git://github.com/cminyard/linux-ipmi
    
    Pull IPMI updates from Corey Minyard:
     "Some small fixes for IPMI, and one medium sized changed.
    
      The medium sized change is adding a platform device for IPMI entries
      in the DMI table. Otherwise there is no auto loading for IPMI devices
      if they are only in the DMI table"
    
    * tag 'for-linus-4.13-v2' of git://github.com/cminyard/linux-ipmi:
      ipmi:ssif: Add missing unlock in error branch
      char: ipmi: constify bmc_dev_attr_group and bmc_device_type
      ipmi:ssif: Check dev before setting drvdata
      ipmi: Convert DMI handling over to a platform device
      ipmi: Create a platform device for a DMI-specified IPMI interface
      ipmi: use rcu lock around call to intf->handlers->sender()
      ipmi:ssif: Use i2c_adapter_id instead of adapter->nr
      ipmi: Use the proper default value for register size in ACPI
      ipmi_ssif: remove redundant null check on array client->adapter->name
      ipmi/watchdog: fix watchdog timeout set on reboot
      ipmi_ssif: unlock on allocation failure

commit be8647d2bea48a15a685c855dda33d22e9550493
Author: Corey Minyard <cminyard@mvista.com>
Date:   Fri Jun 16 16:38:20 2017 -0500

    ipmi:ssif: Use i2c_adapter_id instead of adapter->nr
    
    Signed-off-by: Corey Minyard <cminyard@mvista.com>

commit a716a026bb0d824c9ab6d6ac778c030c0030b178
Author: Dmitry Torokhov <dmitry.torokhov@gmail.com>
Date:   Sat Mar 25 10:45:13 2017 -0700

    Input: psmouse - use i2c_client_type to locate i2c clients
    
    Now that i2c_client_type structure is exported, we can use it, instead
    of i2c_adapter_type, when looking for devices that are i2c clients.
    
    Signed-off-by: Dmitry Torokhov <dmitry.torokhov@gmail.com>

commit 00a06c22e9fc0a33ae0b6ca2d47938340dbcd539
Author: Dmitry Torokhov <dmitry.torokhov@gmail.com>
Date:   Sat Mar 4 11:29:34 2017 -0800

    i2c: export i2c_client_type structure
    
    i2c bus has 2 different types of device belonging to the same bus and
    bus notifiers use device type to distinguish between adapters and clients.
    Previously we only had i2c_adapter_type exported, which made code wanting
    to work with i2c_client devices test for type not equal to adapter type.
    This unfortunately is not safe if we ever add another type to the bus,
    so let's export i2c_client_type as well.
    
    Reviewed-by: Jean Delvare <jdelvare@suse.de>
    Acked-by: Benjamin Tissoires <benjamin.tissoires@redhat.com>
    Reviewed-by: Wolfram Sang <wsa@the-dreams.de>
    Signed-off-by: Dmitry Torokhov <dmitry.torokhov@gmail.com>

commit a16cb91ad9c4bb959e7d1be69d83d8c24a88e9f2
Author: Bartosz Golaszewski <bgolaszewski@baylibre.com>
Date:   Thu Feb 16 16:08:01 2017 -0200

    [media] media: vpif: use a configurable i2c_adapter_id for vpif display
    
    The vpif display driver uses a static i2c adapter ID of 1 but on the
    da850-evm board in DT boot mode the i2c adapter ID is actually 0.
    
    Make the adapter ID configurable like it already is for vpif capture.
    
    Signed-off-by: Bartosz Golaszewski <bgolaszewski@baylibre.com>
    Acked-by: Kevin Hilman <khilman@baylibre.com>
    Acked-by: Lad, Prabhakar <prabhakar.csengg@gmail.com>
    Signed-off-by: Hans Verkuil <hans.verkuil@cisco.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@s-opensource.com>

commit 92d9d0dfb0fd2f1a6f0c411530df65fba274a79d
Author: Bhumika Goyal <bhumirks@gmail.com>
Date:   Fri Jan 27 23:36:17 2017 +0530

    i2c: busses: constify i2c_algorithm structures
    
    Declare i2c_algorithm structures as const as they are only stored in the
    algo field of an i2c_adapter structure. This field is of type const, so
    i2c_algorithm structures having this property can be made const too.
    
    Signed-off-by: Bhumika Goyal <bhumirks@gmail.com>
    Acked-by: Uwe Kleine-König <u.kleine-koenig@pengutronix.de> for
    Acked-by: Patrice Chotard <patrice.chotard@st.com>
    Acked-by: Jarkko Nikula <jarkko.nikula@linux.intel.com>
    Reviewed-by: Jean Delvare <jdelvare@suse.de>
    Acked-by: Ludovic Desroches <ludovic.desroches@microchip.com>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>

commit 0d1270df836fe9f5cc7e8001b7372ca4fa3f00f6
Author: Arnd Bergmann <arnd@arndb.de>
Date:   Tue Feb 7 11:01:41 2017 -0200

    [media] zd1301: fix building interface driver without demodulator
    
    If the USB driver is enabled but the demodulator is not, we get a link error:
    
    ERROR: "zd1301_demod_get_dvb_frontend" [drivers/media/usb/dvb-usb-v2/zd1301.ko] undefined!
    ERROR: "zd1301_demod_get_i2c_adapter" [drivers/media/usb/dvb-usb-v2/zd1301.ko] undefined!
    
    Such a configuration obviously makes no sense, but we should not fail
    the build.  This tries to mimic what we have for other drivers by turning
    the build failure into a runtime failure.
    
    Alternatively we could use an unconditional 'select' or 'depends on' to enforce
    a sane configuration.
    
    Fixes: 47d65372b3b6 ("[media] zd1301_demod: ZyDAS ZD1301 DVB-T demodulator driver")
    Fixes: 992b39872b80 ("[media] zd1301: ZyDAS ZD1301 DVB USB interface driver")
    
    Signed-off-by: Arnd Bergmann <arnd@arndb.de>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@s-opensource.com>

commit 379883cc67d890e0412d6e6c952d7eb0614b915a
Author: Julia Lawall <julia.lawall@lip6.fr>
Date:   Sat Oct 15 19:32:01 2016 +0200

    i2c: constify i2c_adapter_quirks structures
    
    Check for i2c_adapter_quirks structures that are only stored in the
    quirks field of an i2c_adapter structure.  This field is declared
    const, so i2c_adapter_quirks structures that have this property can be
    declared as const also.
    
    Signed-off-by: Julia Lawall <Julia.Lawall@lip6.fr>
    Acked-by: Ray Jui <ray.jui@broadcom.com> # for bcm-iproc
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>

commit 90233ee5d189af0b26430d31a041a2dcaa5c868e
Merge: 628d16555e01 3efc2fa3b777
Author: Dave Airlie <airlied@redhat.com>
Date:   Fri Nov 11 09:57:54 2016 +1000

    Merge tag 'dw-hdmi-next-2016-09-19' of git://git.pengutronix.de/git/pza/linux into drm-next
    
    dw-hdmi i2c master controller
    
    - add support for the HDMI I2C master controller, for boards that
      can have their DDC pins connected only to the HDMI TX directly.
    
    * tag 'dw-hdmi-next-2016-09-19' of git://git.pengutronix.de/git/pza/linux:
      drm: bridge/dw_hdmi: add dw hdmi i2c bus adapter support
      drm: dw_hdmi: use of_get_i2c_adapter_by_node interface

commit e13e19e12f66401ce1e21ab491715835852babe7
Author: Noralf Trønnes <noralf@tronnes.org>
Date:   Mon Oct 3 22:06:13 2016 +0200

    i2c: bcm2835: Support i2c-dev ioctl I2C_TIMEOUT
    
    Use i2c_adapter->timeout for the completion timeout value. The core
    default is 1 second.
    
    Signed-off-by: Noralf Trønnes <noralf@tronnes.org>
    Reviewed-by: Eric Anholt <eric@anholt.net>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>

commit de34f4da7f62ff59ac6e1ef320b0fcfa3296fce3
Merge: 56e520c7a0a4 9fce0c226536
Author: Linus Torvalds <torvalds@linux-foundation.org>
Date:   Tue Oct 11 13:22:22 2016 -0700

    Merge tag 'media/v4.9-1' of git://git.kernel.org/pub/scm/linux/kernel/git/mchehab/linux-media
    
    Pull media updates from Mauro Carvalho Chehab:
    
     - Documentation improvements: conversion of all non-DocBook documents
       to Sphinx and lots of fixes to the uAPI media book
    
     - New PCI driver for Techwell TW5864 media grabber boards
    
     - New SoC driver for ATMEL Image Sensor Controller
    
     - Removal of some obsolete SoC drivers (s5p-tv driver and soc_camera
       drivers)
    
     - Addition of ST CEC driver
    
     - Lots of drivers fixes, improvements and additions
    
    * tag 'media/v4.9-1' of git://git.kernel.org/pub/scm/linux/kernel/git/mchehab/linux-media: (464 commits)
      [media] ttusb_dec: avoid the risk of go past buffer
      [media] cx23885: Fix some smatch warnings
      [media] si2165: switch to regmap
      [media] si2165: use i2c_client->dev instead of i2c_adapter->dev for logging
      [media] si2165: Remove legacy attach
      [media] cx231xx: attach si2165 driver via i2c_client
      [media] cx231xx: Prepare for attaching new style i2c_client DVB demod drivers
      [media] cx23885: attach si2165 driver via i2c_client
      [media] si2165: support i2c_client attach
      [media] si2165: avoid division by zero
      [media] rcar-vin: add R-Car gen2 fallback compatibility string
      [media] lgdt3306a: remove 20*50 msec unnecessary timeout
      [media] cx25821: Remove deprecated create_singlethread_workqueue
      [media] cx25821: Drop Freeing of Workqueue
      [media] cxd2841er: force 8MHz bandwidth for DVB-C if specified bw not supported
      [media] redrat3: hardware-specific parameters
      [media] redrat3: remove hw_timeout member
      [media] cxd2841er: BER and SNR reading for ISDB-T
      [media] dvb-usb: avoid link error with dib3000m{b,c|
      [media] dvb-usb: split out common parts of dibusb
      ...

commit 87840a2b7e048018d18d60bdac5c09224de85370
Merge: 2ab704a47e0f 662786a5429c
Author: Linus Torvalds <torvalds@linux-foundation.org>
Date:   Fri Oct 7 14:12:21 2016 -0700

    Merge branch 'i2c/for-4.9' of git://git.kernel.org/pub/scm/linux/kernel/git/wsa/linux
    
    Pull i2c updates from Wolfram Sang:
     "Here is the 4.9 pull request from I2C including:
    
       - centralized error messages when registering to the core
       - improved lockdep annotations to prevent false positives
       - DT support for muxes, gates, and arbitrators
       - bus speeds can now be obtained from ACPI
       - i2c-octeon got refactored and now supports ThunderX SoCs, too
       - i2c-tegra and i2c-designware got a bigger bunch of updates
       - a couple of standard driver fixes and improvements"
    
    * 'i2c/for-4.9' of git://git.kernel.org/pub/scm/linux/kernel/git/wsa/linux: (71 commits)
      i2c: axxia: disable clks in case of failure in probe
      i2c: octeon: thunderx: Limit register access retries
      i2c: uniphier-f: fix misdetection of incomplete STOP condition
      gpio: pca953x: variable 'id' was used twice
      i2c: i801: Add support for Kaby Lake PCH-H
      gpio: pca953x: fix an incorrect lockdep warning
      i2c: add a warning to i2c_adapter_depth()
      lockdep: make MAX_LOCKDEP_SUBCLASSES unconditionally visible
      i2c: export i2c_adapter_depth()
      i2c: rk3x: Fix variable 'min_total_ns' unused warning
      i2c: rk3x: Fix sparse warning
      i2c / ACPI: Do not touch an I2C device if it belongs to another adapter
      i2c: octeon: Fix high-level controller status check
      i2c: octeon: Avoid sending STOP during recovery
      i2c: octeon: Fix set SCL recovery function
      i2c: rcar: add support for r8a7796 (R-Car M3-W)
      i2c: imx: make bus recovery through pinctrl optional
      i2c: meson: add gxbb compatible string
      i2c: uniphier-f: set the adapter to master mode when probing
      i2c: uniphier-f: avoid WARN_ON() of clk_disable() in failure path
      ...

commit 2771dc34ddaa313127d6431f23ae4cea26b869b0
Author: Bartosz Golaszewski <bgolaszewski@baylibre.com>
Date:   Fri Sep 16 18:02:44 2016 +0200

    i2c: add a warning to i2c_adapter_depth()
    
    This routine is only used together with lockdep for nested locking.
    The number of lock subclasses is limited to 8 as defined in lockdep.h
    
    Emit a warning if the adapter depth exceeds the maximum number of
    lockdep subclasses.
    
    Signed-off-by: Bartosz Golaszewski <bgolaszewski@baylibre.com>
    Acked-by: Peter Rosin <peda@axentia.se>
    Acked-by: Peter Zijlstra (Intel) <peterz@infradead.org>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>

commit a5ecddfe0bf82c92cc2e47385e287b21361a8d70
Author: Bartosz Golaszewski <bgolaszewski@baylibre.com>
Date:   Fri Sep 16 18:02:43 2016 +0200

    lockdep: make MAX_LOCKDEP_SUBCLASSES unconditionally visible
    
    This define is needed by i2c_adapter_depth() to detect if we don't
    exceed the maximum number of lock subclasses. Make it visible even
    if lockdep is disabled.
    
    Signed-off-by: Bartosz Golaszewski <bgolaszewski@baylibre.com>
    Acked-by: Peter Rosin <peda@axentia.se>
    Acked-by: Peter Zijlstra (Intel) <peterz@infradead.org>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>

commit 8dd1fe1594a712eb326e1607c694fbd1baf85f4b
Author: Bartosz Golaszewski <bgolaszewski@baylibre.com>
Date:   Fri Sep 16 18:02:42 2016 +0200

    i2c: export i2c_adapter_depth()
    
    For crazy setups in which an i2c gpio expander is behind an i2c gpio
    multiplexer controlled by a gpio provided a second expander using the
    same device driver we need to explicitly tell lockdep how to handle
    nested locking.
    
    Export i2c_adapter_depth() as public API to be reused outside of i2c
    core code.
    
    Signed-off-by: Bartosz Golaszewski <bgolaszewski@baylibre.com>
    Acked-by: Peter Rosin <peda@axentia.se>
    Acked-by: Peter Zijlstra (Intel) <peterz@infradead.org>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>

commit aa15544909918f55299b49bd51042e242e64c425
Author: Matthias Schwarzott <zzam@gentoo.org>
Date:   Tue Jul 26 04:09:07 2016 -0300

    [media] si2165: use i2c_client->dev instead of i2c_adapter->dev for logging
    
    Now that there is a i2c_client, use the more specific dev for logging.
    
    Signed-off-by: Matthias Schwarzott <zzam@gentoo.org>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@s-opensource.com>

commit 056c61eb0da4d7181fc7072567dc1931cb0e1cbb
Author: Sylwester Nawrocki <s.nawrocki@samsung.com>
Date:   Tue Sep 13 11:39:33 2016 -0300

    [media] exynos4-is: Clear isp-i2c adapter power.ignore_children flag
    
    Since commit 04f59143b571161d25315dd52d7a2ecc022cb71a
    ("i2c: let I2C masters ignore their children for PM")
    the power.ignore_children flag is set when registering an I2C
    adapter.  Since I2C transfers are not managed by the fimc-isp-i2c
    driver its clients use pm_runtime_* calls directly to communicate
    required power state of the bus controller.
    
    However, when the power.ignore_children flag is set that doesn't
    work, so clear that flag back after registering the adapter.
    While at it drop pm_runtime_enable() call on the i2c_adapter
    as it is already done by the I2C subsystem when registering
    I2C adapter.
    
    This patch is meant as a minimal change to fix the regression,
    eventually the I2C_ISPx clock handling will be moved to the
    top level fimc-is driver and whole runtime PM code is going to
    be dropped from the fimc-is-i2c module.
    
    Cc: <stable@vger.kernel.org> # 4.7+
    Reported-by: Marek Szyprowski <m.szyprowski@samsung.com>
    Signed-off-by: Sylwester Nawrocki <s.nawrocki@samsung.com>
    Reviewed-by: Bartlomiej Zolnierkiewicz <b.zolnierkie@samsung.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@s-opensource.com>

commit 78f2c50bb4e1884318542cc5f674afb106555273
Author: Julia Lawall <Julia.Lawall@lip6.fr>
Date:   Mon Aug 29 10:12:01 2016 -0300

    [media] constify i2c_algorithm structures
    
    These i2c_algorithm structures are only stored in the alg field of an
    i2c_adapter structure, which is declared as const.  This declare the
    structures as const as well.
    
    The semantic patch that makes this change is as follows:
    (http://coccinelle.lip6.fr/)
    
    // <smpl>
    @r disable optional_qualifier@
    identifier i;
    position p;
    @@
    static struct i2c_algorithm i@p = { ... };
    
    @ok@
    identifier r.i;
    struct i2c_adapter e;
    position p;
    @@
    e.alg = &i@p;
    
    @bad@
    position p != {r.p,ok.p};
    identifier r.i;
    @@
    i@p
    
    @depends on !bad disable optional_qualifier@
    identifier r.i;
    @@
    static
    +const
     struct i2c_algorithm i = { ... };
    // </smpl>
    
    Signed-off-by: Julia Lawall <Julia.Lawall@lip6.fr>
    Signed-off-by: Hans Verkuil <hans.verkuil@cisco.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@s-opensource.com>

commit 9f04a1f2b389a656486c1f9f918a3305569fba6a
Author: Vladimir Zapolskiy <vladimir_zapolskiy@mentor.com>
Date:   Tue Aug 16 23:26:43 2016 +0300

    drm: dw_hdmi: use of_get_i2c_adapter_by_node interface
    
    This change is needed to properly lock I2C bus driver, which serves
    DDC.
    
    The change fixes an overflow over zero of I2C bus driver user counter:
    
      root@imx6q:~# lsmod
      Not tainted
      dw_hdmi_ahb_audio 4082 0 - Live 0xbf02c000
      dw_hdmi_imx 3498 0 - Live 0xbf00d000
      dw_hdmi 16398 2 dw_hdmi_ahb_audio,dw_hdmi_imx, Live 0xbf004000
      i2c_imx 16687 0 - Live 0xbf017000
    
      root@imx6q:~# rmmod dw_hdmi_imx
      root@imx6q:~# lsmod
      Not tainted
      dw_hdmi_ahb_audio 4082 0 - Live 0xbf02c000
      dw_hdmi 16398 1 dw_hdmi_ahb_audio, Live 0xbf004000
      i2c_imx 16687 -1 - Live 0xbf017000
                    ^^
    
      root@imx6q:~# rmmod i2c_imx
      rmmod: ERROR: Module i2c_imx is in use
    
    Note that prior to this change put_device() coupled with
    of_find_i2c_adapter_by_node() was missing on error path of
    dw_hdmi_bind(), added i2c_put_adapter() there along with the change.
    
    Signed-off-by: Vladimir Zapolskiy <vladimir_zapolskiy@mentor.com>
    Acked-by: Russell King <rmk+kernel@arm.linux.org.uk>
    Cc: Fabio Estevam <fabio.estevam@nxp.com>
    Signed-off-by: Philipp Zabel <p.zabel@pengutronix.de>

commit 55d38d060e999ca1a3ea6eb132105a0301e4cd04
Author: Jarkko Nikula <jarkko.nikula@linux.intel.com>
Date:   Mon Jun 6 14:26:22 2016 +0300

    i2c: core: Add function for finding the bus speed from ACPI
    
    ACPI 5 specification doesn't have property for the I2C bus speed but
    I2cSerialBus resource descriptors which define each controller-slave
    connection define the maximum speed supported by that connection.
    
    Thus finding the maximum safe speed for the bus is to walk all
    I2cSerialBus resources that are associated to I2C controller and use
    the speed of slowest connection.
    
    Add function i2c_acpi_find_bus_speed() to the i2c-core that adapter
    drivers can call prior registering itself to core.
    
    This implies two-step walk through the I2cSerialBus resources: call to
    i2c_acpi_find_bus_speed() does the first scan and finds the safe bus
    speed that adapter drivers can set up. Adapter driver registration does
    the second scan when i2c-core creates the I2C slaves by calling the
    i2c_acpi_register_devices(). In that way the bus speed is set in case
    slave device probe gets called during registration and does
    communication.
    
    Implement this by reusing the existing ACPI I2C walk routines in the
    i2c-core. Extend them so that slowest connection speed is saved during
    the walk and I2C slaves are registered only when calling through the
    i2c_acpi_register_devices() with the i2c_adapter pointer.
    
    Signed-off-by: Jarkko Nikula <jarkko.nikula@linux.intel.com>
    Reviewed-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
    Acked-by: Mika Westerberg <mika.westerberg@linux.intel.com>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>

commit 04f59143b571161d25315dd52d7a2ecc022cb71a
Author: Linus Walleij <linus.walleij@linaro.org>
Date:   Tue Apr 12 09:57:35 2016 +0200

    i2c: let I2C masters ignore their children for PM
    
    When using a certain I2C device with runtime PM enabled on
    a certain I2C bus adaper the following happens:
    
    struct amba_device *foo
       \
       struct i2c_adapter *bar
          \
          struct i2c_client *baz
    
    The AMBA device foo has its device PM struct set to ignore
    children with pm_suspend_ignore_children(&foo->dev, true).
    This makes runtime PM work just fine locally in the driver:
    the fact that devices on the bus are suspended or resumed
    individually does not affect its operation, and the hardware
    does not power up unless transferring messages.
    
    However this child ignorance property is not inherited into
    the struct i2c_adapter *bar.
    
    On system suspend things will work fine.
    
    On system resume the following annoying phenomenon occurs:
    
    - In the pm_runtime_force_resume() path of
      struct i2c_client *baz, pm_runtime_set_active(&baz->dev); is
      eventually called.
    
    - This becomes __pm_runtime_set_status(&baz->dev, RPM_ACTIVE);
    
    - __pm_runtime_set_status() detects that RPM state is changed,
      and checks whether the parent is:
      not active (RPM_ACTIVE) and not ignoring its children
      If this happens it concludes something is wrong, because
      a parent that is not ignoring its children must be active
      before any children activate.
    
    - Since the struct i2c_adapter *bar does not ignore
      its children, the PM core thinks that it must indeed go
      online before its children, the check bails out with
      -EBUSY, i.e. the i2c_client *baz thinks it can't work
      because it's parent is not online, and it respects its
      parent.
    
    - In the driver the .resume() callback returns -EBUSY from
      the runtime_force_resume() call as per above. This leaves
      the device in a suspended state, leading to bad behaviour
      later when the device is used. The following debug
      print is made with an extra printg patch but illustrates
      the problem:
    
    [   17.040832] bh1780 2-0029: parent (i2c-2) is not active
                   parent->power.ignore_children = 0
    [   17.040832] bh1780 2-0029: pm_runtime_force_resume:
                   pm_runtime_set_active() failed (-16)
    [   17.040863] dpm_run_callback():
                   pm_runtime_force_resume+0x0/0x88 returns -16
    [   17.040863] PM: Device 2-0029 failed to resume: error -16
    
    Fix this by letting all struct i2c_adapter:s ignore their
    children: i2c children have no business doing keeping
    their parents awake: they are completely autonomous
    devices that just use their parent to talk, a usecase
    which must be power managed in the host on a per-message
    basis.
    
    Signed-off-by: Linus Walleij <linus.walleij@linaro.org>
    Reviewed-by: Ulf Hansson <ulf.hansson@linaro.org>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>

commit 4916eb6909769eb6a178330a9694d85bf564d5ee
Author: Ray Jui <rjui@broadcom.com>
Date:   Fri Feb 12 13:10:43 2016 -0800

    i2c: iproc: Support larger TX transfer
    
    The current iProc I2C driver only allows each TX transfer up to 63
    bytes (the TX FIFO has a size of 64 bytes, and one byte is reserved
    for slave address). This patch enhances the driver to support TX
    transfer in each I2C message for up to 65535 bytes (a practical
    maximum, since member 'max_write_len' of 'struct i2c_adapter_quirks is
    of type 'u16')
    
    This works by loading up the I2C TX FIFO and enabling the TX underrun
    interrupt for each burst. After each burst of TX data is finished,
    i.e., when the TX FIFO becomes empty, the TX underrun interrupt will be
    triggered and another burst of TX data can be loaded into the TX FIFO.
    This repeats until all TX data are finished
    
    Signed-off-by: Ray Jui <rjui@broadcom.com>
    Tested-by: Icarus Chau <ichau@broadcom.com>
    Reviewed-by: Scott Branden <sbranden@broadcom.com>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>

commit 8d22f309384cc410da91543f1eb30fe5daf91c3b
Author: Baruch Siach <baruch@tkos.co.il>
Date:   Wed Dec 23 18:43:24 2015 +0200

    i2c: designware: retry transfer on transient failure
    
    Set the i2c_adapter retries field to a sensible value. This allows the i2c core
    to retry master_xfer() when it returns -EAGAIN. Currently the i2c-designware
    driver returns -EAGAIN only on Tx arbitration failure (DW_IC_TX_ARB_LOST).
    
    Reported-by: Rolland Chau <zourongrong@gmail.com>
    Signed-off-by: Baruch Siach <baruch@tkos.co.il>
    Acked-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>

commit a613d9d48573d3d2f9bba7ed7719c5cc26d3a755
Author: Paul Burton <paul.burton@imgtec.com>
Date:   Mon Nov 30 16:21:40 2015 +0000

    i2c: eg20t: set i2c_adapter->dev.of_node
    
    Set the I2C adapter devices of_node to that of the PCI device, such that
    I2C clients may be instantiated via device tree.
    
    Signed-off-by: Paul Burton <paul.burton@imgtec.com>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>

commit ca2061e1283b787b49e3f6817645b9f0a2151671
Author: Christian Fetzer <fetzer.ch@gmail.com>
Date:   Thu Nov 19 20:13:47 2015 +0100

    i2c: piix4: Convert piix4_main_adapter to array
    
    The SB800 chipset supports a multiplexed main SMBus controller with
    four ports. Therefore the static variable piix4_main_adapter is
    converted into a piix4_main_adapters array that can hold one
    i2c_adapter for each multiplexed port.
    
    The auxiliary adapter remains unchanged since it represents the second
    (not multiplexed) SMBus controller on the SB800 chipset.
    
    Signed-off-by: Christian Fetzer <fetzer.ch@gmail.com>
    Reviewed-by: Mika Westerberg <mika.westerberg@linux.intel.com>
    Reviewed-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>

commit be4773e6a11a0cc1e63c9c32f000b870e51b8c01
Merge: f6d07dfcb15a f20780f3e8fe
Author: Linus Torvalds <torvalds@linux-foundation.org>
Date:   Fri Nov 13 09:12:38 2015 -0800

    Merge branch 'drm-next' of git://people.freedesktop.org/~airlied/linux
    
    Pull drm sti driver updates from Dave Airlie:
     "The sti driver had a requirement on some patches in Greg's tree, they
      are in, so I see no problems just merging this one now"
    
    * 'drm-next' of git://people.freedesktop.org/~airlied/linux:
      drm/sti: load HQVDP firmware the first time HQVDP's plane is used
      drm/sti: fix typo issue in sti_mode_config_init
      drm/sti: set mixer background color through module param
      drm/sti: Remove local fbdev emulation Kconfig option
      drm/sti: remove redundant sign extensions
      drm/sti: hdmi use of_get_i2c_adapter_by_node interface
      drm/sti: hdmi fix i2c adapter device refcounting
      drm/sti: Do not export symbols
      drm/sti: Build monolithic driver
      drm/sti: Use drm_crtc_vblank_*() API
      drm/sti: Store correct CRTC index in events
      drm/sti: Select FW_LOADER
      drm/sti: Constify function pointer structs

commit f20780f3e8feec0eebcf9fb41e1d90202fffaeff
Merge: a18e2fa5e670 e00fe64a5ccd
Author: Dave Airlie <airlied@redhat.com>
Date:   Fri Nov 13 10:08:19 2015 +1000

    Merge branch 'drm-sti-next-2015-11-03' of http://git.linaro.org/people/benjamin.gaignard/kernel into drm-next
    
    sti/drm changes
    
    Add better support for firmware loading
    lots of fixes.
    
    * 'drm-sti-next-2015-11-03' of http://git.linaro.org/people/benjamin.gaignard/kernel:
      drm/sti: load HQVDP firmware the first time HQVDP's plane is used
      drm/sti: fix typo issue in sti_mode_config_init
      drm/sti: set mixer background color through module param
      drm/sti: Remove local fbdev emulation Kconfig option
      drm/sti: remove redundant sign extensions
      drm/sti: hdmi use of_get_i2c_adapter_by_node interface
      drm/sti: hdmi fix i2c adapter device refcounting
      drm/sti: Do not export symbols
      drm/sti: Build monolithic driver
      drm/sti: Use drm_crtc_vblank_*() API
      drm/sti: Store correct CRTC index in events
      drm/sti: Select FW_LOADER
      drm/sti: Constify function pointer structs

commit 4d5821a71ce9bed490e5a71987dc03f22e646039
Author: Vladimir Zapolskiy <vladimir_zapolskiy@mentor.com>
Date:   Mon Sep 21 18:51:27 2015 +0300

    drm/sti: hdmi use of_get_i2c_adapter_by_node interface
    
    This change is needed to properly lock I2C bus device and driver,
    which serve DDC lines. Without this change I2C bus driver module
    may gone in runtime and this won't be noticed by the driver.
    
    Signed-off-by: Vladimir Zapolskiy <vladimir_zapolskiy@mentor.com>
    Reviewed-by: Vincent Abriou <vincent.abriou@st.com>

commit e82fa92e6208fa3d82c28bf006aea98c2cd6df1b
Merge: 8ace60f8b760 d663baba8b16
Author: Linus Torvalds <torvalds@linux-foundation.org>
Date:   Wed Oct 7 18:05:09 2015 +0100

    Merge tag 'fbdev-fixes-4.3' of git://git.kernel.org/pub/scm/linux/kernel/git/tomba/linux
    
    Pull fbdev fixes from Tomi Valkeinen:
    
     - fbdev: Minor fixes to broadsheetfb, fsl-diu-fb, mb862xxfb, tridentfb,
       omapfb
    
     - display-timing: Fix memory leak in error path
    
    * tag 'fbdev-fixes-4.3' of git://git.kernel.org/pub/scm/linux/kernel/git/tomba/linux:
      video: of: fix memory leak
      fbdev: broadsheetfb: fix memory leak
      OMAPDSS: panel-sony-acx565akm: Export OF module alias information
      fbdev: omap2: connector-dvi: use of_get_i2c_adapter_by_node interface
      tridentfb: Fix set_lwidth on TGUI9440 and CYBER9320
      tridentfb: fix hang on Blade3D with CONFIG_CC_OPTIMIZE_FOR_SIZE
      video: fbdev: mb862xx: Fix module autoload for OF platform driver
      video: fbdev: fsl: Fix the sleep function for FSL DIU module

commit ad38cc5f6d4f2c74ed69e2c017691e428549b2bd
Author: Vladimir Zapolskiy <vladimir_zapolskiy@mentor.com>
Date:   Tue Sep 15 16:12:33 2015 +0300

    fbdev: omap2: connector-dvi: use of_get_i2c_adapter_by_node interface
    
    This change is needed to properly lock I2C bus driver, which serves DDC.
    
    Prior to this change i2c_put_adapter() is misused, which may lead to
    an overflow over zero of I2C bus driver user counter.
    
    Signed-off-by: Vladimir Zapolskiy <vladimir_zapolskiy@mentor.com>
    Signed-off-by: Tomi Valkeinen <tomi.valkeinen@ti.com>

commit 0d1ad98dd837c069572d16faf77fa7f50748c7d5
Author: Vladimir Zapolskiy <vladimir_zapolskiy@mentor.com>
Date:   Mon Jul 27 17:30:51 2015 +0300

    i2c: arb-gpio-challenge: use of_get_i2c_adapter_by_node interface
    
    This change is needed to properly lock I2C parent bus driver.
    
    Prior to this change i2c_put_adapter() is misused, which may lead
    to an overflow over zero of I2C bus driver user counter.
    
    Signed-off-by: Vladimir Zapolskiy <vladimir_zapolskiy@mentor.com>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>

commit 48e9743dd6483c5fd3f10c8e42c60d52d64b0e27
Author: Vladimir Zapolskiy <vladimir_zapolskiy@mentor.com>
Date:   Mon Jul 27 17:30:50 2015 +0300

    i2c: core: add and export of_get_i2c_adapter_by_node() interface
    
    of_find_i2c_adapter_by_node() call requires quite often missing
    put_device(), and i2c_put_adapter() releases a device locked by
    i2c_get_adapter() only. In general module_put(adapter->owner) and
    put_device(dev) are not interchangeable.
    
    This is a common error reproduction scenario as a result of the
    misusage described above (for clearness this is run on iMX6 platform
    with HDMI and I2C bus drivers compiled as kernel modules):
    
        root@mx6q:~# lsmod | grep i2c
        i2c_imx                10213  0
        root@mx6q:~# lsmod | grep dw_hdmi_imx
        dw_hdmi_imx             3631  0
        dw_hdmi                11846  1 dw_hdmi_imx
        imxdrm                  8674  3 dw_hdmi_imx,imx_ipuv3_crtc,imx_ldb
        drm_kms_helper        113765  5 dw_hdmi,imxdrm,imx_ipuv3_crtc,imx_ldb
        root@mx6q:~# rmmod dw_hdmi_imx
        root@mx6q:~# lsmod | grep i2c
        i2c_imx                10213  -1
    
                                     ^^^^^
    
        root@mx6q:~# rmmod i2c_imx
        rmmod: ERROR: Module i2c_imx is in use
    
    To fix existing users of these interfaces and to avoid any further
    confusion and misusage in future, add one more interface
    of_get_i2c_adapter_by_node(), it is similar to i2c_get_adapter() in
    sense that an I2C bus device driver found and locked by user can be
    correctly unlocked by i2c_put_adapter().
    
    Signed-off-by: Vladimir Zapolskiy <vladimir_zapolskiy@mentor.com>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>

commit e3311469734093724b10c2a81c1193197db03b78
Author: Vladimir Zapolskiy <vladimir_zapolskiy@mentor.com>
Date:   Mon Jul 27 17:30:48 2015 +0300

    i2c: fix leaked device refcount on of_find_i2c_* error path
    
    If of_find_i2c_device_by_node() or of_find_i2c_adapter_by_node() find
    a device by node, but its type does not match, a reference to that
    device is still held. This change fixes the problem.
    
    Signed-off-by: Vladimir Zapolskiy <vladimir_zapolskiy@mentor.com>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>

commit 8b012fc9bd89a743bbefe2055ca6f091e190935e
Author: Hans Verkuil <hans.verkuil@cisco.com>
Date:   Mon Apr 27 04:29:53 2015 -0300

    [media] cx24123/mb86a20s/s921: fix compiler warnings
    
    In file included from drivers/media/common/b2c2/flexcop-fe-tuner.c:13:0:
    drivers/media/dvb-frontends/cx24123.h:54:2: warning: 'cx24123_get_tuner_i2c_adapter' defined but not used [-Wunused-function]
      cx24123_get_tuner_i2c_adapter(struct dvb_frontend *fe)
      ^
    In file included from drivers/media/usb/em28xx/em28xx-dvb.c:46:0:
    drivers/media/dvb-frontends/s921.h:40:2: warning: 's921_get_tuner_i2c_adapter' defined but not used [-Wunused-function]
      s921_get_tuner_i2c_adapter(struct dvb_frontend *fe)
      ^
    In file included from drivers/media/usb/em28xx/em28xx-dvb.c:55:0:
    drivers/media/dvb-frontends/mb86a20s.h:49:2: warning: 'mb86a20s_get_tuner_i2c_adapter' defined but not used [-Wunused-function]
      mb86a20s_get_tuner_i2c_adapter(struct dvb_frontend *fe)
      ^
    In file included from drivers/media/usb/cx231xx/cx231xx-dvb.c:35:0:
    drivers/media/dvb-frontends/mb86a20s.h:49:2: warning: 'mb86a20s_get_tuner_i2c_adapter' defined but not used [-Wunused-function]
      mb86a20s_get_tuner_i2c_adapter(struct dvb_frontend *fe)
      ^
    
    Signed-off-by: Hans Verkuil <hans.verkuil@cisco.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@osg.samsung.com>

commit c3a416a669eb83cfa9ccb52db030e72d654bd105
Merge: 8c194f3bd322 2bbd681ba2bf
Author: Linus Torvalds <torvalds@linux-foundation.org>
Date:   Tue Apr 14 18:10:45 2015 -0700

    Merge branch 'i2c/for-next' of git://git.kernel.org/pub/scm/linux/kernel/git/wsa/linux
    
    Pull i2c updates from Wolfram Sang:
     "Most notable:
    
       - introducing the i2c_quirk infrastructure.  Now, flaws of I2C
         controllers can be described and the core will check if the flaws
         collide with the messages to be sent
    
       - wait_for_completion return type cleanup series
    
       - new drivers for Digicolor, Netlogic XLP, Ingenic JZ4780
    
       - updates to the I2C slave framework which include API changes.  Its
         only user was updated, too.  Documentation was finally added
    
       - changed dynamic bus numbering for the DT case.  This could change
         bus numbers for users.  However, it fixes a collision where dynamic
         and static busses request the same id.
    
       - driver bugfixes, cleanups"
    
    * 'i2c/for-next' of git://git.kernel.org/pub/scm/linux/kernel/git/wsa/linux: (52 commits)
      i2c: xlp9xx: Driver for Netlogic XLP9XX/5XX I2C controller
      of: Add vendor prefix 'netlogic'
      i2c: davinci: use ICPFUNC to toggle I2C as gpio for bus recovery
      i2c: davinci: use bus recovery infrastructure
      i2c: change input parameter to i2c_adapter for prepare/unprepare_recovery
      i2c: i2c-mux-gpio: remove error messages for probe deferrals
      i2c: jz4780: Add i2c bus controller driver for Ingenic JZ4780
      i2c: dln2: set the device tree node of the adapter
      i2c: davinci: fixup wait_for_completion_timeout handling
      i2c: mpc: Fix ISR return value
      i2c: slave-eeprom: add more info when to increase the pointer
      i2c: slave: add documentation for i2c-slave-eeprom
      Documentation: i2c: describe the new slave mode
      i2c: slave: rework the slave API
      i2c: add support for the Digicolor I2C controller
      i2c: busses with dynamic ids should start after fixed ids for DT
      of: base: add function to get highest id of an alias stem
      i2c: designware: Suppress error message if platform_get_irq() < 0
      i2c: mpc: assign the correct prescaler from SVR
      i2c: img-scb: fixup of wait_for_completion_timeout return handling
      ...

commit 2b2190a375d796a5ad9ec557cb51269f36b264d4
Author: Grygorii Strashko <grygorii.strashko@ti.com>
Date:   Mon Apr 6 15:38:39 2015 +0300

    i2c: change input parameter to i2c_adapter for prepare/unprepare_recovery
    
    This patch changes type of input parameter for
    prepare/unprepare_recovery() callbacks from struct i2c_bus_recovery_info
    * to struct i2c_adapter *. This allows to simplify implementation of
    these callbacks and avoid type conversations from i2c_bus_recovery_info
    to i2c_adapter. The i2c_bus_recovery_info can be simply retrieved from
    struct i2c_adapter which contains pointer on it. There are no users
    currently, so this is safe to do.
    
    Acked-by: Uwe Kleine-König <u.kleine-koenig@pengutronix.de>
    Acked-by: Alexander Sverdlin <alexander.sverdlin@nokia.com>
    Signed-off-by: Grygorii Strashko <grygorii.strashko@ti.com>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>

commit c3c3f1ae8bab74c99fa211c76b035a41523e83dd
Author: Matthias Schwarzott <zzam@gentoo.org>
Date:   Thu Oct 2 02:20:59 2014 -0300

    [media] cx231xx: add wrapper to get the i2c_adapter pointer
    
    This is a preparation for mapping I2C_1_MUX_1 and I2C_1_MUX_3 later to the seperate
    muxed i2c adapters.
    
    Map mux adapters to I2C_1 for now.
    
    Add local variables for i2c_adapters in dvb_init to get line lengths
    shorter.
    
    Signed-off-by: Matthias Schwarzott <zzam@gentoo.org>
    Reviewed-by: Antti Palosaari <crope@iki.fi>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@osg.samsung.com>

commit 70dc53633760de48b2d244da8a7b477c628eee05
Author: Mauro Carvalho Chehab <mchehab@osg.samsung.com>
Date:   Tue Sep 23 17:01:02 2014 -0300

    [media] tc90522: declare tc90522_functionality as static
    
    drivers/media/dvb-frontends/tc90522.c:706:5: warning: symbol 'tc90522_functionality' was not declared. Should it be static?
    drivers/media/dvb-frontends/tc90522.c:706:5: warning: no previous prototype for 'tc90522_functionality' [-Wmissing-prototypes]
     u32 tc90522_functionality(struct i2c_adapter *adap)
         ^
    
    Cc: Akihiro Tsukada <tskd08@gmail.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@osg.samsung.com>

commit fdc6b388925e3d0a4b4773ab7d641947fe59ed46
Author: Hans Verkuil <hverkuil@xs4all.nl>
Date:   Sat Sep 20 09:36:26 2014 -0300

    [media] cx24123: fix kernel oops due to missing parent pointer
    
    When I try to set the TV standard to e.g. PAL on my Hauppauge WinTV-HVR3000 I get
    the following oops:
    
     9464.262345] CX24123: detected CX24123
    [ 9464.262526] BUG: unable to handle kernel NULL pointer dereference at 0000000000000230
    [ 9464.262555] IP: [<ffffffff816676b5>] acpi_i2c_install_space_handler+0x15/0xc0
    [ 9464.262576] PGD 0
    [ 9464.262584] Oops: 0000 [#1] PREEMPT SMP
    [ 9464.262597] Modules linked in: cx24123 cx22702 cx88_dvb(+) videobuf_dvb cx88_vp3054_i2c cx88_blackbird cx8802 ir_lirc_codec ir_xmp_decoder ir_sanyo_decoder ir_jvc_decoder ir_mce_kbd_decoder ir_sharp_decoder lirc_dev ir_sony_decoder ir_rc6_decoder ir_nec_decoder ir_rc5_decoder rc_hauppauge wm8775 tuner_simple tuner_types tda9887 cx8800 cx88xx btcx_risc videobuf_dma_sg videobuf_core mt2131 s5h1409 tda8290 tuner cx25840 cx23885 altera_ci tda18271 altera_stapl videobuf2_dvb tveeprom cx2341x videobuf2_dma_sg dvb_core rc_core videobuf2_memops videobuf2_core v4l2_common videodev media nouveau x86_pkg_temp_thermal cfbfillrect cfbimgblt cfbcopyarea ttm drm_kms_helper processor button isci
    [ 9464.262786] CPU: 2 PID: 2417 Comm: modprobe Not tainted 3.17.0-rc1-telek #322
    [ 9464.262796] Hardware name: ASUSTeK COMPUTER INC. Z9PE-D8 WS/Z9PE-D8 WS, BIOS 5404 02/10/2014
    [ 9464.262807] task: ffff881097959ad0 ti: ffff88109967c000 task.ti: ffff88109967c000
    [ 9464.262817] RIP: 0010:[<ffffffff816676b5>]  [<ffffffff816676b5>] acpi_i2c_install_space_handler+0x15/0xc0
    [ 9464.262834] RSP: 0018:ffff88109967fbd8  EFLAGS: 00010246
    [ 9464.262843] RAX: 0000000000000000 RBX: ffff880892a89540 RCX: 0000000000000000
    [ 9464.262853] RDX: 0000000080000001 RSI: ffff880892e75870 RDI: ffff880892a89540
    [ 9464.262862] RBP: ffff88109967fbf8 R08: ffff881099b2ccc0 R09: ffff880891efa088
    [ 9464.262872] R10: 0000000000000000 R11: 0000000000000022 R12: 0000000000000000
    [ 9464.262883] R13: ffff880892a895b0 R14: 00000000ffffffed R15: ffff88089b48f800
    [ 9464.262893] FS:  00007fe42b6d7700(0000) GS:ffff88089fc40000(0000) knlGS:0000000000000000
    [ 9464.262904] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
    [ 9464.262912] CR2: 0000000000000230 CR3: 0000001094078000 CR4: 00000000000407e0
    [ 9464.262922] Stack:
    [ 9464.262927]  ffff880892a89540 0000000000000000 ffff880892a895b0 ffff88109a155a80
    [ 9464.262944]  ffff88109967fc20 ffffffff81666a36 0000000000000020 ffff880892a89540
    [ 9464.262960]  ffffffffa01c8d40 ffff88109967fc40 ffffffff81666c67 ffff880892a89000
    [ 9464.262977] Call Trace:
    [ 9464.262987]  [<ffffffff81666a36>] i2c_register_adapter+0x166/0x340
    [ 9464.262998]  [<ffffffff81666c67>] i2c_add_adapter+0x57/0x60
    [ 9464.263011]  [<ffffffffa01e2c58>] cx24123_attach+0x108/0x1ba [cx24123]
    [ 9464.263025]  [<ffffffffa01c5a76>] dvb_register+0x404/0x245b [cx88_dvb]
    [ 9464.263039]  [<ffffffffa0059183>] ? videobuf_queue_core_init+0xe3/0x140 [videobuf_core]
    [ 9464.263052]  [<ffffffffa01c54b1>] cx8802_dvb_probe+0x1e1/0x261 [cx88_dvb]
    [ 9464.263066]  [<ffffffffa01a3b00>] cx8802_register_driver+0x190/0x20d [cx8802]
    [ 9464.263077]  [<ffffffffa01cc000>] ? 0xffffffffa01cc000
    [ 9464.263089]  [<ffffffffa01cc025>] dvb_init+0x25/0x27 [cx88_dvb]
    [ 9464.263101]  [<ffffffff810002c4>] do_one_initcall+0x84/0x1c0
    [ 9464.263113]  [<ffffffff811893fa>] ? __vunmap+0x9a/0x100
    [ 9464.263125]  [<ffffffff81122a66>] load_module+0x1216/0x1790
    [ 9464.263134]  [<ffffffff8111ff70>] ? __symbol_put+0x70/0x70
    [ 9464.263145]  [<ffffffff811aa8cc>] ? vfs_read+0x11c/0x170
    [ 9464.263156]  [<ffffffff811201d9>] ? copy_module_from_fd.isra.53+0x119/0x170
    [ 9464.263168]  [<ffffffff81123116>] SyS_finit_module+0x76/0x80
    [ 9464.263181]  [<ffffffff818d19e9>] system_call_fastpath+0x16/0x1b
    [ 9464.263190] Code: 81 31 c0 e8 2e f6 e8 ff 48 83 c4 08 5b 5d eb de 66 0f 1f 44 00 00 55 48 89 e5 41 56 41 55 41 54 53 41 be ed ff ff ff 48 8b 47 70 <48> 8b 80 30 02 00 00 48 85 c0 74 58 4c 8b 68 08 4d 85 ed 74 4f
    [ 9464.263347] RIP  [<ffffffff816676b5>] acpi_i2c_install_space_handler+0x15/0xc0
    [ 9464.263361]  RSP <ffff88109967fbd8>
    [ 9464.263367] CR2: 0000000000000230
    [ 9464.266919] ---[ end trace 57fd490bdb72e733 ]---
    
    I traced this to a NULL i2c_adapter parent pointer when cx24123 creates its own
    i2c adapter. The acpi_i2c_install_space_handler function appeared in 3.17, so
    that's probably why this hasn't been seen before.
    
    Signed-off-by: Hans Verkuil <hans.verkuil@cisco.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@osg.samsung.com>

commit 7f196789b3ffee243b681d3e7dab8890038db856
Author: Mauro Carvalho Chehab <m.chehab@samsung.com>
Date:   Mon Jul 28 10:34:15 2014 -0300

    si2135: Declare the structs even if frontend is not enabled
    
    As reported by Kbuildtest:
    
       In file included from drivers/media/usb/cx231xx/cx231xx-dvb.c:35:0:
       drivers/media/dvb-frontends/si2165.h:57:9: warning: 'struct si2165_config' declared inside parameter list [enabled by default]
         struct i2c_adapter *i2c)
                ^
       drivers/media/dvb-frontends/si2165.h:57:9: warning: its scope is only this definition or declaration, which is probably not what you want [enabled by default]
       drivers/media/usb/cx231xx/cx231xx-dvb.c:157:21: error: variable 'hauppauge_930C_HD_1113xx_si2165_config' has initializer but incomplete type
        static const struct si2165_config hauppauge_930C_HD_1113xx_si2165_config = {
                            ^
       drivers/media/usb/cx231xx/cx231xx-dvb.c:158:2: error: unknown field 'i2c_addr' specified in initializer
         .i2c_addr = 0x64,
         ^
       drivers/media/usb/cx231xx/cx231xx-dvb.c:158:2: warning: excess elements in struct initializer [enabled by default]
       drivers/media/usb/cx231xx/cx231xx-dvb.c:158:2: warning: (near initialization for 'hauppauge_930C_HD_1113xx_si2165_config') [enabled by default]
       drivers/media/usb/cx231xx/cx231xx-dvb.c:159:2: error: unknown field 'chip_mode' specified in initializer
         .chip_mode = SI2165_MODE_PLL_XTAL,
         ^
       drivers/media/usb/cx231xx/cx231xx-dvb.c:159:15: error: 'SI2165_MODE_PLL_XTAL' undeclared here (not in a function)
         .chip_mode = SI2165_MODE_PLL_XTAL,
                      ^
       drivers/media/usb/cx231xx/cx231xx-dvb.c:159:2: warning: excess elements in struct initializer [enabled by default]
         .chip_mode = SI2165_MODE_PLL_XTAL,
         ^
       drivers/media/usb/cx231xx/cx231xx-dvb.c:159:2: warning: (near initialization for 'hauppauge_930C_HD_1113xx_si2165_config') [enabled by default]
       drivers/media/usb/cx231xx/cx231xx-dvb.c:160:2: error: unknown field 'ref_freq_Hz' specified in initializer
         .ref_freq_Hz = 16000000,
         ^
       drivers/media/usb/cx231xx/cx231xx-dvb.c:160:2: warning: excess elements in struct initializer [enabled by default]
       drivers/media/usb/cx231xx/cx231xx-dvb.c:160:2: warning: (near initialization for 'hauppauge_930C_HD_1113xx_si2165_config') [enabled by default]
    >> drivers/media/usb/cx231xx/cx231xx-dvb.c:163:21: error: variable 'pctv_quatro_stick_1114xx_si2165_config' has initializer but incomplete type
        static const struct si2165_config pctv_quatro_stick_1114xx_si2165_config = {
                            ^
       drivers/media/usb/cx231xx/cx231xx-dvb.c:164:2: error: unknown field 'i2c_addr' specified in initializer
         .i2c_addr = 0x64,
         ^
       drivers/media/usb/cx231xx/cx231xx-dvb.c:164:2: warning: excess elements in struct initializer [enabled by default]
    >> drivers/media/usb/cx231xx/cx231xx-dvb.c:164:2: warning: (near initialization for 'pctv_quatro_stick_1114xx_si2165_config') [enabled by default]
       drivers/media/usb/cx231xx/cx231xx-dvb.c:165:2: error: unknown field 'chip_mode' specified in initializer
         .chip_mode = SI2165_MODE_PLL_EXT,
         ^
    >> drivers/media/usb/cx231xx/cx231xx-dvb.c:165:15: error: 'SI2165_MODE_PLL_EXT' undeclared here (not in a function)
         .chip_mode = SI2165_MODE_PLL_EXT,
                      ^
       drivers/media/usb/cx231xx/cx231xx-dvb.c:165:2: warning: excess elements in struct initializer [enabled by default]
         .chip_mode = SI2165_MODE_PLL_EXT,
         ^
    >> drivers/media/usb/cx231xx/cx231xx-dvb.c:165:2: warning: (near initialization for 'pctv_quatro_stick_1114xx_si2165_config') [enabled by default]
       drivers/media/usb/cx231xx/cx231xx-dvb.c:166:2: error: unknown field 'ref_freq_Hz' specified in initializer
         .ref_freq_Hz = 24000000,
         ^
       drivers/media/usb/cx231xx/cx231xx-dvb.c:166:2: warning: excess elements in struct initializer [enabled by default]
    >> drivers/media/usb/cx231xx/cx231xx-dvb.c:166:2: warning: (near initialization for 'pctv_quatro_stick_1114xx_si2165_config') [enabled by default]
       drivers/media/usb/cx231xx/cx231xx-dvb.c: In function 'dvb_init':
       drivers/media/usb/cx231xx/cx231xx-dvb.c:731:3: warning: passing argument 1 of 'si2165_attach' from incompatible pointer type [enabled by default]
          dev->dvb->frontend = dvb_attach(si2165_attach,
          ^
       In file included from drivers/media/usb/cx231xx/cx231xx-dvb.c:35:0:
       drivers/media/dvb-frontends/si2165.h:55:36: note: expected 'const struct si2165_config *' but argument is of type 'const struct si2165_config *'
        static inline struct dvb_frontend *si2165_attach(
                                           ^
       drivers/media/usb/cx231xx/cx231xx-dvb.c:764:3: warning: passing argument 1 of 'si2165_attach' from incompatible pointer type [enabled by default]
          dev->dvb->frontend = dvb_attach(si2165_attach,
          ^
       In file included from drivers/media/usb/cx231xx/cx231xx-dvb.c:35:0:
       drivers/media/dvb-frontends/si2165.h:55:36: note: expected 'const struct si2165_config *' but argument is of type 'const struct si2165_config *'
        static inline struct dvb_frontend *si2165_attach(
                                           ^
    
    That happens because the frontend was disabled by .config, but the
    si2165_attach void stub require those structs, and also the
    drivers that call it.
    
    While here, remove the duplicated info about the possible I2C
    addresses.
    
    Signed-off-by: Mauro Carvalho Chehab <m.chehab@samsung.com>

commit a5a2391e275b4bff4ae42d4dac4fd42e6c98eb7a
Merge: c46145aee10d 1d531062cdc5
Author: Dave Airlie <airlied@redhat.com>
Date:   Mon Mar 24 08:58:20 2014 +1000

    Merge branch 'exynos-drm-next' of git://git.kernel.org/pub/scm/linux/kernel/git/daeinki/drm-exynos into drm-next
    
    Highlights
    ----------
    
    Re-factoring works over the exynos drm framework.
      - drm_crtc, drm_encoder/drm_connector are implemented by sub drivers
        directly.
      - Removing pm interfaces from each sub driver, and implementing them
        at top level of exynos drm.
    Add DisplayPort Transmitter driver.
      - Just moving existing driver from drivers/vides/exynos into
        drivers/gpu/drm/exynos.
    Add new LVDS bridge driver, PTN3460.
      - Placed in drivers/gpu/drm/bridge, and this device is used to transfer
        image signal from DP(DisplayPort) to LVDS Panel.
        So this driver will be used with DP driver moved into exynos drm.
    Add parallel panel support
      - With the re-factoring patch series, existing parallel panel support was
        broken by moving exynos_drm_display ops into each real connector driver,
        DP. So this patch series adds a new parallel panel module,
        exynos_drm_dpi, for supporting parallel panel, and also adds relevant
        bindings.
    Some fixups and cleanups.
    
    * 'exynos-drm-next' of git://git.kernel.org/pub/scm/linux/kernel/git/daeinki/drm-exynos: (45 commits)
      drm/exynos: fimd: remove unused variable
      ARM: dts: exynos4210-universal: add exynos/fimd node
      drm/exynos: restore parallel output interface support
      exynos/fimd: add parallel output related bindings
      drm/exynos: correct timing porch conversion
      drm/exynos: init kms poll after creation of connectors
      drm/exynos: delay fbdev initialization until an output is connected
      drm/exynos: fix unnecessary resource cleanup
      drm/exynos: hdmi: use i2c_adapter instead of i2c_client
      drm/exynos: hdmi: consider APB PHY
      drm/exynos: Remove the exynos_drm_connector shim
      drm/exynos: Implement lvds bridge discovery to DP driver
      drm/bridge: Add PTN3460 bridge driver
      drm/exynos: Implement drm_connector directly in vidi driver
      drm/exynos: Implement drm_connector directly in dp driver
      drm/exynos: Implement drm_connector in hdmi directly
      drm/exynos: Add create_connector callback
      drm/exynos: Consolidate suspend/resume in drm_drv
      drm/exynos: Clean up FIMD power on/off routines
      drm/exynos: Implement dpms display callback in DP
      ...

commit 8fa04aae2aa8bafcfc027856904ebee0060506d0
Author: Inki Dae <inki.dae@samsung.com>
Date:   Thu Mar 13 16:38:31 2014 +0900

    drm/exynos: hdmi: use i2c_adapter instead of i2c_client
    
    This patch changes i2c_client for ddc to i2c_adapter
    because ddc needs only i2c_adapter.
    
    Signed-off-by: Inki Dae <inki.dae@samsung.com>
    Signed-off-by: Kyungmin Park <kyungmin.park@samsung.com>

commit 0ff83d2cad1ad584bd5df639750f90bd6b09055c
Author: Jingoo Han <jg1.han@samsung.com>
Date:   Tue Mar 11 10:22:59 2014 +0900

    i2c: exynos5: remove unnecessary cast of void pointer
    
    Remove unnecessary cast of void pointer, because 'algo_data' of
    'struct i2c_adapter' is a void pointer. Casting the void pointer
    is redundant. The conversion from void pointer to any other
    pointer type is guaranteed by the C programming language.
    
    Signed-off-by: Jingoo Han <jg1.han@samsung.com>
    Reviewed-by: Naveen Krishna Chatradhi <ch.naveen@samsung.com>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>

commit 88759686c702f1fbbb8e737e6231b64a9880db73
Author: Thierry Reding <treding@nvidia.com>
Date:   Thu Dec 12 09:57:53 2013 +0100

    drm/dp: Allow registering AUX channels as I2C busses
    
    Implements an I2C-over-AUX I2C adapter on top of the generic drm_dp_aux
    infrastructure. It extracts the retry logic from existing drivers, which
    should help in porting those drivers to this new helper.
    
    Reviewed-by: Alex Deucher <alexander.deucher@amd.com>
    Reviewed-by: Jani Nikula <jani.nikula@intel.com>
    Signed-off-by: Thierry Reding <treding@nvidia.com>
    ---
    Changes in v5:
    - move comments partially to to header file
    - keep MOT set between I2C messages
    - return -EPROTO on short reads
    
    Changes in v4:
    - fix typo "bitrate" -> "bit rate"
    
    Changes in v3:
    - add back DRM_DEBUG_KMS and DRM_ERROR messages
    - embed i2c_adapter within struct drm_dp_aux
    - fix typo in comment

commit e9e352e9100b98aed1a5fb9e33355c29fb07d5b1
Merge: b3a4bcaa5a56 2b8454a75b90
Author: Linus Torvalds <torvalds@linux-foundation.org>
Date:   Wed Jan 29 20:06:01 2014 -0800

    Merge tag 'for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/olof/chrome-platform
    
    Pull chrome platform cleanups and improvements from Olof Johansson:
     - Use deferred probing on Chrome OS platforms for the i2c device
       registration.  This fixes a long-standing race of initialization of
       touchpad/screen on Chromebooks.
     - Added in platform device registration for pstore console on supported
       hardware
     - Misc smaller fixes (__initdata, module exit cleanup, etc)
    
    * tag 'for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/olof/chrome-platform:
      platform/chrome: unregister platform driver/device when module exit
      platform/chrome: Make i2c_adapter_names static
      platform/chrome: chromeos_laptop - fix incorrect placement of __initdata tag
      platform/chrome: chromeos_laptop - Use deferred probing
      platform/chrome: chromeos_laptop - Restructure device associations
      platform/chrome: Add pstore platform_device

commit ae117c4f7fda2f451122d1591b74ffd0a875907c
Author: Stephen Warren <swarren@nvidia.com>
Date:   Mon Jan 13 14:29:04 2014 -0700

    i2c: Re-instate body of i2c_parent_is_i2c_adapter()
    
    commit 2fac2b891f287691c27ee8d2eeecf39571b27fea upstream.
    
    The body of i2c_parent_is_i2c_adapter() is currently guarded by
    I2C_MUX. It should be CONFIG_I2C_MUX instead.
    
    Among potentially other problems, this resulted in i2c_lock_adapter()
    only locking I2C mux child adapters, and not the parent adapter. In
    turn, this could allow inter-mingling of mux child selection and I2C
    transactions, which could result in I2C transactions being directed to
    the wrong I2C bus, and possibly even switching between busses in the
    middle of a transaction.
    
    One concrete issue caused by this bug was corrupted HDMI EDID reads
    during boot on the NVIDIA Tegra Seaboard system, although this only
    became apparent in recent linux-next, when the boot timing was changed
    just enough to trigger the race condition.
    
    Fixes: 3923172b3d70 ("i2c: reduce parent checking to a NOOP in non-I2C_MUX case")
    Cc: Phil Carmody <phil.carmody@partner.samsung.com>
    Signed-off-by: Stephen Warren <swarren@nvidia.com>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a9bdddb8dd711d70c5e0068fd8ad5ae5f4419359
Merge: 2e67c56248b7 2fac2b891f28
Author: Linus Torvalds <torvalds@linux-foundation.org>
Date:   Thu Jan 16 08:21:17 2014 +0700

    Merge branch 'i2c/for-current' of git://git.kernel.org/pub/scm/linux/kernel/git/wsa/linux
    
    Pull i2c bugfix from Wolfram Sang.
    
    * 'i2c/for-current' of git://git.kernel.org/pub/scm/linux/kernel/git/wsa/linux:
      i2c: Re-instate body of i2c_parent_is_i2c_adapter()

commit 2fac2b891f287691c27ee8d2eeecf39571b27fea
Author: Stephen Warren <swarren@nvidia.com>
Date:   Mon Jan 13 14:29:04 2014 -0700

    i2c: Re-instate body of i2c_parent_is_i2c_adapter()
    
    The body of i2c_parent_is_i2c_adapter() is currently guarded by
    I2C_MUX. It should be CONFIG_I2C_MUX instead.
    
    Among potentially other problems, this resulted in i2c_lock_adapter()
    only locking I2C mux child adapters, and not the parent adapter. In
    turn, this could allow inter-mingling of mux child selection and I2C
    transactions, which could result in I2C transactions being directed to
    the wrong I2C bus, and possibly even switching between busses in the
    middle of a transaction.
    
    One concrete issue caused by this bug was corrupted HDMI EDID reads
    during boot on the NVIDIA Tegra Seaboard system, although this only
    became apparent in recent linux-next, when the boot timing was changed
    just enough to trigger the race condition.
    
    Fixes: 3923172b3d70 ("i2c: reduce parent checking to a NOOP in non-I2C_MUX case")
    Cc: Phil Carmody <phil.carmody@partner.samsung.com>
    Cc: <stable@vger.kernel.org>
    Signed-off-by: Stephen Warren <swarren@nvidia.com>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>

commit 6fcd3b619c06544b5d33493d0ab297a5b8e64b68
Author: Mauro Carvalho Chehab <m.chehab@samsung.com>
Date:   Mon Jan 13 11:34:37 2014 -0200

    [media] radio-usb-si4713: make si4713_register_i2c_adapter static
    
    This function isn't used nowhere outside the same .c file.
    Fixes this warning:
    
    drivers/media/radio/si4713/radio-usb-si4713.c:418:5: warning: no previous prototype for 'si4713_register_i2c_adapter' [-Wmissing-prototypes]
     int si4713_register_i2c_adapter(struct si4713_usb_device *radio)
         ^
    
    Cc: Hans Verkuil <hverkuil@xs4all.nl>
    Signed-off-by: Mauro Carvalho Chehab <m.chehab@samsung.com>

commit 6d3c1afe7367447c8f7d2fec7a132f723834efd1
Author: Olof Johansson <olof@lixom.net>
Date:   Mon Nov 25 13:10:25 2013 -0800

    platform/chrome: Make i2c_adapter_names static
    
    Not used outside of the file, so declaration should be static. Picked up by
    sparse:
    
    drivers/platform/chrome/chromeos_laptop.c:44:12: warning: symbol
        'i2c_adapter_names' was not declared. Should it be static?
    
    Signed-off-by: Olof Johansson <olof@lixom.net>
    Reviewed-by: Benson Leung <bleung@chromium.org>

commit f0d55cc1a65852e6647d4f5d707c1c9b5471ce3c
Merge: 549608eadb31 3a41c5dbe8bc
Author: Linus Torvalds <torvalds@linux-foundation.org>
Date:   Thu Nov 14 14:44:20 2013 +0900

    Merge tag 'fbdev-3.13' of git://git.kernel.org/pub/scm/linux/kernel/git/tomba/linux
    
    Pull fbdev changes from Tomi Valkeinen:
     "Nothing particularly stands out in this pull request.  The biggest
      part of the changes are cleanups.
    
      Maybe one fix to mention is the "fb: reorder the lock sequence to fix
      potential dead lock" which hopefully fixes the fb locking issues
      reported by multiple persons.
    
      There are also a few commits that have changes to arch/arm/mach-at91
      and arch/avr32, which have been acked by the maintainers"
    
    * tag 'fbdev-3.13' of git://git.kernel.org/pub/scm/linux/kernel/git/tomba/linux: (143 commits)
      fb: reorder the lock sequence to fix potential dead lock
      fbdev: shmobile-lcdcfb: Convert to clk_prepare/unprepare
      fbdev: shmobile-hdmi: Convert to clk_prepare/unprepare
      omapdss: Add new panel driver for Topolly td028ttec1 LCD.
      video: exynos_mipi_dsi: Unlock the mutex before returning
      video: da8xx-fb: remove unwanted define
      video: Remove unnecessary semicolons
      simplefb: use write-combined remapping
      simplefb: fix unmapping fb during destruction
      OMAPDSS: connector-dvi: fix releasing i2c_adapter
      OMAPDSS: DSI: fix perf measuring ifdefs
      framebuffer: Use fb_<level>
      framebuffer: Add fb_<level> convenience logging macros
      efifb: prevent null-deref when iterating dmi_list
      fbdev: fix error return code in metronomefb_probe()
      video: xilinxfb: Fix for "Use standard variable name convention"
      OMAPDSS: Fix de_level in videomode_to_omap_video_timings()
      video: xilinxfb: Simplify error path
      video: xilinxfb: Use devm_kzalloc instead of kzalloc
      video: xilinxfb: Use standard variable name convention
      ...

commit cc9fd77c08940c869cdfa38442f32458c5be900c
Author: Tomi Valkeinen <tomi.valkeinen@ti.com>
Date:   Fri Oct 18 10:46:33 2013 +0300

    OMAPDSS: connector-dvi: fix releasing i2c_adapter
    
    i2c adapter is not released correctly on error paths. Fix this.
    
    Signed-off-by: Tomi Valkeinen <tomi.valkeinen@ti.com>

commit c66c4cc087eb1f5307f6391e467797227aed758a
Author: Sebastian Hesselbarth <sebastian.hesselbarth@gmail.com>
Date:   Thu Aug 1 14:10:46 2013 +0200

    i2c: add sanity check to i2c_put_adapter
    
    i2c_put_adapter dereferences i2c_adapter pointer passed without check
    for NULL. This adds a check for non-NULL pointer to allow i2c_put_adapter
    called with NULL and behave the same way i2c_release_client does already.
    It allows to simplify drivers where you need to release the adapter
    during probe failures.
    
    Signed-off-by: Sebastian Hesselbarth <sebastian.hesselbarth@gmail.com>
    Signed-off-by: Wolfram Sang <wsa@the-dreams.de>

commit bb69ee27b96110c509d5b92c9ee541d81a821706
Author: Mauro Carvalho Chehab <mchehab@redhat.com>
Date:   Thu Jun 20 10:35:53 2013 -0300

    [media] Fix build when drivers are builtin and frontend modules
    
    There are a large number of reports that the media build is
    not compiling when some drivers are compiled as builtin, while
    the needed frontends are compiled as module.
    
    On the last one of such reports:
            From: kbuild test robot <fengguang.wu@intel.com>
            Subject: saa7134-dvb.c:undefined reference to `zl10039_attach'
    
    The .config file has:
    
            CONFIG_VIDEO_SAA7134=y
            CONFIG_VIDEO_SAA7134_DVB=y
            # CONFIG_MEDIA_ATTACH is not set
            CONFIG_DVB_ZL10039=m
    
    And it produces all those errors:
    
       drivers/built-in.o: In function `set_type':
       tuner-core.c:(.text+0x2f263e): undefined reference to `tea5767_attach'
       tuner-core.c:(.text+0x2f273e): undefined reference to `tda9887_attach'
       drivers/built-in.o: In function `tuner_probe':
       tuner-core.c:(.text+0x2f2d20): undefined reference to `tea5767_autodetection'
       drivers/built-in.o: In function `av7110_attach':
       av7110.c:(.text+0x330bda): undefined reference to `ves1x93_attach'
       av7110.c:(.text+0x330bf7): undefined reference to `stv0299_attach'
       av7110.c:(.text+0x330c63): undefined reference to `tda8083_attach'
       av7110.c:(.text+0x330d09): undefined reference to `ves1x93_attach'
       av7110.c:(.text+0x330d33): undefined reference to `tda8083_attach'
       av7110.c:(.text+0x330d5d): undefined reference to `stv0297_attach'
       av7110.c:(.text+0x330dbe): undefined reference to `stv0299_attach'
       drivers/built-in.o: In function `tuner_attach_dtt7520x':
       ngene-cards.c:(.text+0x3381cb): undefined reference to `dvb_pll_attach'
       drivers/built-in.o: In function `demod_attach_lg330x':
       ngene-cards.c:(.text+0x33828a): undefined reference to `lgdt330x_attach'
       drivers/built-in.o: In function `demod_attach_stv0900':
       ngene-cards.c:(.text+0x3383d5): undefined reference to `stv090x_attach'
       drivers/built-in.o: In function `cineS2_probe':
       ngene-cards.c:(.text+0x338b7f): undefined reference to `drxk_attach'
       drivers/built-in.o: In function `configure_tda827x_fe':
       saa7134-dvb.c:(.text+0x346ae7): undefined reference to `tda10046_attach'
       drivers/built-in.o: In function `dvb_init':
       saa7134-dvb.c:(.text+0x347283): undefined reference to `mt352_attach'
       saa7134-dvb.c:(.text+0x3472cd): undefined reference to `mt352_attach'
       saa7134-dvb.c:(.text+0x34731c): undefined reference to `tda10046_attach'
       saa7134-dvb.c:(.text+0x34733c): undefined reference to `tda10046_attach'
       saa7134-dvb.c:(.text+0x34735c): undefined reference to `tda10046_attach'
       saa7134-dvb.c:(.text+0x347378): undefined reference to `tda10046_attach'
       saa7134-dvb.c:(.text+0x3473db): undefined reference to `tda10046_attach'
       drivers/built-in.o:saa7134-dvb.c:(.text+0x347502): more undefined references to `tda10046_attach' follow
       drivers/built-in.o: In function `dvb_init':
       saa7134-dvb.c:(.text+0x347812): undefined reference to `mt352_attach'
       saa7134-dvb.c:(.text+0x347951): undefined reference to `mt312_attach'
       saa7134-dvb.c:(.text+0x3479a9): undefined reference to `mt312_attach'
    >> saa7134-dvb.c:(.text+0x3479c1): undefined reference to `zl10039_attach'
    
    This is happening because a builtin module can't use directly a symbol
    found on a module. By enabling CONFIG_MEDIA_ATTACH, the configuration
    becomes valid, as dvb_attach() macro loads the module if needed, making
    the symbol available to the builtin module.
    
    While this bug started to appear after the patches that use IS_DEFINED
    macro (like changeset 7b34be71db533f3e0cf93d53cf62d036cdb5418a), this
    bug is a way ancient than that.
    
    The thing is that, before the IS_DEFINED() patches, the logic used to be:
    
           && defined(MODULE))
    struct dvb_frontend *zl10039_attach(struct dvb_frontend *fe,
                                            u8 i2c_addr,
                                            struct i2c_adapter *i2c);
    static inline struct dvb_frontend *zl10039_attach(struct dvb_frontend *fe,
                                            u8 i2c_addr,
                                            struct i2c_adapter *i2c)
    {
            printk(KERN_WARNING "%s: driver disabled by Kconfig\n", __func__);
            return NULL;
    }
    
    The above code, with the .config file used, was evoluting to FALSE
    (instead of TRUE as it should be, as CONFIG_DVB_ZL10039 is 'm'),
    and were adding the static inline code at saa7134-dvb, instead
    of the external call. So, while it weren't producing any compilation
    error, the code weren't working either.
    
    So, as the overhead for using CONFIG_MEDIA_ATTACH is minimal, just
    enable it, if MODULES is defined.
    
    Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>

commit 99119595d9ff06f74d97d3623fd8a63138f9b287
Author: Randy Dunlap <rdunlap@infradead.org>
Date:   Mon May 20 12:32:39 2013 -0300

    [media] media: fix hdpvr kconfig/build errors
    
    Fix hdpvr build errors when CONFIG_I2C=m and VIDEO_V4L2=m and
    VIDEO_HDPVR=y.
    drivers/built-in.o: In function `hdpvr_disconnect':
    hdpvr-core.c:(.text+0xef542): undefined reference to `v4l2_device_disconnect'
    hdpvr-core.c:(.text+0xef57e): undefined reference to `i2c_del_adapter'
    hdpvr-core.c:(.text+0xef58a): undefined reference to `video_unregister_device'
    drivers/built-in.o: In function `hdpvr_delete':
    (.text+0xef5b9): undefined reference to `video_device_release'
    drivers/built-in.o: In function `hdpvr_probe':
    hdpvr-core.c:(.text+0xef63a): undefined reference to `v4l2_device_register'
    hdpvr-core.c:(.text+0xefd97): undefined reference to `i2c_del_adapter'
    drivers/built-in.o: In function `hdpvr_s_ctrl':
    hdpvr-video.c:(.text+0xf03c0): undefined reference to `v4l2_ctrl_activate'
    drivers/built-in.o: In function `hdpvr_device_release':
    hdpvr-video.c:(.text+0xf0470): undefined reference to `v4l2_device_unregister'
    hdpvr-video.c:(.text+0xf0479): undefined reference to `v4l2_ctrl_handler_free'
    hdpvr-video.c:(.text+0xf048f): undefined reference to `i2c_del_adapter'
    drivers/built-in.o: In function `hdpvr_open':
    hdpvr-video.c:(.text+0xf0570): undefined reference to `video_devdata'
    hdpvr-video.c:(.text+0xf057b): undefined reference to `v4l2_fh_init'
    hdpvr-video.c:(.text+0xf0583): undefined reference to `v4l2_fh_add'
    drivers/built-in.o: In function `video_drvdata':
    hdpvr-video.c:(.text+0xf08a0): undefined reference to `video_devdata'
    drivers/built-in.o: In function `vidioc_s_dv_timings':
    hdpvr-video.c:(.text+0xf0d34): undefined reference to `v4l_match_dv_timings'
    drivers/built-in.o: In function `hdpvr_poll':
    hdpvr-video.c:(.text+0xf1455): undefined reference to `v4l2_ctrl_poll'
    drivers/built-in.o: In function `hdpvr_release':
    hdpvr-video.c:(.text+0xf18f6): undefined reference to `v4l2_fh_release'
    drivers/built-in.o: In function `hdpvr_register_videodev':
    (.text+0xf1be3): undefined reference to `v4l2_ctrl_handler_init_class'
    drivers/built-in.o: In function `hdpvr_register_videodev':
    (.text+0xf1c19): undefined reference to `v4l2_ctrl_new_std'
    drivers/built-in.o: In function `hdpvr_register_videodev':
    (.text+0xf1c42): undefined reference to `v4l2_ctrl_new_std'
    drivers/built-in.o: In function `hdpvr_register_videodev':
    (.text+0xf1c6b): undefined reference to `v4l2_ctrl_new_std'
    drivers/built-in.o: In function `hdpvr_register_videodev':
    (.text+0xf1cac): undefined reference to `v4l2_ctrl_new_std'
    drivers/built-in.o: In function `hdpvr_register_videodev':
    (.text+0xf1cd5): undefined reference to `v4l2_ctrl_new_std'
    drivers/built-in.o:(.text+0xf1cfe): more undefined references to `v4l2_ctrl_new_std' follow
    drivers/built-in.o: In function `hdpvr_register_videodev':
    (.text+0xf1d75): undefined reference to `v4l2_ctrl_new_std_menu'
    drivers/built-in.o: In function `hdpvr_register_videodev':
    (.text+0xf1d9e): undefined reference to `v4l2_ctrl_new_std_menu'
    drivers/built-in.o: In function `hdpvr_register_videodev':
    (.text+0xf1dc3): undefined reference to `v4l2_ctrl_new_std_menu'
    drivers/built-in.o: In function `hdpvr_register_videodev':
    (.text+0xf1de5): undefined reference to `v4l2_ctrl_new_std_menu'
    drivers/built-in.o: In function `hdpvr_register_videodev':
    (.text+0xf1e18): undefined reference to `v4l2_ctrl_new_std'
    drivers/built-in.o: In function `hdpvr_register_videodev':
    (.text+0xf1e4b): undefined reference to `v4l2_ctrl_new_std'
    drivers/built-in.o: In function `hdpvr_register_videodev':
    (.text+0xf1e90): undefined reference to `v4l2_ctrl_cluster'
    drivers/built-in.o: In function `hdpvr_register_videodev':
    (.text+0xf1e98): undefined reference to `v4l2_ctrl_handler_setup'
    drivers/built-in.o: In function `hdpvr_register_videodev':
    (.text+0xf1ec1): undefined reference to `video_device_alloc'
    drivers/built-in.o: In function `hdpvr_register_videodev':
    (.text+0xf1f85): undefined reference to `__video_register_device'
    drivers/built-in.o: In function `hdpvr_register_videodev':
    (.text+0xf1fac): undefined reference to `v4l2_ctrl_handler_free'
    drivers/built-in.o: In function `hdpvr_register_ir_tx_i2c':
    (.text+0xf238f): undefined reference to `i2c_new_device'
    drivers/built-in.o: In function `hdpvr_register_ir_rx_i2c':
    (.text+0xf2434): undefined reference to `i2c_new_device'
    drivers/built-in.o: In function `hdpvr_register_i2c_adapter':
    (.text+0xf2514): undefined reference to `i2c_add_adapter'
    drivers/built-in.o:(.rodata+0x1b368): undefined reference to `video_ioctl2'
    drivers/built-in.o:(.rodata+0x1b690): undefined reference to `v4l2_ctrl_log_status'
    drivers/built-in.o:(.rodata+0x1b6f8): undefined reference to `v4l2_ctrl_subscribe_event'
    drivers/built-in.o:(.rodata+0x1b700): undefined reference to `v4l2_event_unsubscribe'
    
    Signed-off-by: Randy Dunlap <rdunlap@infradead.org>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>

commit 098af4bde09792314ff106f545c405ffc5942c25
Author: Mauro Carvalho Chehab <mchehab@redhat.com>
Date:   Tue Apr 16 19:56:05 2013 -0300

    [media] sta2x11_vip: Fix compilation if I2C is not set
    
    From Fengguang Wu <fengguang.wu@intel.com>:
    
    > drivers/media/pci/sta2x11/sta2x11_vip.c: In function 'sta2x11_vip_init_one':
    > drivers/media/pci/sta2x11/sta2x11_vip.c:1314:2: error: implicit declaration of function 'i2c_get_adapter' [-Werror=implicit-function-declaration]
    > drivers/media/pci/sta2x11/sta2x11_vip.c:1314:15: warning: assignment makes pointer from integer without a cast [enabled by default]
    > drivers/media/pci/sta2x11/sta2x11_vip.c:1330:2: error: implicit declaration of function 'i2c_put_adapter' [-Werror=implicit-function-declaration]
    
    And also:
    
    > warning: (STA2X11_VIP) selects VIDEO_ADV7180 which has unmet direct dependencies (MEDIA_SUPPORT && VIDEO_V4L2 && I2C)
    > drivers/media/i2c/adv7180.c: In function '__adv7180_status':
    > drivers/media/i2c/adv7180.c:194:2: error: implicit declaration of function 'i2c_smbus_read_byte_data' [-Werror=implicit-function-declaration]
    > drivers/media/i2c/adv7180.c: In function 'adv7180_s_routing':
    > drivers/media/i2c/adv7180.c:251:2: error: implicit declaration of function 'i2c_smbus_write_byte_data' [-Werror=implicit-function-declaration]
    > drivers/media/i2c/adv7180.c: In function 'adv7180_probe':
    > drivers/media/i2c/adv7180.c:551:2: error: implicit declaration of function 'i2c_check_functionality' [-Werror=implicit-function-declaration]
    > drivers/media/i2c/adv7180.c:554:2: error: implicit declaration of function 'i2c_adapter_id' [-Werror=implicit-function-declaration]
    > drivers/media/i2c/adv7180.c: At top level:
    > drivers/media/i2c/adv7180.c:663:1: warning: data definition has no type or storage class [enabled by default]
    > drivers/media/i2c/adv7180.c:663:1: warning: type defaults to 'int' in declaration of 'module_i2c_driver' [-Wimplicit-int]
    > drivers/media/i2c/adv7180.c:663:1: warning: parameter names (without types) in function declaration [enabled by default]
    > drivers/media/i2c/adv7180.c:649:26: warning: 'adv7180_driver' defined but not used [-Wunused-variable]
    
    This is due to the lack of I2C support:
    
    ...
    > CONFIG_I2C is not set
    ...
    
    So, Make sure that sta2x11_vip depends on I2C.
    
    Reported-by: Fengguang Wu <fengguang.wu@intel.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>

commit b34bb1ee71158d5b0f9028fb98afd026202bcfe9
Author: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
Date:   Mon Apr 1 00:25:03 2013 +0000

    ACPI / I2C: Use parent's ACPI_HANDLE() in acpi_i2c_register_devices()
    
    The ACPI handle of struct i2c_adapter's dev member should not be
    set, because this causes that struct i2c_adapter to be associated
    with the ACPI device node corresponding to its parent as the
    second "physical_device", which is incorrect (this happens during
    the registration of struct i2c_adapter).  Consequently,
    acpi_i2c_register_devices() should use the ACPI handle of the
    parent of the struct i2c_adapter it is called for rather than the
    struct i2c_adapter's ACPI handle (which should be NULL).
    
    Make that happen and modify the i2c-designware-platdrv driver,
    which currently is the only driver for ACPI-enumerated I2C
    controller chips, not to set the ACPI handle for the
    struct i2c_adapter it creates.
    
    Signed-off-by: Rafael J. Wysocki <rafael.j.wysocki@intel.com>
    Reviewed-by: Aaron Lu <aaron.lu@intel.com>
    Acked-by: Mika Westerberg <mika.westerberg@linux.intel.com>
    Acked-by: Wolfram Sang <wsa@the-dreams.de>

commit 1daa8a0b2000974e07eacbabecd61bccadc933b9
Author: Guennadi Liakhovetski <g.liakhovetski@gmx.de>
Date:   Mon Dec 10 20:41:27 2012 +0100

    of/i2c: add dummy inline functions for when CONFIG_OF_I2C(_MODULE) isn't defined
    
    If CONFIG_OF_I2C and CONFIG_OF_I2C_MODULE are undefined no declaration of
    of_find_i2c_device_by_node and of_find_i2c_adapter_by_node will be
    available. Add dummy inline functions to avoid compilation breakage.
    
    Signed-off-by: Guennadi Liakhovetski <g.liakhovetski@gmx.de>
    Signed-off-by: Grant Likely <grant.likely@secretlab.ca>

commit e154bf6fbfc167426ee938111a5ffa36bd8541a1
Author: Andrew Armenia <andrew@asquaredlabs.com>
Date:   Tue Jul 24 14:13:56 2012 +0200

    i2c-piix4: Separate registration and probing code
    
    Some chipsets have multiple sets of SMBus registers each controlling a
    separate SMBus. Supporting these chipsets properly will require registering
    multiple I2C adapters for one piix4.
    
    The code to initialize and register the i2c_adapter structure has been
    separated from piix4_probe and allows registration of a piix4 adapter
    given its base address. Note that the i2c_adapter and i2c_piix4_adapdata
    structures are now dynamically allocated.
    
    Signed-off-by: Andrew Armenia <andrew@asquaredlabs.com>
    Signed-off-by: Jean Delvare <khali@linux-fr.org>

commit ae32adc1e06d096399f195eeda12d443d53539c4
Merge: f465d145d768 9868a060ccf7
Author: Linus Torvalds <torvalds@linux-foundation.org>
Date:   Sat May 26 13:35:03 2012 -0700

    Merge branch 'i2c-embedded/for-next' of git://git.pengutronix.de/git/wsa/linux
    
    Pull i2c-embedded changes from Wolfram Sang:
     "Major changes:
    
       - lots of devicetree additions for existing drivers.  I tried hard to
         make sure the bindings are proper.  In more complicated cases, I
         requested acks from people having more experience with them than
         me.  That took a bit of extra time and also some time went into
         discussions with developers about what bindings are and what not.
         I have the feeling that the workflow with bindings should be
         improved to scale better.  I will spend some more thought on
         this...
    
       - i2c-muxes are succesfully used meanwhile, so we dropped
         EXPERIMENTAL for them and renamed the drivers to a standard pattern
         to match the rest of the subsystem.  They can also be used with
         devicetree now.
    
       - ixp2000 was removed since the whole platform goes away.
    
       - cleanups (strlcpy instead of strcpy, NULL instead of 0)
    
       - The rest is typical driver fixes I assume.
    
      All patches have been in linux-next at least since v3.4-rc6."
    
    Fixed up trivial conflict in arch/arm/mach-lpc32xx/common.c due to the
    same patch already having come in through the arm/soc trees, with
    additional patches on top of it.
    
    * 'i2c-embedded/for-next' of git://git.pengutronix.de/git/wsa/linux: (35 commits)
      i2c: davinci: Free requested IRQ in remove
      i2c: ocores: register OF i2c devices
      i2c: tegra: notify transfer-complete after clearing status.
      I2C: xiic: Add OF binding support
      i2c: Rename last mux driver to standard pattern
      i2c: tegra: fix 10bit address configuration
      i2c: muxes: rename first set of drivers to a standard pattern
      of/i2c: implement of_find_i2c_adapter_by_node
      i2c: implement i2c_verify_adapter
      i2c-s3c2410: Add HDMIPHY quirk for S3C2440
      i2c-s3c2410: Rework device type handling
      i2c: muxes are not EXPERIMENTAL anymore
      i2c/of: Automatically populate i2c mux busses from device tree data.
      i2c: Add a struct device * parameter to i2c_add_mux_adapter()
      of/i2c: call i2c_verify_client from of_find_i2c_device_by_node
      i2c: designware: Add clk_{un}prepare() support
      i2c: designware: add PM support
      i2c: ixp2000: remove driver
      i2c: pnx: add device tree support
      i2c: imx: don't use strcpy but strlcpy
      ...

commit 0938643e533cc80ef0cdfdd2e260c4910d0f8bc7
Author: Stephen Warren <swarren@nvidia.com>
Date:   Tue Apr 17 12:43:34 2012 -0600

    of/i2c: implement of_find_i2c_adapter_by_node
    
    This finds the struct i2c_adapter * for a given device tree node. Just
    like of_find_i2c_device_by_node.
    
    Signed-off-by: Stephen Warren <swarren@nvidia.com>
    Signed-off-by: Wolfram Sang <w.sang@pengutronix.de>

commit 643dd09eb27b40ced671564edbe2640935fe37c2
Author: Stephen Warren <swarren@nvidia.com>
Date:   Tue Apr 17 12:43:33 2012 -0600

    i2c: implement i2c_verify_adapter
    
    This converts a struct device * to a struct i2c_adapter * while verifying
    that the device really is an I2C adapter. Just like i2c_verify_client.
    
    Signed-off-by: Stephen Warren <swarren@nvidia.com>
    Acked-by: Jean Delvare <khali@linux-fr.org>
    Signed-off-by: Wolfram Sang <w.sang@pengutronix.de>

commit 3bd7d90938f1fe77de5991dc4b727843c4980b2a
Author: Daniel Kurtz <djkurtz@chromium.org>
Date:   Wed Mar 28 02:36:14 2012 +0800

    drm/i915/intel_i2c: refactor using intel_gmbus_get_adapter
    
    Instead of letting other modules directly access the ->gmbus array,
    introduce intel_gmbus_get_adapter() for looking up an i2c_adapter
    for a given gmbus port identifier.  This will enable later refactoring
    of the gmbus port list.
    
    Note: Before requesting an adapter for a given gmbus port number, the
    driver must first check its validity using i2c_intel_gmbus_is_port_valid().
    If this check fails, a call to intel_gmbus_get_adapter() will WARN_ON and
    return NULL.  This is relevant for parts of the driver that read a port
    from VBIOS, which might be improperly initialized and contain an invalid
    port.  In these cases, the driver must fall back to using a safer default
    port.
    
    Signed-off-by: Daniel Kurtz <djkurtz@chromium.org>
    Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>

commit 5bdf7411bc2329cfe015ba6dcf59531e0c6891b8
Author: Jett.Zhou <jtzhou@marvell.com>
Date:   Fri Nov 11 15:38:26 2011 +0800

    mfd: Fix 88pm860x test bank i2c interface bug
    
    There are two banks in 88pm8607. One is the normal bank, and the other
    one is the test bank, it means it have the same register address in the
    normal bank and test bank seperately.
    For test bank register, it needs a special I2C sequence to acess as below,
        Touching to 0xFA address
        Touching to 0xFB address
        Touching to 0xFF address
        Accessing bank register
        Touching to 0xFE address
        Touching to 0xFC address
    This sequence can't be interrupted. It means that we can't use
    i2c_transfef() to implement touching 0xFA address. Otherwise, other i2c
    operation may be inserted into 0xFA and 0xFB operation since the lock of
    i2c_adapter is already released.
    So for test bank we implemented specific i2c read/write operation;
    
    Signed-off-by: Jett.Zhou <jtzhou@marvell.com>
    Signed-off-by: Samuel Ortiz <sameo@linux.intel.com>

commit 6132725eac521b89dee3d58df3c6d04a1e50844c
Author: Timur Tabi <timur@freescale.com>
Date:   Thu Dec 1 19:52:47 2011 -0600

    ASoC: fsl/powerpc: don't rely on the cell-index property
    
    Instead of using the 'cell-index' property in the I2C adapter node to
    determine the adapter number, just query the i2c_adapter object directly.
    
    Previously, the I2C nodes always appeared in cell-index order, so the
    dynamic numbering coincided with the cell-index property.  With commit
    ab827d97 ("powerpc/85xx: Rework P1022DS device tree"), the I2C nodes are
    unintentionally reversed in the device tree, and so the machine driver
    guesses the wrong I2C adapter number.
    
    Signed-off-by: Timur Tabi <timur@freescale.com>
    Signed-off-by: Mark Brown <broonie@opensource.wolfsonmicro.com>

commit 595a93a47a3b7dc1be84160fbd73b1406074f411
Author: Jonathan Corbet <corbet@lwn.net>
Date:   Sat Jun 11 14:46:48 2011 -0300

    [media] marvell-cam: Allocate the i2c adapter in the platform driver
    
    The upcoming mmp-camera driver will need an i2c_adapter structure allocated
    externally, so change the core adapter to a pointer and require the
    platform code to fill it in.
    
    Signed-off-by: Jonathan Corbet <corbet@lwn.net>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>

commit 56184e3da005e0259fc628706351b54fcc4527db
Author: Chris Wilson <chris@chris-wilson.co.uk>
Date:   Tue May 17 14:03:50 2011 +0100

    drm/i915/sdvo: Reorder i2c initialisation before ddc proxy
    
    The ddc proxy depends upon the underlying i2c bus being selected. Under
    certain configurations, the i2c-adapter functionality is queried during
    initialisation and so may trigger an OOPS during boot. Hence, we need to
    reorder the initialisation of the ddc proxy until after we hook up the i2c
    adapter for the SDVO device.
    
    The condition under which it fails is when the i2c_add_adapter calls
    into i2c_detect which will attempt to probe all valid addresses on the
    adapter iff there is a pre-existing i2c_driver with the same class as
    the freshly added i2c_adapter.
    
    So it appears to depend upon having compiled in (or loaded such a
    module before i915.ko) an i2c-driver that likes to futz over the
    i2c_adapters claiming DDC support.
    
    Reported-by: Mihai Moldovan <ionic@ionic.de>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
    Reviewed-by: Keith Packard <keithp@keithp.com>
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit 444699c8503eaeb0cf15e24ad76f69b14df6097a
Merge: 6113f39dd15e 662cda8abb27
Author: Linus Torvalds <torvalds@linux-foundation.org>
Date:   Sun Mar 20 17:54:13 2011 -0700

    Merge branch 'i2c-for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/jdelvare/staging
    
    * 'i2c-for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/jdelvare/staging:
      i2c-i801: SMBus patch for Intel DH89xxCC DeviceIDs
      i2c: Drop i2c_adapter.id
      i2c: Deprecate i2c_driver.attach_adapter and .detach_adapter
      i2c-dev: Use standard bus notification mechanism
      i2c: Export i2c_for_each_dev
      i2c: Get rid of <linux/i2c-id.h>
      i2c: Minor fixes to upgrading-clients document
      i2c: make i2c_get_adapter prototype clearer
      i2c: Fix typo in instantiating-devices document
      i2c-boardinfo: Fix typo in comment

commit c185a9420bd1c645252249018e6887a968d3e1de
Author: Jean Delvare <khali@linux-fr.org>
Date:   Sun Mar 20 14:50:53 2011 +0100

    i2c: Drop i2c_adapter.id
    
    There is no user left of i2c_adapter.id, so we can get rid of it.
    Finally! :)
    
    Signed-off-by: Jean Delvare <khali@linux-fr.org>

commit fd34b0dee4d237ce9332cc62b03adebfe4fa9f9d
Merge: 40c7f2112ce1 c9ac1361d225
Author: Linus Torvalds <torvalds@linux-foundation.org>
Date:   Thu Mar 17 09:56:43 2011 -0700

    Merge git://git.kernel.org/pub/scm/linux/kernel/git/lethal/fbdev-2.6
    
    * git://git.kernel.org/pub/scm/linux/kernel/git/lethal/fbdev-2.6:
      fbdev: sh_mobile_lcdc: Add YUV framebuffer support
      viafb: split pll configs up
      viafb: remove duplicated clock storage
      viafb: always return the best possible clock
      viafb: remove duplicated clock information
      fbdev: sh_mobile_lcdcfb: add backlight support
      viafb: factor lcd scaling parameters out
      viafb: strip some structures
      viafb: remove unused data_mode and device_type
      viafb: kill lcd_panel_id
      video via: make local variables static
      video via: fix iomem access
      video/via: drop deprecated (and unused) i2c_adapter.id

commit a625e305edd8e3ac08888a9b52981205b68cdb0e
Author: Peter Huewe <peterhuewe@gmx.de>
Date:   Tue Jan 25 22:34:24 2011 +0100

    video/via: drop deprecated (and unused) i2c_adapter.id
    
    This patch removes an assignment to the deprecated i2c_adapter.id
    field. Since the field isn't used anywhere else in the driver it is
    save to remove it.
    
    Signed-off-by: Peter Huewe <peterhuewe@gmx.de>
    Acked-by: Jean Delvare <khali@linux-fr.org>
    Signed-off-by: Florian Tobias Schandinat <FlorianSchandinat@gmx.de>

commit 324b04ba5da7918a2409f8113e46843bfbd89e67
Author: Jarod Wilson <jarod@redhat.com>
Date:   Fri Jan 14 16:25:21 2011 -0300

    [media] hdpvr: enable IR part
    
    A number of things going on here, but the end result is that the IR part
    on the hdpvr gets enabled, and can be used with ir-kbd-i2c and/or
    lirc_zilog.
    
    First up, there are some conditional build fixes that come into play
    whether i2c is built-in or modular. Second, we're swapping out
    i2c_new_probed_device() for i2c_new_device(), as in my testing, probing
    always fails, but we *know* that all hdpvr devices have a z8 chip at
    0x70 and 0x71. Third, we're poking at an i2c address directly without a
    client, and writing some magic bits to actually turn on this IR part
    (this could use some improvement in the future). Fourth, some of the
    i2c_adapter storage has been reworked, as the existing implementation
    used to lead to an oops following i2c changes c. 2.6.31.
    
    Earlier editions of this patch have been floating around the 'net for a
    while, including being patched into Fedora kernels, and they *do* work.
    This specific version isn't yet tested, beyond loading ir-kbd-i2c and
    confirming that it does bind to the RX address of the hdpvr.
    
    [mchehab@redhat.com: I2C_CLASS_TV_ANALOG is not defined. Fix compilation bug]
    Signed-off-by: Jarod Wilson <jarod@redhat.com>
    Acked-by: Andy Walls <awalls@md.metrocast.net>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>

commit 9e9bc9736756f25d6c47b4eba0ebf25b20a6f153
Merge: 3c0cb7c31c20 e3c92215198c
Author: Linus Torvalds <torvalds@linux-foundation.org>
Date:   Thu Jan 6 18:32:12 2011 -0800

    Merge branch 'v4l_for_linus' of git://git.kernel.org/pub/scm/linux/kernel/git/mchehab/linux-2.6
    
    * 'v4l_for_linus' of git://git.kernel.org/pub/scm/linux/kernel/git/mchehab/linux-2.6: (255 commits)
      [media] radio-aimslab.c: Fix gcc 4.5+ bug
      [media] cx25821: Fix compilation breakage due to BKL dependency
      [media] v4l2-compat-ioctl32: fix compile warning
      [media] zoran: fix compiler warning
      [media] tda18218: fix compile warning
      [media] ngene: fix compile warning
      [media] DVB: IR support for TechnoTrend CT-3650
      [media] cx23885, cimax2.c: Fix case of two CAM insertion irq
      [media] ir-nec-decoder: fix repeat key issue
      [media] staging: se401 depends on USB
      [media] staging: usbvideo/vicam depends on USB
      [media] soc_camera: Add the ability to bind regulators to soc_camedra devices
      [media] V4L2: Add a v4l2-subdev (soc-camera) driver for OmniVision OV2640 sensor
      [media] v4l: soc-camera: switch to .unlocked_ioctl
      [media] v4l: ov772x: simplify pointer dereference
      [media] ov9640: fix OmniVision OV9640 sensor driver's priv data retrieving
      [media] ov9640: use macro to request OmniVision OV9640 sensor private data
      [media] ivtv-i2c: Fix two warnings
      [media] staging/lirc: Update lirc TODO files
      [media] cx88: Remove the obsolete i2c_adapter.id field
      ...

commit 6a23a520c07ba556ea2317b1f72f3d2eb002f991
Author: Mauro Carvalho Chehab <mchehab@redhat.com>
Date:   Thu Dec 30 09:05:12 2010 -0300

    [media] cx88: Remove the obsolete i2c_adapter.id field
    
    Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>

commit d7c7235695ef9cbbdc20bdeb8554dbf10f576ca1
Author: Andy Walls <awalls@md.metrocast.net>
Date:   Tue Dec 28 22:49:50 2010 -0300

    [media] lirc_zilog: Remove use of deprecated struct i2c_adapter.id field
    
    Remove use of deprecated struct i2c_adapter.id field.  In the process,
    perform different detection of the HD PVR's Z8 IR microcontroller versus
    the other Hauppauge cards with the Z8 IR microcontroller.
    
    Also added a comment about probe() function behavior that needs to be
    fixed.
    
    Signed-off-by: Andy Walls <awalls@md.metrocast.net>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>

commit ea6c06033f01216df504b0f337a350778a3bc80e
Author: Andy Walls <awalls@md.metrocast.net>
Date:   Tue Dec 28 22:46:13 2010 -0300

    [media] hdpvr: Add I2C and ir-kdb-i2c registration of the Zilog Z8 IR chip
    
    Adds I2C registration of the Zilog Z8F0811 IR microcontroller for either
    lirc_zilog or ir-kbd-i2c to use.  This is a required step in removing
    lirc_zilog's use of the deprecated struct i2c_adapter.id field.
    
    Signed-off-by: Andy Walls <awalls@md.metrocast.net>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>

commit 20b4755e4fbb226eb42951bd40b53fcbce9ef944
Merge: 744f9f104ea2 e53beacd23d9
Author: Jeremy Fitzhardinge <jeremy.fitzhardinge@citrix.com>
Date:   Tue Nov 16 11:06:22 2010 -0800

    Merge commit 'v2.6.37-rc2' into upstream/xenfs
    
    * commit 'v2.6.37-rc2': (10093 commits)
      Linux 2.6.37-rc2
      capabilities/syslog: open code cap_syslog logic to fix build failure
      i2c: Sanity checks on adapter registration
      i2c: Mark i2c_adapter.id as deprecated
      i2c: Drivers shouldn't include <linux/i2c-id.h>
      i2c: Delete unused adapter IDs
      i2c: Remove obsolete cleanup for clientdata
      include/linux/kernel.h: Move logging bits to include/linux/printk.h
      Fix gcc 4.5.1 miscompiling drivers/char/i8k.c (again)
      hwmon: (w83795) Check for BEEP pin availability
      hwmon: (w83795) Clear intrusion alarm immediately
      hwmon: (w83795) Read the intrusion state properly
      hwmon: (w83795) Print the actual temperature channels as sources
      hwmon: (w83795) List all usable temperature sources
      hwmon: (w83795) Expose fan control method
      hwmon: (w83795) Fix fan control mode attributes
      hwmon: (lm95241) Check validity of input values
      hwmon: Change mail address of Hans J. Koch
      PCI: sysfs: fix printk warnings
      GFS2: Fix inode deallocation race
      ...

commit fe9d1159b299642f9e1a9b56bbf67a24c31bb418
Merge: e5c13537b015 2236baa75f70
Author: Linus Torvalds <torvalds@linux-foundation.org>
Date:   Mon Nov 15 14:03:17 2010 -0800

    Merge branch 'i2c-for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/jdelvare/staging
    
    * 'i2c-for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/jdelvare/staging:
      i2c: Sanity checks on adapter registration
      i2c: Mark i2c_adapter.id as deprecated
      i2c: Drivers shouldn't include <linux/i2c-id.h>
      i2c: Delete unused adapter IDs
      i2c: Remove obsolete cleanup for clientdata

commit e1e18ee1cb58228a577668284c1dd03d859d7157
Author: Jean Delvare <khali@linux-fr.org>
Date:   Mon Nov 15 22:40:38 2010 +0100

    i2c: Mark i2c_adapter.id as deprecated
    
    It's about time to make it clear that i2c_adapter.id is deprecated.
    Hopefully this will remind the last user to move over to a different
    strategy.
    
    Signed-off-by: Jean Delvare <khali@linux-fr.org>
    Acked-by: Jarod Wilson <jarod@redhat.com>
    Acked-by: Mauro Carvalho Chehab <mchehab@redhat.com>
    Acked-by: Hans Verkuil <hverkuil@xs4all.nl>

commit 69669455b049c0f1f04bb306625c5d4db6838b11
Author: Jean Delvare <khali@linux-fr.org>
Date:   Fri Nov 5 18:51:34 2010 +0100

    drm/i915: Fix I2C adapter registration
    
    Fix many small bugs in I2C adapter registration:
    * Properly reject unsupported GPIO pin.
    * Fix improper use of I2C_NAME_SIZE (which is the size of
      i2c_client.name, not i2c_adapter.name.)
    * Prefix adapter names with "i915" so that the user knows what the
      I2C channel is connected to.
    * Fix swapped characters in the string used to name the GPIO-based
      adapter.
    * Add missing comma in gmbus name table.
    
    Signed-off-by: Jean Delvare <khali@linux-fr.org>
    Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>

commit aa62f85d0c65712c24b4892e9eab929d5176cee2
Author: Alan Cox <alan@lxorguk.ukuu.org.uk>
Date:   Wed Oct 27 12:44:03 2010 +0100

    i2c-intel-mid: support for Moorestown and Medfield platform
    
    (Updated to address Ben's comments. With regard to the message segment
     restriction it's not something we hit on the actual platform so while
     I will investigate that further I don't think its a blocker to submission.
     At worst its a spot over-restrictive)
    
    From: Wen Wang <wen.w.wang@intel.com>
    
    Initial release of the driver. Updated and verified on hardware.
    
    Cleaned up as follows
    
    Alan Cox:
       Squash down the switches into tables, and use the PCI ident field. We
       could perhaps take this further and put the platform and port number into
       this.
       uint32t -> u32
       bracketing of case statements
       spacing and '!' usage
       Check the speed (which is now 0/1/2) is valid and ignore otherwise.
       Fix remaining problems/suggestions from Jean's review
       Fix items from Ben's review
    
    Arjan van de Ven:
       Initial power management hooks
    
    Yong Wang <youg.y.wang@intel.com>:
       Shared IRQ support
    
    Wen Wang <wen.w.wang@intel.com>:
       D3 support
       Fixes for OCT test runs
       Interrupt optimisations
    
    Hong Liu <hong.liu@intel.com>
       The runtime PM code is working on the wrong device (i2c_adapter->dev).
       The correct one should be pci_dev->dev. This breaks attached i2c
       slave devices with runtime PM enabled. Slave device needs to runtime
       resume parent device before runtime resuming itself, but we always get
       error since we don't have pm_runtime callback for i2c_adapter->dev.
    
    Bin Yang <bin.yang@intel.com>:
       Update speed table
    
    Saadi Maalem <saadi.maalem@intel.com>:
       Clear all interrupts in the hardware init
    
    Celine Chotard <celinex.chotard@intel.com>:
       Correct ordering of clear/disable of IRQs
    
    Signed-off-by: Wen Wang <wen.w.wang@intel.com>
    Signed-off-by: Yong Wang <yong.y.wang@intel.com>
    Signed-off-by: Hong Liu <hong.liu@intel.com>
    Signed-off-by: Bin Yang <bin.yang@intel.com>
    Signed-off-by: Arjan van de Ven <arjan@linux.intel.com>
    Signed-off-by: Alan Cox <alan@linux.intel.com>
    Signed-off-by: Ben Dooks <ben-linux@fluff.org>

commit bdaf12b41235b0c59949914de022341e77907461
Merge: 7c024e9534f9 bf5d95c82692
Author: Linus Torvalds <torvalds@linux-foundation.org>
Date:   Sun Oct 24 12:46:24 2010 -0700

    Merge branch 'i2c-for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/jdelvare/staging
    
    * 'i2c-for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/jdelvare/staging:
      i2c-viapro: Don't log nacks
      i2c/pca954x: Remove __devinit and __devexit from probe and remove functions
      MAINTAINERS: Add maintainer for PCA9541 I2C bus master selector driver
      i2c/mux: Driver for PCA9541 I2C Master Selector
      i2c: Optimize function i2c_detect()
      i2c: Discard warning message on device instantiation from user-space
      i2c-amd8111: Add proper error handling
      i2c: Change to new flag variable
      i2c: Remove unneeded inclusions of <linux/i2c-id.h>
      i2c: Let i2c_parent_is_i2c_adapter return the parent adapter
      i2c: Simplify i2c_parent_is_i2c_adapter
      i2c-pca-platform: Change device name of request_irq
      i2c: Fix Kconfig dependencies

commit 97cc4d49cfcda1c2dad89c00b62a25b628ce2115
Author: Jean Delvare <khali@linux-fr.org>
Date:   Sun Oct 24 18:16:57 2010 +0200

    i2c: Let i2c_parent_is_i2c_adapter return the parent adapter
    
    This makes the calling site's code clearer IMHO.
    
    Signed-off-by: Jean Delvare <khali@linux-fr.org>
    Acked-by: Michael Lawnick <ml.lawnick@gmx.de>

commit d582963a027fd63f8dfc97a0bf3654d4380e34ce
Author: Jean Delvare <khali@linux-fr.org>
Date:   Sun Oct 24 18:16:57 2010 +0200

    i2c: Simplify i2c_parent_is_i2c_adapter
    
    Only i2c devices can have their type set to i2c_adapter_type, so
    testing the bus type is redundant.
    
    Signed-off-by: Jean Delvare <khali@linux-fr.org>
    Cc: Michael Lawnick <ml.lawnick@gmx.de>

commit 7c6d87ac843bfbc5a7669736882a0e88c217a820
Merge: a0fe3cc5d36a ec66841e495b
Author: Linus Torvalds <torvalds@linux-foundation.org>
Date:   Thu May 20 13:34:17 2010 -0700

    Merge branch 'viafb-next' of git://git.lwn.net/linux-2.6
    
    * 'viafb-next' of git://git.lwn.net/linux-2.6: (35 commits)
      viafb: move some include files to include/linux
      viafb: Eliminate some global.h references
      viafb: get rid of i2c debug cruft
      viafb: fold via_io.h into via-core.h
      viafb: Fix initialization error paths
      viafb: Do not remove gpiochip under spinlock
      viafb: make procfs entries optional
      viafb: fix proc entry removal
      viafb: improve misc register handling
      viafb: replace inb/outb
      viafb: move some modesetting functions to a seperate file
      viafb: unify modesetting functions
      viafb: Reserve framebuffer memory for the upcoming camera driver
      viafb: Add a simple VX855 DMA engine driver
      viafb: Add a simple interrupt management infrastructure
      via: Rationalize vt1636 detection
      viafb: Introduce viafb_find_i2c_adapter()
      via: Do not attempt I/O on inactive I2C adapters
      viafb: Turn GPIO and i2c into proper platform devices
      viafb: Convert GPIO and i2c to the new indexed port ops
      ...

commit b8f7e5d846387e3bcda35f3809856cf085740a24
Author: Jonathan Corbet <corbet@lwn.net>
Date:   Fri Apr 23 08:56:55 2010 -0600

    viafb: Introduce viafb_find_i2c_adapter()
    
    The camera driver will need this to look up a specific adapter.
    
    Cc: ScottFang@viatech.com.cn
    Cc: JosephChan@via.com.tw
    Cc: Harald Welte <laforge@gnumonks.org>
    Acked-by: Florian Tobias Schandinat <FlorianSchandinat@gmx.de>
    Signed-off-by: Jonathan Corbet <corbet@lwn.net>

commit 277d32a36cba0b42c9c6836ff07f9b978566e95c
Author: Harald Welte <laforge@gnumonks.org>
Date:   Sat May 23 00:35:39 2009 +0800

    viafb: rework the I2C support in the VIA framebuffer driver
    
    This patch changes the way how the various I2C busses are used internally
    inside the viafb driver:  Previosuly, only a single i2c_adapter was created,
    even though two different hardware I2C busses are accessed: A structure member
    in a global variable was modified to indicate the bus to be used.
    
    Now, all existing hardware busses are registered with the i2c core, and the
    viafb_i2c_{read,write}byte[s]() function take the adapter number as function
    call parameter, rather than referring to the global structure member.
    
    [jc: even more painful merge with mainline changes ->2.6.34]
    [jc: painful merge with OLPC changes]
    
    Cc: Florian Tobias Schandinat <FlorianSchandinat@gmx.de>
    Cc: ScottFang@viatech.com.cn
    Cc: JosephChan@via.com.tw
    Signed-off-by: Harald Welte <HaraldWelte@viatech.com>
    Signed-off-by: Jonathan Corbet <corbet@lwn.net>

commit b5527a7766f0505dc72efe3cefe5e9dea826f611
Author: Jean Delvare <khali@linux-fr.org>
Date:   Tue Mar 2 12:23:42 2010 +0100

    i2c: Add SMBus alert support
    
    SMBus alert support. The SMBus alert protocol allows several SMBus
    slave devices to share a single interrupt pin on the SMBus master,
    while still allowing the master to know which slave triggered the
    interrupt.
    
    This is based on preliminary work by David Brownell. The key
    difference between David's implementation and mine is that his was
    part of i2c-core, while mine is split into a separate, standalone
    module named i2c-smbus. The i2c-smbus module is meant to include
    support for all SMBus extensions to the I2C protocol in the future.
    
    The benefit of this approach is a zero cost for I2C bus segments which
    do not need SMBus alert support. Where David's implementation
    increased the size of struct i2c_adapter by 7% (40 bytes on i386),
    mine doesn't touch it. Where David's implementation added over 150
    lines of code to i2c-core (+10%), mine doesn't touch it. The only
    change that touches all the users of the i2c subsystem is a new
    callback in struct i2c_driver (common to both implementations.) I seem
    to remember Trent was worried about the footprint of David'd
    implementation, hopefully mine addresses the issue.
    
    Signed-off-by: Jean Delvare <khali@linux-fr.org>
    Acked-by: Jonathan Cameron <jic23@cam.ac.uk>
    Cc: David Brownell <dbrownell@users.sourceforge.net>
    Cc: Trent Piepho <tpiepho@freescale.com>

commit 536004403d35b707bbac43d629586ee9c944084f
Author: Randy Dunlap <randy.dunlap@oracle.com>
Date:   Fri Feb 12 18:02:35 2010 -0300

    V4L/DVB: radio_timberdale: depends on I2c
    
    RADIO_TIMBERDALE selects RADIO_SAA7706H, but RADIO_SAA7706H
    depends on I2C, so make RADIO_TIMBERDALE depend on I2C also;
    otherwise there are build errors:
    
    drivers/media/radio/saa7706h.c:139: error: implicit declaration of function 'i2c_master_send'
    drivers/media/radio/saa7706h.c:148: error: implicit declaration of function 'i2c_transfer'
    drivers/media/radio/saa7706h.c:372: error: implicit declaration of function 'i2c_check_functionality'
    drivers/media/radio/saa7706h.c:375: error: implicit declaration of function 'i2c_adapter_id'
    drivers/media/radio/saa7706h.c:438: error: implicit declaration of function 'i2c_add_driver'
    drivers/media/radio/saa7706h.c:443: error: implicit declaration of function 'i2c_del_driver'
    
    Signed-off-by: Randy Dunlap <randy.dunlap@oracle.com>
    Cc: Mocean Laboratories <info@mocean-labs.com>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>

commit 9d7f73632c87ef1b6187eb539d1efd63c3cf0e36
Author: Russell King <rmk+kernel@arm.linux.org.uk>
Date:   Sat Nov 21 12:25:27 2009 +0000

    ARM: PNX4008: move i2c_adapter structure inside the drivers private data
    
    Signed-off-by: Russell King <rmk+kernel@arm.linux.org.uk>

commit e77cf23251e7f55335d986ee0a6d2c0084889dee
Author: Shinya Kuribayashi <shinya.kuribayashi@necel.com>
Date:   Fri Nov 6 21:46:04 2009 +0900

    i2c-designware: i2c_dw_xfer_msg: Use "struct dw_i2c_dev" pointer
    
    We don't have to use "struct i2c_adapter" pointer here.
    Let's use a local "struct dw_i2c_dev" pointer, instead.
    
    Signed-off-by: Shinya Kuribayashi <shinya.kuribayashi@necel.com>
    Acked-by: Baruch Siach <baruch@tkos.co.il>
    Signed-off-by: Ben Dooks <ben-linux@fluff.org>

commit 78839bd0f22c3b6e7273568e042bf4d637cfedb3
Author: Shinya Kuribayashi <shinya.kuribayashi@necel.com>
Date:   Fri Nov 6 21:45:39 2009 +0900

    i2c-designware: i2c_dw_read: Use "struct dw_i2c_dev" pointer
    
    We don't have to use "struct i2c_adapter" pointer here.
    Let's use a local "struct dw_i2c_dev" pointer, instead.
    
    Signed-off-by: Shinya Kuribayashi <shinya.kuribayashi@necel.com>
    Acked-by: Baruch Siach <baruch@tkos.co.il>
    Signed-off-by: Ben Dooks <ben-linux@fluff.org>

commit 41440ffe21f29bdb985cab76b2d0b06d83e63b19
Merge: dad3de7d0090 6471b68982d3
Author: Linus Torvalds <torvalds@linux-foundation.org>
Date:   Tue Dec 8 08:12:16 2009 -0800

    Merge branch 'i2c-for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/jdelvare/staging
    
    * 'i2c-for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/jdelvare/staging:
      i2c-stub: Documentation update
      i2c-stub: Allow user to disable some commands
      i2c-stub: Implement I2C block support
      i2c: Refactor for_each callbacks
      i2c-i801: Retry on lost arbitration
      i2c: Remove big kernel lock from i2cdev_open
      ics932s401: Clean up detect function
      i2c: Simplify i2c_detect_address
      i2c: Drop probe, ignore and force module parameters
      i2c: Add missing __devinit markers to old i2c adapter drivers
      i2c: Bus drivers don't have to support I2C_M_REV_DIR_ADDR
      i2c: Prevent priority inversion on top of bus lock
      i2c-voodoo3: Delete
      i2c-powermac: Drop temporary name buffer
      i2c-powermac: Include the i2c_adapter in struct pmac_i2c_bus
      i2c-powermac: Log errors
      i2c-powermac: Refactor i2c_powermac_smbus_xfer
      i2c-powermac: Reject unsupported I2C transactions
      i2c/chips: Move ds1682 to drivers/misc

commit bc6286e50b4a34d8af52132d6e22f85c6c8853a7
Author: Jean Delvare <khali@linux-fr.org>
Date:   Sun Dec 6 17:06:20 2009 +0100

    i2c-powermac: Drop temporary name buffer
    
    We no longer need to write the adapter name to a temporary buffer.
    We can write it directly to the i2c_adapter's name field. This is
    more efficient.
    
    Signed-off-by: Jean Delvare <khali@linux-fr.org>
    Tested-by: Michel Daenzer <michel@daenzer.net>
    Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org>

commit 6dfa5ca3c9a35cb395ab1f51e0e500106c85dff4
Author: Jean Delvare <khali@linux-fr.org>
Date:   Sun Dec 6 17:06:19 2009 +0100

    i2c-powermac: Include the i2c_adapter in struct pmac_i2c_bus
    
    Include the i2c_adapter in struct pmac_i2c_bus. This avoids memory
    fragmentation and allows for several code cleanups.
    
    Signed-off-by: Jean Delvare <khali@linux-fr.org>
    Tested-by: Michel Daenzer <michel@daenzer.net>
    Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org>

commit 54bb501c069bbe34cf8becf0a9985fc6873d6b21
Author: Hans Verkuil <hverkuil@xs4all.nl>
Date:   Sat Jun 20 09:18:34 2009 -0300

    V4L/DVB (12111): tcm825x: remove incorrect __exit_p wrapper
    
    tcm825x_remove is not necessarily called on module exit, it can also be
    called when the i2c_adapter is removed. While the i2c adapter might never
    be removed on an embedded system, in practice this sensor driver can also
    be used in e.g. a USB webcam where this is a perfectly acceptable thing
    to do.
    
    Signed-off-by: Hans Verkuil <hverkuil@xs4all.nl>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>

commit f9c10a9b96a31b4a82a4fa807400c04f00284068
Author: Keith Packard <keithp@keithp.com>
Date:   Sat May 30 12:16:25 2009 -0700

    drm/i915: Change I2C api to pass around i2c_adapters
    
    The existing API passed around intel_i2c_chan pointers, which are dependent
    on the i2c bit-banging algo. This precluded the driver from using outputs
    which use a different algo. Switching to the more general i2c_adpater allows
    the driver to support non bit-banging DDC.
    
    This also required moving the slave address into the output private
    structures.
    
    Signed-off-by: Keith Packard <keithp@keithp.com>

commit a357482a1e8fdd39f0a58c33ed2ffd0f1becb825
Author: Guennadi Liakhovetski <g.liakhovetski@gmx.de>
Date:   Tue Apr 21 04:22:38 2009 -0300

    V4L/DVB (11561a): move media after i2c
    
    Currently drivers/media drivers are linked very early - directly after
    base, block, misc, and mfd and before ata, scsi, ide, input, firewire,
    usb, and i2c. This breaks static build of video4linux drivers, that use
    generic CPU i2c adapter drivers and the v4l2-subdev subsystem, because
    during video4linux probing the v4l2-subdev core requires a struct
    i2c_adapter context, which cannot be satisfied before the i2c subsystem is
    initialised. Moving drivers/media after drivers/i2c fixes this problem.
    
    The best way to trigger action is by submitting a patch:-) So, let's see
    what comes out of it - on the one hand I don't see any reason why media
    has to be linked this early, and nobody was able to give me one yesterday
    as this problem has been discussed on linux-media, OTOH, maybe indeed it
    would be better to move i2c the whole way up above media, but that'd be
    much bigger of a change, I think.
    --
    To unsubscribe from this list: send the line "unsubscribe linux-media" in
    the body of a message to majordomo@vger.kernel.org
    More majordomo info at  http://vger.kernel.org/majordomo-info.html
    
    Signed-off-by: Guennadi Liakhovetski <g.liakhovetski@gmx.de>
    Acked-by: Jean Delvare <khali@linux-fr.org>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>

commit e3ee703366da3a4ce80f24b47a5df56cd816c5d6
Author: Jean Delvare <khali@linux-fr.org>
Date:   Mon Apr 6 18:12:24 2009 +0200

    i2c: Deprecate client_register and client_unregister methods
    
    The new i2c binding model makes the client_register and
    client_unregister methods of struct i2c_adapter useless, so we can
    remove them with the rest of the legacy model.
    
    Signed-off-by: Jean Delvare <khali@linux-fr.org>

commit 8a52c6b4d55b2960d93a90a7cf6afd252357fa54
Author: Jean Delvare <khali@linux-fr.org>
Date:   Sat Mar 28 21:34:43 2009 +0100

    i2c: Adapter timeout is in jiffies
    
    i2c_adapter.timeout is in jiffies. Fix all drivers which thought
    otherwise. It didn't really matter as long as the value was only used
    inside the driver, but soon i2c-core will use it too so it must have
    the proper unit.
    
    Note: for the i2c-mpc driver, this fixes a bug in polling mode.
    Timeout would trigger after 1 jiffy, which is most probably not what
    the author wanted.
    
    Signed-off-by: Jean Delvare <khali@linux-fr.org>
    Cc: Clifford Wolf <clifford@clifford.at>
    Acked-by: Sean MacLennan <smaclennan@pikatech.com>
    Cc: Stefan Roese <sr@denx.de>
    Acked-by: Lennert Buytenhek <kernel@wantstofly.org>
    Cc: Dan Williams <dan.j.williams@intel.com>
    Cc: Grant Likely <grant.likely@secretlab.ca>
    Acked-by: Mark A. Greer <mgreer@mvista.com>

commit 082a4cf80966ebcd08bf775cd258171cdd85c1a1
Author: Jean Delvare <khali@linux-fr.org>
Date:   Tue Feb 24 19:19:49 2009 +0100

    i2c: Make sure i2c_algo_bit_data.timeout is HZ-independent
    
    i2c_algo_bit_data.timeout is supposed to be in jiffies, so drivers
    should use set this value in terms of HZ.
    
    Ultimately I think this field should be discarded in favor of
    i2c_adapter.timeout, but that's left for a future patch.
    
    Signed-off-by: Jean Delvare <khali@linux-fr.org>
    Acked-by: Russell King <rmk+kernel@arm.linux.org.uk>
    Acked-by: Lennert Buytenhek <kernel@wantstofly.org>
    Acked-by: Len Sorensen <lsorense@csclub.uwaterloo.ca>

commit feeedc6c820e1026453ad865076cee435f24d30a
Merge: a27028349ccb 11f1f2afd6b0
Author: Linus Torvalds <torvalds@linux-foundation.org>
Date:   Thu Oct 23 10:10:25 2008 -0700

    Merge branch 'i2c-for-linus' of git://jdelvare.pck.nerim.net/jdelvare-2.6
    
    * 'i2c-for-linus' of git://jdelvare.pck.nerim.net/jdelvare-2.6:
      i2c: Add info->archdata field
      i2c: Inform about deprecated chips directory
      i2c: Use pci_ioremap_bar()
      Schedule removal of the legacy i2c device driver binding model
      i2c: Clean up <linux/i2c.h>
      i2c: Update and clean up writing-clients document
      i2c: Drop 2-byte address block transfer defines
      i2c: Delete legacy model documentation
      i2c: Constify i2c_get_clientdata's parameter
      i2c: Delete outdated client porting guide
      i2c: Make clear what the class field of i2c_adapter is good for
      i2c-algo-pcf: Fix typo in debugging log message
      i2c-algo-pcf: Add adapter hooks around xfer begin and end
      i2c-algo-pcf: Pass adapter data into ->waitforpin() method
      i2c-i801: Add support for Intel Ibex Peak

commit 14f55f7a033f86a4e8f0310dd4d54b5464322e6e
Author: Wolfram Sang <w.sang@pengutronix.de>
Date:   Wed Oct 22 20:21:30 2008 +0200

    i2c: Make clear what the class field of i2c_adapter is good for
    
    Make clear what the class field of i2c_adapter is good for.
    
    Signed-off-by: Wolfram Sang <w.sang@pengutronix.de>
    Signed-off-by: Jean Delvare <khali@linux-fr.org>

commit 30650961907368b1077cade35455fe931b14da6b
Author: Michael Krufky <mkrufky@linuxtv.org>
Date:   Sat Sep 6 14:56:58 2008 -0300

    V4L/DVB (8951): xc5000: dont pass devptr in xc5000_attach()
    
    Dont pass devptr in xc5000_attach, dont store it in xc5000_priv.
    This pointer is passed into the tuner_callback function, which always
    expects a pointer to fe->dvb->priv or i2c_adapter->algo_data.
    
    This prevents future possible bugs in new drivers, such as using a "devptr"
    other that the standard fe->dvb->priv in a DVB driver.
    
    Signed-off-by: Michael Krufky <mkrufky@linuxtv.org>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>

commit a2dc86b69dcbcbeb498c5f5169f09f4bd207de5f
Author: Michael Krufky <mkrufky@linuxtv.org>
Date:   Sat Aug 9 13:06:26 2008 -0300

    V4L/DVB (8655): cxusb: fix checkpatch warnings & errors
    
    Fix the following checkpatch.pl errors and warnings:
    
    ERROR: do not use assignment in if condition
    117: FILE: linux/drivers/media/dvb/dvb-usb/cxusb.c:819:
    +       if ((adap->fe = dvb_attach(dib7000p_attach,
    
    ERROR: switch and case should be at the same indent
    155: FILE: linux/drivers/media/dvb/dvb-usb/cxusb.c:857:
    +       switch (band) {
    +               case BAND_VHF: offset = 950; break;
    +               case BAND_UHF:
    +               default: offset = 550; break;
    
    WARNING: line over 80 characters
    169: FILE: linux/drivers/media/dvb/dvb-usb/cxusb.c:871:
    +       struct i2c_adapter *tun_i2c = dib7000p_get_i2c_master(adap->fe, DIBX000_I2C_INTERFACE_TUNER, 1);
    
    WARNING: line over 80 characters
    213: FILE: linux/drivers/media/dvb/dvb-usb/cxusb.c:1342:
    +static struct dvb_usb_device_properties cxusb_bluebird_dualdig4_rev2_properties = {
    
    WARNING: line over 80 characters
    226: FILE: linux/drivers/media/dvb/dvb-usb/cxusb.c:1355:
    +                       .size_of_priv     = sizeof(struct dib0700_adapter_state),
    
    total: 2 errors, 3 warnings, 266 lines checked
    
    Signed-off-by: Michael Krufky <mkrufky@linuxtv.org>
    Cc: Anton Blanchard <anton@samba.org>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>

commit 618b26d52843c0f85b8eb143cf2695d7f6fd072d
Author: Wolfgang Grandegger <wg@grandegger.com>
Date:   Wed Oct 8 11:36:42 2008 -0600

    i2c-mpc: suppress I2C device probing
    
    This patch suppresses I2C device probing by clearing the class field
    of the "struct i2c_adapter" for the MPC I2C bus adapters. Some board
    configurations which rely on probing must be fixed up by adding a
    proper I2C device node to the DTS file, like the TQM85xx modules.
    
    Signed-off-by: Wolfgang Grandegger <wg@grandegger.com>
    Signed-off-by: Grant Likely <grant.likely@secretlab.ca>

commit 1d434012f23effdc69d58a88229159b57256f6ba
Author: Jean Delvare <khali@linux-fr.org>
Date:   Wed Sep 3 17:12:23 2008 -0300

    V4L/DVB (8837): dvb: fix I2C adapters name size
    
    Some DVB drivers are incorrectly assuming that the size of
    i2c_adapter.name is I2C_NAME_SIZE.  Here's a fix.
    
    Also change strncpy to strlcpy, as the former is error-prone (and was
    indeed incorrectly used.)
    
    Signed-off-by: Jean Delvare <khali@linux-fr.org>
    Acked-by: Uwe Bugla <uwe.bugla@gmx.de>
    Reviewed-by: Michael Krufky <mkrufky@linuxtv.org>
    Signed-off-by: Steven Toth <stoth@hauppauge.com>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>

commit bd4bc3dbded9cd7b2bdca6bba1aecb4251a8039d
Author: Jean Delvare <khali@linux-fr.org>
Date:   Wed Jul 16 19:30:05 2008 +0200

    i2c: Clear i2c_adapter.dev on adapter removal
    
    Clear i2c_adapter.dev on adapter removal. This makes it possible to
    re-add the adapter at a later point, which some drivers
    (i2c-amd756-s4882, i2c-nforce2-s4985) actually do.
    
    This fixes a bug reported by John Stultz here:
      http://lkml.org/lkml/2008/7/15/720
    and by Ingo Molar there:
      http://lkml.org/lkml/2008/7/16/78
    
    Signed-off-by: Jean Delvare <khali@linux-fr.org>
    Cc: John Stultz <johnstul@us.ibm.com>
    Cc: Ingo Molnar <mingo@elte.hu>

commit 4735c98f8447acb1c8977e2b8024640f7bf36dd6
Author: Jean Delvare <khali@linux-fr.org>
Date:   Mon Jul 14 22:38:36 2008 +0200

    i2c: Add detection capability to new-style drivers
    
    Add a mechanism to let new-style i2c drivers optionally autodetect
    devices they would support on selected buses and ask i2c-core to
    instantiate them. This is a replacement for legacy i2c drivers, much
    cleaner.
    
    Where drivers had to implement both a legacy i2c_driver and a
    new-style i2c_driver so far, this mechanism makes it possible to get
    rid of the legacy i2c_driver and implement both enumerated and
    detected device support with just one (new-style) i2c_driver.
    
    Here is a quick conversion guide for these drivers, step by step:
    
    * Delete the legacy driver definition, registration and removal.
      Delete the attach_adapter and detach_client methods of the legacy
      driver.
    
    * Change the prototype of the legacy detect function from
        static int foo_detect(struct i2c_adapter *adapter, int address, int kind);
      to
        static int foo_detect(struct i2c_client *client, int kind,
                              struct i2c_board_info *info);
    
    * Set the new-style driver detect callback to this new function, and
      set its address_data to &addr_data (addr_data is generally provided
      by I2C_CLIENT_INSMOD.)
    
    * Add the appropriate class to the new-style driver. This is
      typically the class the legacy attach_adapter method was checking
      for. Class checking is now mandatory (done by i2c-core.) See
      <linux/i2c.h> for the list of available classes.
    
    * Remove the i2c_client allocation and freeing from the detect
      function. A pre-allocated client is now handed to you by i2c-core,
      and is freed automatically.
    
    * Make the detect function fill the type field of the i2c_board_info
      structure it was passed as a parameter, and return 0, on success. If
      the detection fails, return -ENODEV.
    
    Signed-off-by: Jean Delvare <khali@linux-fr.org>

commit ab6c46e24a3c89c1e2d0d3959e119583e1bc92d9
Author: Michael Krufky <mkrufky@linuxtv.org>
Date:   Tue Apr 22 14:42:05 2008 -0300

    V4L/DVB (7184): make hybrid_tuner_request_state tolerant of devices without i2c adapters
    
    Some dvb demodulators access the tuner directly without using i2c.
    In these cases, i2c_adap may be NULL.  This patch fixes
    hybrid_tuner_request_state to allow for NULL i2c_adapters.
    
    Signed-off-by: Michael Krufky <mkrufky@linuxtv.org>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@infradead.org>

commit c9a2c46d7f32a884510b20f0cfa79a2c6a2f1413
Author: Jean Delvare <khali@linux-fr.org>
Date:   Sun Feb 24 20:03:41 2008 +0100

    ARM: OMAP: Release i2c_adapter after use (Siemens SX1)
    
    Each call to i2c_get_adapter() must be followed by a call to
    i2c_put_adapter() to release the grabbed reference. Otherwise the
    reference count grows forever and the adapter can never be
    unregistered.
    
    Signed-off-by: Jean Delvare <khali@linux-fr.org>
    Acked-by: Vladimir Ananiev <vovan888@gmail.com>
    Acked-by: Tony Lindgren <tony@atomide.com>

commit c00d4ffdbace1bdc9fdd888e4ba6d207ffa3b679
Merge: d0d42df2a440 8f86dda3ed8f
Author: Russell King <rmk@dyn-67.arm.linux.org.uk>
Date:   Mon Jan 28 13:21:30 2008 +0000

    Merge branch 'orion' into devel
    
    * orion: (26 commits)
      [ARM] Orion: implement power-off method for QNAP TS-109/209
      [ARM] Orion: add support for QNAP TS-109/TS-209
      [ARM] Orion: I2C support
      [I2C] i2c-mv64xxx: Don't set i2c_adapter.retries
      [I2C] Split mv643xx I2C platform support
      [ARM] Orion: enable CONFIG_RTC_DRV_M41T80 for D-Link DNS-323
      [ARM] Orion defconfig
      [ARM] Orion: add support for Orion/MV88F5181 based D-Link DNS-323
      [ARM] Orion: MV88F5181 support bits
      [ARM] Orion: Buffalo/Revogear Kurobox Pro support
      [ARM] OrionNAS RD board support
      [ARM] Orion: support for Marvell Orion-2 (88F5281) Development Board
      [ARM] Orion: common platform setup for Gigabit Ethernet port
      [ARM] Orion: platform device registration for UART, USB and NAND
      [ARM] Orion: system timer support
      [ARM] Orion edge GPIO IRQ support
      [ARM] Orion: IRQ support
      [ARM] Orion: provide GPIO method for enabling hardware assisted blinking
      [ARM] Orion: GPIO support
      [ARM] Orion: programable address map support
      ...
    
    Conflicts:
    
            arch/arm/Kconfig
            arch/arm/Makefile
    
    Signed-off-by: Russell King <rmk+kernel@arm.linux.org.uk>

commit 86ec5ec872566dda74848e09904bb5380cab962e
Author: David Brownell <david-b@pacbell.net>
Date:   Sun Jan 27 18:14:51 2008 +0100

    i2c-remove-redundant-i2c_client-list.patch
    
    This goes on top of the patch removing most i2c_adapter.clients usage,
    updating i2c_attach_client:
    
     - Don't call device_register() while holding clist_lock.  This
       removes a self-deadlock when on the i2c_driver.probe() path,
       for drivers that need to attach new devices (e.g. dummies).
    
     - Remove a redundant address check.  The driver model core does
       this as a consequence of guaranteeing unique names.
    
     - Move the "device registered" diagnostic so that it never lies;
       previously, on error paths it would falsely report success.
    
    Signed-off-by: David Brownell <dbrownell@users.sourceforge.net>
    Signed-off-by: Jean Delvare <khali@linux-fr.org>

commit 9b766b814d6a5f31ca1e9da1ebc08164b9352941
Author: David Brownell <david-b@pacbell.net>
Date:   Sun Jan 27 18:14:51 2008 +0100

    i2c: Stop using the redundant client list
    
    The i2c_adapter.clients list of i2c_client nodes duplicates driver
    model state.  This patch starts removing that list, letting us remove
    most existing users of those i2c-core lists.
    
     * The core I2C code now iterates over the driver model's list instead
       of the i2c-internal one in some places where it's safe:
          - Passing a command/ioctl to each client, a mechanims
            used almost exclusively by DVB adapters;
          - Device address checking, in both i2c-core and i2c-dev.
    
     * Provide i2c_verify_client() to use with driver model iterators.
    
     * Flag the relevant i2c_adapter and i2c_client fields as deprecated,
       to help prevent new users from appearing.
    
    For the moment the list needs to stick around, since some issues show
    up when deleting devices created by legacy I2C drivers.  (They don't
    follow standard driver model rules.  Removing those devices can cause
    self-deadlocks.)
    
    Signed-off-by: David Brownell <dbrownell@users.sourceforge.net>
    Signed-off-by: Jean Delvare <khali@linux-fr.org>

commit 87c6c22945e5d68eb96dd1e5cb26185253cd5b9d
Author: Jean Delvare <khali@linux-fr.org>
Date:   Sun Jan 27 18:14:48 2008 +0100

    i2c: Drop redundant i2c_adapter.list
    
    i2c_adapter.list is superfluous, this list duplicates the one
    maintained by the driver core. Drop it.
    
    Signed-off-by: Jean Delvare <khali@linux-fr.org>
    Acked-by: David Brownell <dbrownell@users.sourceforge.net>

commit 2caeac810423556a5ee787d5cb7aa902fda13bb4
Author: Jean Delvare <khali@linux-fr.org>
Date:   Sun Jan 27 18:14:47 2008 +0100

    i2c: Don't uselessly set i2c_adapter.retries
    
    I2C adapter drivers are supposed to handle retries on nack by themselves
    if they do, so there's no point in setting .retries if they don't.
    
    As this retry mechanism is going away (at least in its current form),
    clean this up now so that we don't get build failures later.
    
    Signed-off-by: Jean Delvare <khali@linux-fr.org>

commit 2f0a8df40ff008822e5570b3323c56622cd92c95
Author: Jean Delvare <khali@linux-fr.org>
Date:   Thu Nov 22 16:58:08 2007 +0100

    [I2C] i2c-mv64xxx: Don't set i2c_adapter.retries
    
    I2C adapter drivers are supposed to handle retries on nack by themselves
    if they do, so there's no point in setting .retries if they don't.
    
    As this retry mechanism is going away (at least in its current form),
    clean this up now so that we don't get build failures later.
    
    Signed-off-by: Jean Delvare <khali@linux-fr.org>
    Acked-by: Mark A. Greer <mgreer@mvista.com>

commit 907135aaa0cc120a347222c8f274ecc5ca0db641
Author: David Brownell <david-b@pacbell.net>
Date:   Thu Nov 15 19:24:01 2007 +0100

    i2c-dev: "how does it work" comments
    
    This adds some "how does this work" comments to the i2c-dev driver,
    plus separators between the three main components:
    
      - The parallel list of i2c_adapters ("i2c_dev_list"), each of which
        gets a "struct i2c_dev" and a /dev/i2c-X character special file.
    
      - An i2cdev_driver gets adapter add/remove notifications, which are
        used to maintain that list of adapters.
    
      - Special file operations, which let userspace talk either directly to
        the adapter (for i2c_msg operations) or through cached addressing info
        using an anonymous i2c_client (never registered anywhere).
    
    Plus there's the usual module load/unload record keeping.
    
    After making sense of this code, I think that the anonymous i2c_client
    is pretty shady.  But since it's never registered, using this code with
    a system set up for "new style" I2C drivers is no more complicated than
    always using the I2C_SLAVE_FORCE ioctl (instead of I2C_SLAVE).
    
    Signed-off-by: David Brownell <dbrownell@users.sourceforge.net>
    Signed-off-by: Jean Delvare <khali@linux-fr.org>

commit 745647e7a2ae399f7f70aca47827e62c99c893b5
Author: Jean Delvare <khali@linux-fr.org>
Date:   Sat Sep 8 14:09:19 2007 +0200

    ieee1394: pcilynx: I2C cleanups
    
    * Delete optional and empty i2c client_register and client_unregister
      callbacks.
    * Use the proper i2c adapter ID.
    * Don't use a template to initialize the i2c_adapter structure, it's
      inefficient.
    * Update a misleading comment on why we use i2c_transfer rather than
      higher level i2c functions.
    
    Signed-off-by: Jean Delvare <khali@linux-fr.org>
    Signed-off-by: Stefan Richter <stefanr@s5r6.in-berlin.de>

commit db8a695658cda21eacfa2a5e3b15e8964bfb93ef
Author: Michael Krufky <mkrufky@linuxtv.org>
Date:   Tue Aug 21 01:24:42 2007 -0300

    V4L/DVB (6127): tuner: kill i2c_client interface to tuner sub-drivers
    
    To ease the conversion of the analog tuner sub-drivers into dvb_frontend
    style tuner modules, we must remove the i2c_client interface.
    
    dvb_frontend style tuner modules use i2c_transfer directly on the i2c_adapter.
    
    This change only alters the interface between tuner.ko and the tuner
    sub-drivers. The v4l2 / i2c_client interface to tuner.ko remains intact.
    
    This patch adds inline functions tuner_i2c_xfer_send, and tuner_i2c_xfer_recv,
    to replace i2c_master_send and i2c_master_recv inside the tuner sub-drivers.
    
    Signed-off-by: Michael Krufky <mkrufky@linuxtv.org>
    Acked-by: Hans Verkuil <hverkuil@xs4all.nl>
    Acked-by: Mike Isely <isely@pobox.com>
    Acked-by: Steven Toth <stoth@hauppauge.com>
    Acked-by: Patrick Boettcher <pb@linuxtv.org>
    Acked-by: Jarod Wilson <jwilson@redhat.com>
    Acked-by: Trent Piepho <xyzzy@speakeasy.org>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@infradead.org>

commit da6752964290567a6b4ea180d1becda75e810e87
Author: David Brownell <david-b@pacbell.net>
Date:   Tue May 8 00:27:42 2007 -0700

    layered parport code uses parport->dev
    
    Update some of the layered parport_driver code to use parport->dev:
    
            - i2c-parport (parent of i2c_adapter)
            - spi_butterfly (parent of spi_master, allowing cruft removal)
            - lp (creating class_device)
            - ppdev (parent of parportN device)
            - tipar (creating class_device)
    
    There are still drivers that should be updated, like some of the input
    drivers; but they won't be any worse off than they are today.
    
    Signed-off-by: David Brownell <dbrownell@users.sourceforge.net>
    Cc: Greg KH <greg@kroah.com>
    Cc: Jean Delvare <khali@linux-fr.org>
    Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
    Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

commit 9c1600eda42e52796f49b36cf15b9debcfd09bea
Author: David Brownell <david-b@pacbell.net>
Date:   Tue May 1 23:26:31 2007 +0200

    i2c: Add i2c_board_info and i2c_new_device()
    
    This provides partial support for new-style I2C driver binding.  It builds
    on "struct i2c_board_info" declarations that identify I2C devices on a given
    board.  This is needed on systems with I2C devices that can't be fully probed
    and/or autoconfigured, such as many embedded Linux configurations where the
    way a given I2C device is wired may affect how it must be used.
    
    There are two models for declaring such devices:
    
     * LATE -- using a public function i2c_new_device().  This lets modules
       declare I2C devices found *AFTER* a given I2C adapter becomes available.
    
       For example, a PCI card could create adapters giving access to utility
       chips on that card, and this would be used to associate those chips with
       those adapters.
    
     * EARLY -- from arch_initcall() level code, using a non-exported function
       i2c_register_board_info().  This copies the declarations *BEFORE* such
       an i2c_adapter becomes available, arranging that i2c_new_device() will
       be called later when i2c-core registers the relevant i2c_adapter.
    
       For example, arch/.../.../board-*.c files would declare the I2C devices
       along with their platform data, and I2C devices would behave much like
       PNPACPI devices.  (That is, both enumerate from board-specific tables.)
    
    To match the exported i2c_new_device(), the previously-private function
    i2c_unregister_device() is now exported.
    
    Pending later patches using these new APIs, this is effectively a NOP.
    
    Signed-off-by: David Brownell <dbrownell@users.sourceforge.net>
    Signed-off-by: Jean Delvare <khali@linux-fr.org>

commit cacf2269b6cde2ff2c29a13dff5ce6886ff1dc73
Author: Jean Delvare <khali@linux-fr.org>
Date:   Tue May 1 23:26:29 2007 +0200

    i2c-parport: Optimize binary size
    
    Initialize the fields of the i2c_adapter structure individually,
    rather than copying a whole static template structure. This shaves
    off 474 bytes or 14% (on i386) from the binary size.
    
    Signed-off-by: Jean Delvare <khali@linux-fr.org>

commit ef2c8321f5a27ff9ecdae1ee587430cafa495586
Author: David Brownell <david-b@pacbell.net>
Date:   Tue May 1 23:26:28 2007 +0200

    i2c: Rename dev_to_i2c_adapter()
    
    Rename dev_to_i2c_adapter() as to_i2c_adapter(), since the previous
    syntax was a surprising and needless difference from normal naming
    conventions in Linux.
    
    Signed-off-by: David Brownell <dbrownell@users.sourceforge.net>
    Signed-off-by: Jean Delvare <khali@linux-fr.org>

commit 16ffadfc680bd0683dc88573c1d72cbf1e27030e
Author: David Brownell <david-b@pacbell.net>
Date:   Tue May 1 23:26:28 2007 +0200

    i2c: Class attribute cleanup
    
    This patch is a minor cleanup/code shrink, using class infrastructure
    in i2c-core to manage the i2c_adapter attribute.
    
    Signed-off-by: David Brownell <dbrownell@users.sourceforge.net>
    Signed-off-by: Jean Delvare <khali@linux-fr.org>

commit 2096b956d24c4b5950b808fc23b218425d79ebb1
Author: David Brownell <david-b@pacbell.net>
Date:   Tue May 1 23:26:28 2007 +0200

    i2c: Shrink struct i2c_client
    
    This shrinks the size of "struct i2c_client" by 40 bytes:
    
     - Substantially shrinks the string used to identify the chip type
     - The "flags" don't need to be so big
     - Removes some internal padding
    
    It also adds kerneldoc for that struct, explaining how "name" is really a
    chip type identifier; it's otherwise potentially confusing.
    
    Because the I2C_NAME_SIZE symbol was abused for both i2c_client.name
    and for i2c_adapter.name, this needed to affect i2c_adapter too.  The
    adapters which used that symbol now use the more-obviously-correct
    idiom of taking the size of that field.
    
    JD: Shorten i2c_adapter.name from 50 to 48 bytes while we're here, to
    avoid wasting space in padding.
    
    Signed-off-by: David Brownell <dbrownell@users.sourceforge.net>
    Signed-off-by: Jean Delvare <khali@linux-fr.org>

commit b31366f4394f7b1e8e1726ba049f294934db4495
Author: Jean Delvare <khali@linux-fr.org>
Date:   Tue May 1 23:26:28 2007 +0200

    i2c: i2c_adapter devices need no driver
    
    Kill i2c_adapter_driver as it doesn't make sense and it prevents
    further i2c-core cleanups. i2c_adapter devices are virtual devices
    (ex-class devices) and as such they don't need a driver.
    
    Signed-off-by: Jean Delvare <khali@linux-fr.org>

commit fccb56e4d82132ac15359efc9e419371e4533437
Author: Jean Delvare <khali@linux-fr.org>
Date:   Tue May 1 23:26:27 2007 +0200

    i2c: Kill i2c_adapter.class_dev
    
    Kill i2c_adapter.class_dev. Instead, set the class of i2c_adapter.dev
    to i2c_adapter_class, so that a symlink will be created for every
    i2c_adapter in /sys/class/i2c-adapter.
    
    The same change must be mirrored to i2c-isa as it duplicates some
    of the i2c-core functionalities.
    
    User-space tools and libraries might need some adjustments. In
    particular, libsensors from lm_sensors 2.10.3 or later is required for
    proper discovery of i2c adapter names after this change.
    
    Signed-off-by: Jean Delvare <khali@linux-fr.org>

commit a79220b7633b3926a9bd3527bdac3f04dbe6845c
Author: Matej Kenda <matej.kenda@hermes-softlab.com>
Date:   Mon Mar 5 13:06:40 2007 +0100

    [ARM] 4246/1: i2c-pxa: add adapter class to platform specific data
    
    Reposted patch for kernel 2.6.21-rc2.
    
    The driver i2c-pxa doesn't set the class member in i2c_adapter, which
    is used to register the I2C adapter. The hwmon (sensors) drivers (e.g.
    adm1021) that are connected to a i2c-pxa adapter don't attach because
    they expect that the adapter supports class I2C_CLASS_HWMON.
    
    This patch adds functionality to allow platforms to set the class and
    pass it as platform_data to the i2c-pxa driver. Sample usage in
    platform code:
    
    static struct i2c_pxa_platform_data my_i2c_platform_data = {
            .class = I2C_CLASS_HWMON
    };
    
    static void __init my_platform_init(void)
    {
            (void) platform_add_devices(devices, ARRAY_SIZE(devices));
    
            pxa_set_i2c_info(&my_i2c_platform_data);
    }
    
    Signed-off-by: Matej Kenda <matej.kenda@hermes-softlab.com>
    Signed-off-by: Russell King <rmk+kernel@arm.linux.org.uk>

commit 693efbebbbb946eda32023bf9822c6b577ad29c0
Author: Hans Verkuil <hverkuil@xs4all.nl>
Date:   Wed Mar 28 21:22:35 2007 -0400

    V4L: msp_attach must return 0 if no msp3400 was found.
    
    V4L: msp_attach must return 0 if no msp3400 was found.
    
    Returning -1 causes the probe to stop, but it should just continue
    instead. This patch fixes an annoying 'i2c_adapter i2c-7: Client
    creation failed at 0x44 (-1)' kernel message that appeared in 2.6.20
    
    (cherry picked from commit 3284b4e077cb2322754ea7455b8f8af7ce3777b8)
    
    Signed-off-by: Hans Verkuil <hverkuil@xs4all.nl>
    Signed-off-by: Mauro Carvalho Chehab <mchehab@infradead.org>
    Signed-off-by: Michael Krufky <mkrufky@linuxtv.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

commit 33e563c1190c26b6bf61990c505cdcb5cdbba7e4
Merge: 463020ce428e 5dd3ffae0afe
Author: Linus Torvalds <torvalds@woody.linux-foundation.org>
Date:   Tue Feb 13 16:28:23 2007 -0800

    Merge branch 'i2c-for-linus' of git://jdelvare.pck.nerim.net/jdelvare-2.6
    
    * 'i2c-for-linus' of git://jdelvare.pck.nerim.net/jdelvare-2.6:
      i2c: Stop using i2c_adapter.class_dev
      i2c: Remove the warning on missing adapter device
      i2c: Declare more i2c_adapter parent devices
      i2c: PA Semi SMBus driver
      i2c-amd8111: Proposed cleanups
      i2c-parport: Add support for One For All remote JP1 interface
      i2c-viapro: Add support for the VIA CX700 south bridge
      i2c: Add IDs to adapters
      i2c: Update the list of bus IDs
      i2c: Add driver suspend/resume/shutdown support
      i2c: completion header cleanups
      i2c-i801: Document the SMBus unhiding quirk
      i2c-i801: Spelling fix
      i2c: Fix typo in SMBus Write Word Data description
      i2c-piix4: Add support for the ATI SB600
      i2c-nforce2: Drop unused reference to pci_dev
      i2c/vt8231: Remove superfluous initialization
      i2c-ali1563: Fix device initialization
      i2c-ali1563: Improve the status messages

commit 5dd3ffae0afe355738eca14da1b47284bdae6240
Author: Jean Delvare <khali@linux-fr.org>
Date:   Tue Feb 13 22:09:04 2007 +0100

    i2c: Stop using i2c_adapter.class_dev
    
    Stop using i2c_adapter.class_dev, as it is going to be removed
    soon. Luckily, there are only 4 RTC drivers affected.
    
    Signed-off-by: Jean Delvare <khali@linux-fr.org>
    Cc: Alessandro Zummo <a.zummo@towertech.it>

commit fe2c8d51af96ef7b8ec0bfd70ec62bbe32c0696e
Author: Jean Delvare <khali@linux-fr.org>
Date:   Tue Feb 13 22:09:04 2007 +0100

    i2c: Remove the warning on missing adapter device
    
    Now that the i2c_adapter migration plan changed and we are going to
    keep i2c_adapter.dev, it's no longer that urgent to add a proper device
    to all i2c_adapter drivers. Thus is seems resonable to degrade the
    warning asking authors to migrate their driver to a debug message.
    
    Signed-off-by: Jean Delvare <khali@linux-fr.org>

commit 12a917f69d1468c91d646dbad8408dd0d39d6207
Author: Jean Delvare <khali@linux-fr.org>
Date:   Tue Feb 13 22:09:03 2007 +0100

    i2c: Declare more i2c_adapter parent devices
    
    Declare the parent device of i2c_adapter devices each time we can
    easily do so. It makes the i2c_adapter appear at the right place in
    the device tree, rather than as a platform device.
    
    Signed-off-by: Jean Delvare <khali@linux-fr.org>
    Cc: David Brownell <dbrownell@users.sourceforge.net>
    Cc: Len Brown <len.brown@intel.com>
    Cc: Jordan Crouse <jordan.crouse@amd.com>
    Cc: Jody McIntyre <scjody@modernduck.com>
    Cc: Stefan Richter <stefanr@s5r6.in-berlin.de>
    Cc: v4l-dvb-maintainer@linuxtv.org
    Cc: Petr Vandrovec <vandrove@vc.cvut.cz>

commit 91f7b5c41811154706448b2bf500000cbbfa96ba
Merge: af3e095a1fb4 81ffbc04a8ea
Author: Linus Torvalds <torvalds@woody.osdl.org>
Date:   Sat Jan 6 00:09:14 2007 -0800

    Merge branch 'i2c-for-linus' of git://jdelvare.pck.nerim.net/jdelvare-2.6
    
    * 'i2c-for-linus' of git://jdelvare.pck.nerim.net/jdelvare-2.6:
      i2c/m41t00: Do not forget to write year
      i2c-mv64xxx: Fix random oops at boot
      i2c: Migration aids for i2c_adapter.dev removal
      i2c-pnx: Add entry to MAINTAINERS
      i2c-pnx: Fix interrupt handler, get rid of EARLY config option

commit b119dc3f992183a04e508fc0a09f550eb19bf30e
Author: David Brownell <david-b@pacbell.net>
Date:   Thu Jan 4 13:07:04 2007 +0100

    i2c: Migration aids for i2c_adapter.dev removal
    
    Flag i2c_adapter.dev for removal after userspace tools get upgraded, and
    include a near-term code migration aid to facilitate this:
    
     - The class device gets the name attribute it should have had.  This
       was previously (wrongly) associated with the i2c_adapter.dev node.
       Sysfs based tools and libraries can start converting right away.
    
     - Issue a warning for legacy adapter drivers that don't provide any
       physical device node; so systems with those drivers will know to
       fix this problem earlier.
    
    This is one of a series of patches to help the I2C stack become a better
    citizen of the Linux Driver Model world.
    
    Signed-off-by: David Brownell <dbrownell@users.sourceforge.net>
    Signed-off-by: Jean Delvare <khali@linux-fr.org>

commit 6ea23039cb1cc7c379eb5fba0ed2c53291e9bea7
Author: Jiri Kosina <jikos@jikos.cz>
Date:   Sun Dec 10 21:21:30 2006 +0100

    i2c: Add support for nested i2c bus locking
    
    This patch adds the 'level' field into the i2c_adapter structure, which is
    used to represent the 'logical' level of nesting for the purposes of
    lockdep. This field is then used in the i2c_transfer() function, to
    acquire the per-adapter bus_lock with correct nesting level.
    
    Signed-off-by: Jiri Kosina <jikos@jikos.cz>
    Signed-off-by: Jean Delvare <khali@linux-fr.org>

commit ad04d5c3879dcf79ba0fa1826eab991f7b7a2de8
Author: Hans-Frieder Vogt <hfvogt@gmx.net>
Date:   Sun Dec 10 21:21:29 2006 +0100

    i2c: Cleanups to the i2c-nforce2 bus driver
    
    Summary of changes:
    
    - fixes:
       o legacy I/O region size is 64 bytes, not 8 bytes
    - general cleanup:
       o removed code for the unsupported I2C block data, block data,
          proc call and block proc call transfer modes
       o removed detail warnings about unsupported modes that are
         covered in a general warning (unsupported transaction...)
         anyway
       o removed necessity of a definition of struct i2c_adapter
       o moved definition of struct i2c_algorithm, making forward
         declarations of nforce2_access and nforce2_func unnecessary
    - minor changes:
       o in the description mention the nForce 5xx chipsets
       o changes my e-mail address in MODULE_AUTHOR
    
    Theses cleanups shrink the driver binary size from 4.0 kB to 2.7 kB
    on i386.
    
    Signed-off-by: Hans-Frieder Vogt <hfvogt@gmx.net>
    Signed-off-by: Jean Delvare <khali@linux-fr.org>

commit a14e18935076ce084c4edbc57883f38e642c8e5d
Author: David Brownell <david-b@pacbell.net>
Date:   Sun Dec 10 02:19:02 2006 -0800

    [PATCH] RTCs don't use i2c_adapter.dev
    
    Update more I2C drivers that live outside drivers/i2c to understand that using
    adapter->dev is not The Way.  When actually referring to the adapter hardware,
    adapter->class_dev.dev is the answer.  When referring to a device connected to
    it, client->dev.dev is the answer.
    
    Signed-off-by: David Brownell <dbrownell@users.sourceforge.net>
    Acked-by: Alessandro Zummo <a.zummo@towertech.it>
    Signed-off-by: Andrew Morton <akpm@osdl.org>
    Signed-off-by: Linus Torvalds <torvalds@osdl.org>

commit 9a4a3539b356a8f4da8c6ace95bc4135314fed7e
Author: Jean Delvare <khali@linux-fr.org>
Date:   Sat May 13 11:17:37 2006 +0200

    [PATCH] scx200_acb: Fix resource name use after free
    
    We can't pass a string on the stack to request_region. As soon as we
    leave the function that stack is gone and the string is lost. Let's
    use the same string we identify the i2c_adapter with instead, it's
    more simple, more consistent, and just works.
    
    This is the second half of fix to bug #6445.
    
    Signed-off-by: Jean Delvare <khali@linux-fr.org>
    Signed-off-by: Chris Wright <chrisw@sous-sol.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

commit b33d0798e6cfae1fcee75afc808fe5690a48a814
Author: Jean Delvare <khali@linux-fr.org>
Date:   Wed Apr 26 23:00:16 2006 +0200

    [PATCH] scx200_acb: Fix resource name use after free
    
    We can't pass a string on the stack to request_region. As soon as we
    leave the function that stack is gone and the string is lost. Let's
    use the same string we identify the i2c_adapter with instead, it's
    more simple, more consistent, and just works.
    
    This is the second half of fix to bug #6445.
    
    Signed-off-by: Jean Delvare <khali@linux-fr.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

commit 6f9c2963888e60e46a9e0bd09a25740abce29262
Author: Jean Delvare <khali@linux-fr.org>
Date:   Wed Apr 26 22:50:32 2006 +0200

    [PATCH] scx200_acb: Fix return on init error
    
    The scx200_acb driver shouldn't return failure after initialization
    if it successfully registered at least one i2c_adapter, else we are
    leaking resources. The driver was OK in that respect up to 2.6.16, a
    recent change broke it.
    
    This is part of the fix to bug #6445.
    
    Signed-off-by: Jean Delvare <khali@linux-fr.org>
    Cc: Ben Gardner <bgardner@wabtec.com>
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

commit 5a570cc0a41bd316afc91ba2c7151fed70d10b31
Author: David Woodhouse <dwmw2@infradead.org>
Date:   Tue Apr 25 14:10:40 2006 +0100

    Sanitise linux/i2c-algo-ite.h for userspace consumption
    
    It doesn't need to include i2c.h, because a forward declaration of
    struct i2c_adapter is perfectly sufficient. And it can be inside
    #ifdef __KERNEL__ along with the kernel-internal structure definition.
    
    Signed-off-by: David Woodhouse <dwmw2@infradead.org>

commit 0cbcb4d39a83d4df7e45c13b5ebd9fe73e025237
Author: Jean Delvare <khali@linux-fr.org>
Date:   Mon Feb 27 23:08:18 2006 +0100

    [PATCH] I2C: i2c-ali1535: Drop redundant mutex
    
    Drop a redundant mutex in driver i2c-ali1535. The struct i2c_adapter
    includes a mutex for the same purpose, operated by i2c-core.
    
    Signed-off-by: Jean Delvare <khali@linux-fr.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

commit f8d6d9f52b4977f5427e2cb782521611a823c108
Author: Jean Delvare <khali@linux-fr.org>
Date:   Sun Feb 5 23:30:26 2006 +0100

    [PATCH] i2c: Fix i2c-ite name initialization
    
    Properly set the name member of the i2c_adapter structure of the ite
    i2c adapter driver.
    
    Signed-off-by: Jean Delvare <khali@linux-fr.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

commit a28d3af2a26c89aaa6470ca36edb212e05143d67
Author: Benjamin Herrenschmidt <benh@kernel.crashing.org>
Date:   Sat Jan 7 11:35:26 2006 +1100

    [PATCH] 2/5 powerpc: Rework PowerMac i2c part 2
    
    This is the continuation of the previous patch. This one removes the old
    PowerMac i2c drivers (i2c-keywest and i2c-pmac-smu) and replaces them
    both with a single stub driver that uses the new PowerMac low i2c layer.
    
    Now that i2c-keywest is gone, the low-i2c code is extended to support
    interrupt driver transfers. All i2c busses now appear as platform
    devices. Compatibility with existing drivers should be maintained as the
    i2c bus names have been kept identical, except for the SMU bus but in
    that later case, all users has been fixed.
    
    With that patch added, matching a device node to an i2c_adapter becomes
    trivial.
    
    Signed-off-by: Benjamin Herrenschmidt <benh@kernel.crashing.org>
    Signed-off-by: Paul Mackerras <paulus@samba.org>

commit fe3d6a99782d5345b1927e872d77d1778668094b
Author: Stig Telfer <stig@lizardlogic.co.uk>
Date:   Sat Oct 8 00:23:27 2005 +0200

    [PATCH] i2c: Big i2c-elektor cleanup
    
    Cleanups to the i2c-elektor driver:
    
    * Set the i2c_adapter name field to "i2c-elektor" and use this string
      in all resource requests and printks.
    * Change space-padding for tab indentation, kill trailing white space,
      remove space before comma.
    * Use dev_info, pr_info and pr_debug instead of printk.
    * Lines chopped to 80 columns.
    
    Signed-off-by: Stig Telfer <stig@lizardlogic.co.uk>
    Signed-off-by: Jean Delvare <khali@linux-fr.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

commit 8a1b028bca95b5af36e94a660c4d284fe3313f74
Author: Jean Delvare <khali@linux-fr.org>
Date:   Fri Oct 7 23:04:48 2005 +0200

    [PATCH] i2c: Add missing i2c-ixp2000/4xx adapter name
    
    The ixp4xx and ixp2000 i2c bus drivers omit to fill the required
    i2c_adapter name field. Copy the device driver name field there.
    
    Signed-off-by: Jean Delvare <khali@linux-fr.org>
    Signed-off-by: Deepak Saxena <dsaxena@plexity.net>
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

commit d6072f842a77014220683ee5b781b7cee8f020d1
Author: Jean Delvare <khali@linux-fr.org>
Date:   Sun Sep 25 16:37:04 2005 +0200

    [PATCH] i2c: Reuse name strings in i2c bus drivers
    
    Clean up name string usage in 12 i2c bus drivers:
    * Use the i2c_adapter name for requesting the I/O region rather than
      redefining a new string.
    * Do not initialize the i2c_adapter name to "unset".
    This should save a few data bytes here and there.
    
    Signed-off-by: Jean Delvare <khali@linux-fr.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>
    
     drivers/i2c/busses/i2c-ali1535.c |    6 +++---
     drivers/i2c/busses/i2c-ali1563.c |    6 ++++--
     drivers/i2c/busses/i2c-ali15x3.c |    5 +++--
     drivers/i2c/busses/i2c-amd756.c  |    5 ++---
     drivers/i2c/busses/i2c-amd8111.c |    4 +++-
     drivers/i2c/busses/i2c-i801.c    |    4 ++--
     drivers/i2c/busses/i2c-nforce2.c |    4 ++--
     drivers/i2c/busses/i2c-piix4.c   |    4 ++--
     drivers/i2c/busses/i2c-sis5595.c |    5 +++--
     drivers/i2c/busses/i2c-sis630.c  |    6 ++++--
     drivers/i2c/busses/i2c-sis96x.c  |    5 +++--
     drivers/i2c/busses/i2c-via.c     |    4 ++--
     12 files changed, 33 insertions(+), 25 deletions(-)

commit 8ac2120d90273c590cf7662f03d103519101685b
Author: Jean Delvare <khali@linux-fr.org>
Date:   Fri Sep 16 19:28:08 2005 -0700

    [PATCH] i2c: kill an unused i2c_adapter struct member
    
    Kill an unused member of the i2c_adapter structure.  This additionally
    fixes a potential bug, because <linux/i2c.h> doesn't include
    <linux/config.h>, so different files including <linux/i2c.h> could see a
    different definition of the i2c_adapter structure, depending on them
    including <linux/config.h> (or other header files themselves including
    <linux/config.h>) before <linux/i2c.h>, or not.
    
    Credits go to Jrn Engel for pointing me to the problem.
    
    Signed-off-by: Jean Delvare <khali@linux-fr.org>
    Cc: Greg KH <greg@kroah.com>
    Signed-off-by: Andrew Morton <akpm@osdl.org>
    Signed-off-by: Linus Torvalds <torvalds@osdl.org>

commit 020789e9cb688ac8b15a9950d25fe45492b23398
Author: Jean Delvare <khali@linux-fr.org>
Date:   Sat Aug 13 13:04:32 2005 +0200

    [PATCH] I2C: Outdated i2c_adapter comment
    
    Delete an outdated comment about i2c_algorithm.id being computed
    from algo->id.
    
    Signed-off-by: Jean Delvare <khali@linux-fr.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

commit c7a46533ff7ef9e1c51bae6e54208527c5275b24
Author: Jean Delvare <khali@linux-fr.org>
Date:   Thu Aug 11 23:41:56 2005 +0200

    [PATCH] I2C: Kill i2c_algorithm.id (5/7)
    
    Merge the algorithm id part (16 upper bits) of the i2c adapters ids
    into the definition of the adapters ids directly. After that, we don't
    need to OR both ids together for each i2c_adapter structure.
    
    Signed-off-by: Jean Delvare <khali@linux-fr.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

commit cdcb19219714c796ddef1202e952566c5f86354d
Author: Jean Delvare <khali@linux-fr.org>
Date:   Thu Jul 28 23:09:40 2005 +0200

    [PATCH] I2C: inline i2c_adapter_id
    
    We could inline i2c_adapter_id, as it is really, really short. Doing
    so saves a few bytes both in i2c-core and in the drivers using this
    function.
    
                                                before     after      diff
    drivers/hwmon/adm1026.ko                     41344     41305       -39
    drivers/hwmon/asb100.ko                      27325     27246       -79
    drivers/hwmon/gl518sm.ko                     20824     20785       -39
    drivers/hwmon/it87.ko                        26419     26380       -39
    drivers/hwmon/lm78.ko                        21424     21385       -39
    drivers/hwmon/lm85.ko                        41034     40939       -95
    drivers/hwmon/w83781d.ko                     39561     39514       -47
    drivers/hwmon/w83792d.ko                     32979     32932       -47
    drivers/i2c/i2c-core.ko                      24708     24531      -177
    
    Signed-off-by: Jean Delvare <khali@linux-fr.org>
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>

commit 400c455eaa0d0819d18cd42a74070e0e238a73dc
Author: Jean Delvare <khali@linux-fr.org>
Date:   Tue Jul 19 23:48:43 2005 +0200

    [PATCH] I2C: Separate non-i2c hwmon drivers from i2c-core (2/9)
    
    Convert i2c-isa from a dumb i2c_adapter into a pseudo i2c-core for ISA
    hardware monitoring drivers. The isa i2c_adapter is no more registered
    with i2c-core, drivers have to explicitely connect to it using the new
    i2c_isa_{add,del}_driver interface.
    
    At this point, all ISA chip drivers are useless, because they still
    register with i2c-core in the hope i2c-isa is registered there as well,
    but it isn't anymore.
    
    The fake bus will be named i2c-9191 in sysfs. This is the number it
    already had internally in various places, so it's not exactly new,
    except that now the number is seen in userspace as well. This shouldn't
    be a problem until someone really has 9192 I2C busses in a given system
    ;)
    
    The fake bus will no more show in "i2cdetect -l", as it won't be seen by
    i2c-dev anymore (not being registered with i2c-core), which is a good
    thing, as i2cdetect/i2cdump/i2cset cannot operate on this fake bus
    anyway.
    
    Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>
